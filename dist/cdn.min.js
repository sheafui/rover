(()=>{function h(n){return{__value:void 0,init(){let t=n.extractProp(this.$el,"disabled",!1,!1),e=this.__value=n.extractProp(this.$el,"value",""),i=n.extractProp(this.$el,"data-label",""),r=n.extractProp(this.$el,"data-search",e),s=String(r).toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").trim();this.$el.dataset.value=e,this.__add(e,i,s,t),this.$nextTick(()=>{t&&this.$el.setAttribute("tabindex","-1")})},destroy(){this.__forget(this.__value)}}}var v=class{constructor(t){this.itemsMap=new Map;this.VALUES_IN_DOM_ORDER=[];this.currentQuery="";this.currentResults=[];this.navIndex=[];this._navPosMap=new Map;this._navDirty=!1;this._flushQueued=!1;this.typedBuffer="";this.bufferResetTimeout=null;this.bufferDelay=500;this.pending=Alpine.reactive({value:!1}),this.activatedValue=Alpine.reactive({value:null}),this.searchThreshold=t.searchThreshold??500}add(t,e,i,r=!1){this.itemsMap.has(t)||(this.itemsMap.set(t,{value:t,label:e,searchable:i,disabled:r}),this._markDirty())}forget(t){let e=this.itemsMap.get(t);if(!e)return;this.itemsMap.delete(t);let i=this.currentResults.indexOf(e);i!==-1&&this.currentResults.splice(i,1),this.activatedValue.value===t&&(this.activatedValue.value=null),this._markDirty()}static _normalize(t){let e=t.toLowerCase();return/[^\u0000-\u007f]/.test(e)?e.normalize("NFD").replace(/[\u0300-\u036f]/g,""):e}search(t){let e=v._normalize(t),r=this.currentQuery&&e.startsWith(this.currentQuery)&&this.currentResults.length?this.currentResults:Array.from(this.itemsMap.values()),s=[],a=[];for(let l of r){let _=l.searchable;_.startsWith(e)?s.push(l):_.includes(e)&&a.push(l)}return this.currentQuery=e,this.currentResults=s.length||a.length?s.concat(a):[],this._markDirty(),this.currentResults}reset(){this.currentQuery="",this.currentResults=[],this._markDirty()}get(t){return this.itemsMap.get(t)}getActiveItem(){return this.activatedValue.value?this.itemsMap.get(this.activatedValue.value)??null:null}getAllValues(){return this.VALUES_IN_DOM_ORDER}get size(){return this.itemsMap.size}_markDirty(){this._navDirty=!0,this._flushQueued||(this._flushQueued=!0,queueMicrotask(()=>{this._flushQueued=!1,this._navDirty&&this._rebuildNavIndex()}))}_ensureNavIndex(){this._navDirty&&this._rebuildNavIndex()}_rebuildNavIndex(){let t=this.currentResults.length?new Set(this.currentResults):null,e=[];for(let i of this.VALUES_IN_DOM_ORDER){let r=this.itemsMap.get(i);!r||r.disabled||t!==null&&!t.has(r)||e.push(i)}this.navIndex=e,this._navPosMap=new Map(e.map((i,r)=>[i,r])),this._navDirty=!1}setValuesInDomOrder(t){this.VALUES_IN_DOM_ORDER=t,this._navDirty=!0,this._rebuildNavIndex()}activate(t){this._ensureNavIndex();let e=this.itemsMap.get(t);!e||e.disabled||this.activatedValue.value!==t&&(this.activatedValue.value=t)}deactivate(){this.activatedValue.value=null}isActivated(t){return this.activatedValue.value===t}_setActiveByIndex(t){let e=this.navIndex[t];e!==void 0&&(this.activatedValue.value=e)}activateFirst(){this._ensureNavIndex(),!!this.navIndex.length&&this._setActiveByIndex(0)}activateLast(){this._ensureNavIndex(),!!this.navIndex.length&&this._setActiveByIndex(this.navIndex.length-1)}activateNext(){if(this._ensureNavIndex(),!this.navIndex.length)return;let t=this.activatedValue.value!==null?this._navPosMap.get(this.activatedValue.value)??-1:-1;this._setActiveByIndex(t===-1?0:(t+1)%this.navIndex.length)}activatePrev(){if(this._ensureNavIndex(),!this.navIndex.length)return;let t=this.activatedValue.value!==null?this._navPosMap.get(this.activatedValue.value)??-1:-1;this._setActiveByIndex(t<=0?this.navIndex.length-1:t-1)}activateByKey(t){if(this._ensureNavIndex(),this.typedBuffer+=t.toLowerCase(),this.bufferResetTimeout&&clearTimeout(this.bufferResetTimeout),this.bufferResetTimeout=setTimeout(()=>this.typedBuffer="",this.bufferDelay),!this.navIndex.length)return;let e=this.activatedValue.value!==null?this._navPosMap.get(this.activatedValue.value)??-1:-1,i=e===-1?0:(e+1)%this.navIndex.length,r=this.navIndex.length;for(let s=0;s<r;s++){let a=this.navIndex[(i+s)%r],l=this.itemsMap.get(a);if(l&&l.searchable.startsWith(this.typedBuffer)){this.activatedValue.value=a;break}}}},b=v;function d(n,t,e,i){n.addEventListener(t,e,{signal:i.signal})}function y(n){let t=n.$root.querySelector("[x-rover\\:input]"),e=()=>t?!0:(console.warn("Input element with [x-rover\\:input] not found"),!1);return{controller:new AbortController,on(i,r){if(!e())return;d(t,i,a=>{r(a,n.__activatedValue??void 0)},this.controller)},get value(){return t?t.value:""},set value(i){t&&(t.value=i)},focus(i=!0){requestAnimationFrame(()=>t?.focus({preventScroll:i}))},enableDefaultInputHandlers(i=[]){!e()||(i.includes("focus")||this.on("focus",()=>n.__startTyping()),i.includes("blur")||this.on("blur",()=>n.__stopTyping()),i.includes("keydown")||this.on("keydown",r=>{switch(r.key){case"ArrowDown":r.preventDefault(),r.stopPropagation(),n.__activateNext();break;case"ArrowUp":r.preventDefault(),r.stopPropagation(),n.__activatePrev();break;case"Escape":r.preventDefault(),r.stopPropagation(),requestAnimationFrame(()=>this.focus(!0));break;case"Home":r.preventDefault(),n.__activateFirst();break;case"End":r.preventDefault(),n.__activateLast();break;case"Tab":n.__stopTyping();break}}))},get el(){return t},destroy(){this.controller.abort()}}}function x(n){let t=()=>Array.from(n.$el.querySelectorAll("[x-rover\\:option]"));return{controller:new AbortController,on(e,i){n.$nextTick(()=>{let r=t();if(!r)return;let s=a=>{i(a,n.__activatedValue??void 0)};r.forEach(a=>{d(a,e,s,this.controller)})})},destroy(){this.controller.abort()}}}function M(n){let t=n.$el.querySelector("[x-rover\\:options]");t||console.warn("Options container not found");let e=i=>{if(!(!i||!(i instanceof HTMLElement)))return Alpine.findClosest(i,r=>r.hasAttribute("x-rover:option"))};return{controller:new AbortController,on(i,r){if(!t)return;d(t,i,a=>{let l=e(a.target);r(a,l,n.__activatedValue??null)},this.controller)},findClosestOption:e,enableDefaultOptionsHandlers(i=[]){!t||(t.tabIndex=0,i.includes("mouseover")||this.on("mouseover",(r,s)=>{!s?.dataset.value||n.__activate(s.dataset.value)}),i.includes("mousemove")||this.on("mousemove",(r,s)=>{!s?.dataset.value||n.__isActive(s.dataset.value)||n.__activate(s.dataset.value)}),i.includes("mouseout")||this.on("mouseout",()=>{n.__keepActivated||n.__deactivate()}),i.includes("keydown")||this.on("keydown",r=>{switch(r.stopPropagation(),r.key){case"ArrowDown":r.preventDefault(),n.__activateNext();break;case"ArrowUp":r.preventDefault(),n.__activatePrev();break;case"Home":r.preventDefault(),n.__activateFirst();break;case"End":r.preventDefault(),n.__activateLast();break;case"Escape":r.preventDefault(),n.__deactivate();break;case"Tab":n.__deactivate();break}}))},get all(){let i=n.__optionsEls;return i?Array.from(i):[]},flush(){n.__flush()},destroy(){this.controller.abort()}}}function I(n){let t=n.$el.querySelector("[x-rover\\:button]");return{controller:new AbortController,on(e,i){if(!t)return;d(t,e,s=>{i(s,n.__activatedValue??void 0)},this.controller)},destroy(){this.controller.abort()}}}function f({effect:n}){let t=new b({preventDuplication:!0});return{__collection:t,__optionsEls:void 0,__groupsEls:void 0,__optionIndex:void 0,__isOpen:!1,__isTyping:!1,__isLoading:!1,__g_id:-1,__s_id:-1,__static:!1,__keepActivated:!0,__optionsEl:void 0,__prevActivatedValue:void 0,__activatedValue:void 0,__items:[],__filteredValues:null,__prevVisibleArray:null,__prevActiveValue:void 0,__externalQuery:null,__effectRAF:null,__inputManager:void 0,__optionsManager:void 0,__optionManager:void 0,__buttonManager:void 0,__add:(e,i,r,s)=>t.add(e,i,r,s),__forget:e=>t.forget(e),__activate:e=>t.activate(e),__deactivate:()=>t.deactivate(),__isActive:e=>t.isActivated(e),__getActiveItem:()=>t.getActiveItem(),__activateNext:()=>t.activateNext(),__activatePrev:()=>t.activatePrev(),__activateFirst:()=>t.activateFirst(),__activateLast:()=>t.activateLast(),__searchUsingQuery:e=>t.search(e),__getItemByValue:e=>t.get(e),__getLabelByValue(e){return this.__getItemByValue(e)?.label},__getSearchableByValue(e){return this.__getItemByValue(e)?.searchable},__getDisabledByValue(e){return this.__getItemByValue(e)?.disabled},init(){this.__setupManagers(),n(()=>{this.__isLoading=t.pending.value}),this.__inputManager.on("input",e=>{let i=e?.target;if(!(i._x_model?.get()!==void 0)){let a=i.value;a.length>0?this.__filteredValues=this.__searchUsingQuery(a).map(l=>l.value):(this.__filteredValues=null,t.reset())}let s=this.__filteredValues??this.__collection.getAllValues();this.__activatedValue&&!s.includes(this.__activatedValue)&&this.__deactivate(),this.__collection.getActiveItem()||this.__collection.activateFirst()}),this.$nextTick(()=>{this.__buildOptions(),this.__setValuesInDomOrder(),n(()=>{let e=t.getActiveItem(),i=this.__activatedValue=e?.value,r=this.__filteredValues;requestAnimationFrame(()=>{this.patchItemsVisibility(r),this.patchItemsActivity(i)})})})},__handleGroupsVisibility(){},__handleSeparatorsVisibility(){},patchItemsVisibility(e){if(!this.__optionsEls||!this.__optionIndex)return;let i=this.__prevVisibleArray;if(e===i)return;if(e===null){if(i===null)return;this.__optionsEls.forEach(a=>{a.style.display=""}),this.__prevVisibleArray=null;return}let r=new Set(e),s=i?new Set(i):null;if(s===null){this.__optionsEls.forEach(a=>{let l=a.dataset.value;if(!l)return;let _=!r.has(l);a.style.display!==(_?"none":"")&&(a.style.display=_?"none":"")}),this.__prevVisibleArray=e;return}for(let a of s)if(!r.has(a)){let l=this.__optionIndex.get(a);l&&(l.style.display="none")}for(let a of r)if(!s.has(a)){let l=this.__optionIndex.get(a);l&&(l.style.display="")}this.__prevVisibleArray=e},patchItemsActivity(e){let i=this.__prevActiveValue;if(i!==e){if(i){let r=this.__optionIndex.get(i);r&&(r.removeAttribute("data-active"),r.removeAttribute("aria-current"))}if(e){let r=this.__optionIndex.get(e);r&&(r.setAttribute("data-active","true"),r.setAttribute("aria-current","true"),requestAnimationFrame(()=>{r.scrollIntoView({block:"nearest"})}))}this.__prevActiveValue=e}},__flush(){this.__buildOptions(),this.__setValuesInDomOrder()},__setValuesInDomOrder(){let e=this.__optionsEls.map(i=>i.dataset.value);t.setValuesInDomOrder(e)},__buildOptions(){this.__optionsEls=Array.from(this.$el.querySelectorAll("[x-rover\\:option]")),this.__optionIndex=new Map,this.__optionsEls.forEach(e=>{let i=e.dataset.value;i&&this.__optionIndex.set(i,e)})},__setupManagers(){this.__inputManager=y(this),this.__optionManager=x(this),this.__optionsManager=M(this),this.__buttonManager=I(this)},__open(){this.__isOpen||(this.__isOpen=!0,requestAnimationFrame(()=>{this.$refs?._x__input?.focus({preventScroll:!0})}))},__pushSeparatorToItems(e){this.__items.push({type:"s",id:e})},__pushGroupToItems(e){this.__items.push({type:"g",id:e})},__pushOptionToItems(e){this.__items.push({type:"g",id:e})},__startTyping(){this.__isTyping=!0},__stopTyping(){this.__isTyping=!1},__nextGroupId(){return++this.__g_id},__nextSeparatorId(){return++this.__s_id},__getActiveItemEl(){let e=t.getActiveItem()?.value;if(!!e)return this.__optionIndex?.get(e)},destroy(){this.__inputManager?.destroy(),this.__optionManager?.destroy(),this.__optionsManager?.destroy(),this.__buttonManager?.destroy(),this.cleanInjectedStyles()},cleanInjectedStyles(){let e=document.getElementById("rover-group-styles");!e||e.remove()}}}var A=n=>{let t=Alpine.$data(n);return{get collection(){return t.__collection},get input(){return t.__inputManager},get option(){return t.__optionManager},get options(){return t.__optionsManager},get button(){return t.__buttonManager},get isLoading(){return t.__isLoading},get inputEl(){return t.$root.querySelector("[x-rover\\:input]")},getActiveItemEl(){return t.__getActiveItemEl()},getItemByValue(e){return t.__getItemByValue(e)},getLabel(e){return t.__getLabelByValue(e)},isDisabled(e){return t.__getDisabledByValue(e)},getSearchable(e){return t.__getSearchableByValue(e)},getActiveItemId(){return this.getActiveItemEl()?.id},reIndex(){},getOptionElByValue(e){return t.__optionIndex?.get(e)},activate(e){t.__collection.activate(e)},deactivate(){t.__collection.deactivate()},getActiveItem(){return t.__collection.getActiveItem()},activateNext(){t.__collection.activateNext()},activatePrev(){t.__collection.activatePrev()},activateFirst(){t.__collection.activateFirst()},activateLast(){t.__collection.activateLast()},activateByKey(e){t.__collection.activateByKey(e)},searchUsing(e){return t.__collection.search(e)},reconcileDom(){this.options.flush(),this.activateFirst()}}};var E=n=>({activate(t){n.__collection.activate(t)},deactivate(){n.__collection.deactivate()},getActiveItem(){return n.__collection.getActiveItem()},activateNext(){n.__collection.activateNext()},activatePrev(){n.__collection.activatePrev()},activateFirst(){n.__collection.activateFirst()},activateLast(){n.__collection.activateLast()},searchUsing(t){return n.__collection.search(t)}});var R=n=>({isOpen(){return n.__isOpen},isStatic(){return n.__static}});function m(n){n.magic("rover",t=>{let e=n.findClosest(t,i=>i.hasAttribute("x-rover"));if(!e)throw"No x-rover directive found, this magic meant to be used under x-rover root context...";return A(e)}),n.magic("roverOption",t=>{let e=n.findClosest(t,r=>r.hasAttribute("x-rover:option"));if(!e)throw"No x-rover:option directive found, this magic meant to be used per option context...";let i=n.$data(e);return E(i)}),n.magic("roverOptions",t=>{let e=n.findClosest(t,r=>r.hasAttribute("x-rover:options"));if(!e)throw"No x-rover:options directive found, this magic meant to be used per options context...";let i=n.$data(e);return R(i)})}function g(n){n.directive("rover",(o,{value:u,modifiers:c},{Alpine:p,effect:V})=>{switch(u){case null:t(p,o,V);break;case"input":e(p,o);break;case"button":a(p,o);break;case"options":i(o);break;case"option":r(p,o);break;case"group":s(p,o);break;case"loading":_(p,o,c);break;case"separator":T(p,o);break;case"empty":l(p,o);break;default:console.error("invalid x-rover value",u,"use input, button, option, options, group or leave mepty for root level instead");break}}).before("data"),m(n);function t(o,u,c){o.bind(u,{"x-data"(){return{...f({effect:c})}}})}function e(o,u){o.bind(u,{"x-bind:id"(){return this.$id("rover-input")},tabindex:"0","aria-autocomplete":"list","x-bind:aria-controls"(){return this.$id("rover-options")},"x-bind:aria-activedescendant"(){let c=this.__activatedValue;return c?this.__optionIndex?.get(c)?.id??!1:!1}})}function i(o){n.bind(o,{"x-bind:id"(){return this.$id("rover-options")},role:"listbox","aria-orientation":"vertical","x-bind:data-loading"(){return this.__isLoading}})}function r(o,u){o.bind(u,{"x-id"(){return["rover-option"]},"x-bind:id"(){return this.$id("rover-option")},role:"option","x-bind:aria-disabled"(){return this.$el.hasAttribute("disabled")?"true":"false"},"x-data"(){return h(o)}})}function s(o,u){o.bind(u,{"x-id"(){return["rover-group"]},"x-bind:id"(){return this.$id("rover-group")},role:"group","x-init"(){let c=this.$id("rover-group");if(this.$el.setAttribute("aria-labelledby",`${c}-label`),!document.getElementById("rover-group-styles")){let p=document.createElement("style");p.id="rover-group-styles",p.textContent=`
                        [x-rover\\:group]:not(:has([x-rover\\:option]:not([style*="display: none"]))) {
                            display: none;
                        }
                    `,document.head.appendChild(p),console.log(document.head)}}})}function a(o,u){o.bind(u,{"x-ref":"__button","x-bind:id"(){return this.$id("rover-button")},tabindex:"-1"})}function l(o,u){o.bind(u,{tabindex:"-1","aria-haspopup":"true","x-show"(){return Array.isArray(this.__filteredValues)&&this.__filteredValues.length===0&&this.__inputManager.value.length>0}})}function _(o,u,c){let p=c.includes("hide");o.bind(u,{"x-show"(){return p?!this.__isLoading:this.__isLoading},role:"status","aria-live":"polite","aria-atomic":"true"})}function T(o,u){o.bind(u,{"x-init"(){let c=String(this.__nextSeparatorId());this.$el.dataset.key=c,console.log(c),this.__pushSeparatorToItems(c),this.$el.setAttribute("role","separator"),this.$el.setAttribute("aria-orientation","horizontal")}})}}document.addEventListener("alpine:init",()=>{window.Alpine.plugin(g)});})();
