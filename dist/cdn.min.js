(()=>{var v="rover-option";function f(n,t,e){return{__uniqueKey:"option-"+t,__isVisible:!0,init(){this.$el.dataset.slot=v,this.$el.dataset.key=this.__uniqueKey;let l;e!==null?l=e:l=n.extractProp(this.$el,"value","");let i=n.extractProp(this.$el,"disabled",!1,!1);this.$el.dataset.value=l,this.__add(this.__uniqueKey,l,i),this.__pushOptionToItems(String(t)),this.$nextTick(()=>{i&&this.$el.setAttribute("tabindex","-1")})},destroy(){this.__forget(this.__uniqueKey)}}}var m=class{constructor(t={}){this.items=[];this.itemsMap=new Map;this.searchIndex=[];this.currentQuery="";this.currentResults=[];this.navIndex=[];this.activeNavPos=-1;this.needsReindex=!1;this.isProcessing=!1;this.pending=Alpine.reactive({state:!1}),this.activeIndex=Alpine.reactive({value:void 0}),this.searchThreshold=t.searchThreshold??500}add(t,e,l=!1){if(this.itemsMap.has(t))return;let i={key:t,value:e,disabled:l};this.items.push(i),this.itemsMap.set(t,i),this.invalidate()}forget(t){let e=this.itemsMap.get(t);if(!e)return;let l=this.items.indexOf(e);this.itemsMap.delete(t),this.items.splice(l,1),this.activeIndex.value===l?(this.activeIndex.value=void 0,this.activeNavPos=-1):this.activeIndex.value!==void 0&&this.activeIndex.value>l&&this.activeIndex.value--,this.invalidate()}invalidate(){this.needsReindex=!0,this.currentQuery="",this.currentResults=[],this.scheduleBatch()}scheduleBatch(){this.isProcessing||(this.isProcessing=!0,this.pending.state=!0,queueMicrotask(()=>{this.rebuildSearchIndex(),this.rebuildNavIndex(),this.isProcessing=!1,this.pending.state=!1}))}rebuildSearchIndex(){!this.needsReindex||(this.searchIndex=this.items.map(t=>({key:t.key,value:String(t.value).toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"")})),this.needsReindex=!1)}rebuildNavIndex(){this.navIndex=[];let t=this.currentResults.length>0?this.currentResults:this.items;for(let e=0;e<this.items.length;e++)!this.items[e]?.disabled&&t.includes(this.items[e])&&this.navIndex.push(e)}toggleIsPending(){this.pending.state=!this.pending.state}search(t){if(!t)return this.currentQuery="",this.currentResults=[],this.rebuildNavIndex(),this.items;let e=t.toLowerCase();if(this.currentQuery&&e.startsWith(this.currentQuery)&&this.currentResults.length>0){let r=this.currentResults.filter(o=>String(o.value).toLowerCase().includes(e));return this.currentQuery=e,this.currentResults=r,this.rebuildNavIndex(),r}this.rebuildSearchIndex();let l=e.normalize("NFD").replace(/[\u0300-\u036f]/g,""),i=[];for(let{key:r,value:o}of this.searchIndex)if(o.includes(l)){let u=this.itemsMap.get(r);u&&i.push(u)}return this.currentQuery=e,this.currentResults=i,this.rebuildNavIndex(),i}get(t){return this.itemsMap.get(t)}getValueByKey(t){return this.get(t)?.value}getKeyByIndex(t){return t==null||t===void 0?null:this.items[t]?.key??null}all(){return this.items}get size(){return this.items.length}activate(t){let e=this.get(t);if(!e||e.disabled)return;this.rebuildSearchIndex(),this.rebuildNavIndex();let l=this.items.indexOf(e);this.activeIndex.value!==l&&(this.activeIndex.value=l,this.activeNavPos=this.navIndex.indexOf(l))}deactivate(){this.activeIndex.value=void 0,this.activeNavPos=-1}isActivated(t){let e=this.get(t);return e?this.items.indexOf(e)===this.activeIndex.value:!1}getActiveItem(){return this.activeIndex.value===void 0?null:this.items[this.activeIndex.value]??null}activateFirst(){if(this.rebuildSearchIndex(),this.rebuildNavIndex(),!this.navIndex.length)return;let t=this.navIndex[0];t!==void 0&&(this.activeIndex.value=t,this.activeNavPos=0)}activateLast(){if(this.rebuildSearchIndex(),this.rebuildNavIndex(),!this.navIndex.length)return;this.activeNavPos=this.navIndex.length-1;let t=this.navIndex[this.activeNavPos];typeof t=="number"&&(this.activeIndex.value=t)}activateNext(){if(this.rebuildSearchIndex(),this.rebuildNavIndex(),!this.navIndex.length)return;if(this.activeNavPos===-1){this.activateFirst();return}this.activeNavPos=(this.activeNavPos+1)%this.navIndex.length;let t=this.navIndex[this.activeNavPos];t!==void 0&&(this.activeIndex.value=t)}activatePrev(){if(this.rebuildSearchIndex(),this.rebuildNavIndex(),!this.navIndex.length)return;if(this.activeNavPos===-1){this.activateLast();return}this.activeNavPos=this.activeNavPos===0?this.navIndex.length-1:this.activeNavPos-1;let t=this.navIndex[this.activeNavPos];t!==void 0&&(this.activeIndex.value=t)}},I=m;function y({el:n,effect:t}){let e=new I,l="rover-root";return{collection:e,__optionsEls:void 0,__groupsEls:void 0,__state:null,__isOpen:!1,__isMultiple:!1,__isTyping:!1,__isLoading:!1,__o_id:-1,__g_id:-1,__s_id:-1,__static:!1,__keepActivated:!0,__optionsEl:void 0,__compareBy:void 0,__activatedKey:void 0,__selectedKeys:void 0,__isDisabled:!1,__items:[],__searchQuery:"",__filteredKeys:null,__filteredKeysSet:new Set,__add:(i,r,o)=>e.add(i,r,o),__forget:i=>e.forget(i),__activate:i=>e.activate(i),__deactivate:()=>e.deactivate(),__isActive:i=>e.isActivated(i),__getValueByKey:i=>e.getValueByKey(i),__getActiveItem:()=>e.getActiveItem(),__activateNext:()=>e.activateNext(),__activatePrev:()=>e.activatePrev(),__activateFirst:()=>e.activateFirst(),__activateLast:()=>e.activateLast(),__searchUsingQuery:i=>e.search(i),__getKeyByIndex:i=>e.getKeyByIndex(i),__onOpenCallback:()=>{},__onOpen(i){this.__onOpenCallback=i},__onCloseCallback:()=>{},__onClose(i){this.__onCloseCallback=i},onkeydown:i=>{this.$root.addEventListener("keydown",r=>{let o=this.__activatedKey||null;i(r,o)})},init(){this.$el.dataset.slot=l,t(()=>{this.__isLoading=e.pending.state}),t(()=>{this.__activatedKey=this.__getKeyByIndex(e.activeIndex.value)}),t(()=>{if(String(this.__searchQuery).length>0){let i=this.__searchUsingQuery(this.__searchQuery).map(r=>r.key);i.length>=0&&(this.__filteredKeys=i)}else this.__filteredKeys=null;this.__activatedKey&&this.__filteredKeys&&!this.__filteredKeys.includes(this.__activatedKey)&&this.__deactivate(),this.__isOpen&&!this.__getActiveItem()&&this.__filteredKeys&&this.__filteredKeys.length&&this.__activate(this.__filteredKeys[0])}),this.$nextTick(()=>{this.__optionsEls=Array.from(this.$el.querySelectorAll("[data-slot=rover-option]")),this.__groupsEls=Array.from(this.$el.querySelectorAll("[data-slot=rover-group]")),t(()=>{let i=this.__activatedKey,r=this.__filteredKeys?new Set(this.__filteredKeys):null,o=new Set(Array.isArray(this.__selectedKeys)?this.__selectedKeys:this.__selectedKeys?[this.__selectedKeys]:[]);requestAnimationFrame(()=>{this.__optionsEls.forEach(h=>{let s=h,a=s.dataset.key;!a||(r!==null?s.hidden=!r.has(a):s.hidden=!1,a===i?(s.setAttribute("data-active","true"),s.setAttribute("aria-current","true"),s.scrollIntoView({block:"nearest"})):(s.removeAttribute("data-active"),s.removeAttribute("aria-current")),o.has(a)?(s.setAttribute("aria-selected","true"),s.setAttribute("data-selected","true")):(s.setAttribute("aria-selected","false"),s.removeAttribute("data-selected")))}),this.__groupsEls.forEach(h=>{let s=h,a=s.querySelectorAll("[data-slot=rover-option]"),p=Array.from(a).some(d=>{let _=d;return r?r.has(_.dataset.key||""):!0});s.hidden=!p})})})}),this.__isDisabled=Alpine.extractProp(n,"disabled",!1),this.__compareBy=Alpine.extractProp(n,"by",""),this.__registerEventsDelector(),this.$nextTick(()=>{this.$refs.__input&&this.__handleInputEvents()}),this.$nextTick(()=>{this.$refs.__input||(this.__isOpen=!0)})},__open(){this.__isOpen||(this.__isOpen=!0,requestAnimationFrame(()=>{this.$refs?.__input?.focus({preventScroll:!0})}),this.__onOpenCallback())},__pushSeparatorToItems(i){this.__items.push({type:"s",key:i})},__pushGroupToItems(i){this.__items.push({type:"g",key:i})},__pushOptionToItems(i){this.__items.push({type:"o",key:i})},__close(){this.__isOpen=!1,this.__deactivate()},__handleSelection(i){let r=this.__getValueByKey(i);if(!this.__isMultiple){this.__selectedKeys=i,this.__state===r?(this.__state=null,this.__selectedKeys=null):this.__state=r,this.__static||this.__close(),console.log(this.__state);return}Array.isArray(this.__selectedKeys)||(this.__selectedKeys=[]),Array.isArray(this.__state)||(this.__state=[]);let o=this.__state.findIndex(c=>this.__compare(c,r)),u=this.__selectedKeys.indexOf(i);o===-1?(this.__state.push(r),this.__selectedKeys.push(i)):(this.__state.splice(o,1),this.__selectedKeys.splice(u,1))},__selectActive(){!this.__activatedKey||this.__handleSelection(this.__activatedKey)},__startTyping(){this.__isTyping=!0},__stopTyping(){this.__isTyping=!1},__resetInput(){let i=this.$refs.__input;if(!i)return;let r=this.__getCurrentValue();i.value=r},__getCurrentValue(){return!this.$refs.__input||!this.__state?"":typeof this.__state=="string"?this.__state:""},__compare(i,r){let o=this.__compareBy;if(!this.__compareBy)o=(u,c)=>Alpine.raw(u)===Alpine.raw(c);else if(typeof this.__compareBy=="string"){let u=this.__compareBy;o=(c,h)=>{if(!c||typeof c!="object"||!h||typeof h!="object")return Alpine.raw(c)===Alpine.raw(h);let s=c,a=h;return s[u]===a[u]}}return o(i,r)},__nextOptionId(){return++this.__o_id},__nextGroupId(){return++this.__g_id},__nextSeparatorId(){return++this.__s_id},__registerEventsDelector(){let i=o=>Alpine.findClosest(o,u=>u.dataset.slot===v),r=o=>function(u){if(u.stopPropagation(),!(u.target instanceof Element))return;let c=i(u.target);!c||o(c)};this.$nextTick(()=>{this.__optionsEl=this.$refs.__options,!!this.__optionsEl&&(this.__optionsEl.addEventListener("click",r(o=>{!o.dataset.key||this.$nextTick(()=>this.$refs?.__input?.focus({preventScroll:!0}))})),this.__optionsEl.addEventListener("mouseover",r(o=>{!o.dataset.key||this.__activate(o.dataset.key)})),this.__optionsEl.addEventListener("mousemove",r(o=>{this.__isActive(o.dataset.key||"")||!o.dataset.key||this.__activate(o.dataset.key)})),this.__optionsEl.addEventListener("mouseout",r(()=>{this.__keepActivated||this.__deactivate()})))})},__handleInputEvents(){this.$refs.__input.addEventListener("focus",()=>{this.__startTyping()}),this.$refs.__input.addEventListener("input",i=>{i.stopPropagation(),this.__isTyping&&this.__open()}),this.$refs.__input.addEventListener("blur",()=>{this.__stopTyping()}),this.$refs.__input.addEventListener("keydown",i=>{switch(i.key){case"ArrowDown":if(i.preventDefault(),i.stopPropagation(),!this.__isOpen){this.__open();break}this.__activateNext();break;case"ArrowUp":if(i.preventDefault(),i.stopPropagation(),!this.__isOpen){this.__open();break}this.__activatePrev();break;case"Enter":i.preventDefault(),i.stopPropagation(),this.__selectActive(),this.__stopTyping(),this.__isMultiple||(this.__close(),this.__resetInput());break;default:if(this.__static)return;this.__open();break}})}}}var A="rover-input";function g(n){let t="rover-options";return{init(){return this.$data.__static=n.extractProp(this.$el,"static",!1),n.bound(this.$el,"keepActivated")&&(this.__keepActivated=!0),this.$el.dataset.slot=t},__handleClickAway(e){if(this.__static)return;let l=e.target;l.dataset.slot&&l.dataset.slot===A||this.__close()}}}var E=n=>{let t=Alpine.$data(n);return{get isOpen(){return t.__isOpen},get collection(){return t.collection},onOpen(e){t.__onOpen(e)},navigator:()=>t.navigator,get input(){return queueMicrotask(()=>{this.$refs.input})},onClose(e){t.__onClose(e)},activate(e){t.collection.activate(e)},deactivate(){t.collection.deactivate()},getValueByKey(e){return t.collection.getValueByKey(e)},getActiveItem(){return t.collection.getActiveItem()},activateNext(){t.collection.activateNext()},activatePrev(){t.collection.activatePrev()},activateFirst(){t.collection.activateFirst()},activateLast(){t.collection.activateLast()},searchUsing(e){return t.collection.search(e)},getKeyByIndex(e){return t.collection.getKeyByIndex(e)}}};var R=n=>({activate(t){n.collection.activate(t)},deactivate(){n.collection.deactivate()},getValueByKey(t){return n.collection.getValueByKey(t)},getActiveItem(){return n.collection.getActiveItem()},activateNext(){n.collection.activateNext()},activatePrev(){n.collection.activatePrev()},activateFirst(){n.collection.activateFirst()},activateLast(){n.collection.activateLast()},searchUsing(t){return n.collection.search(t)},getKeyByIndex(t){return n.collection.getKeyByIndex(t)}});var O=n=>({isOpen(){return n.__isOpen},open(){n.__open()},close(){n.__close()},isStatic(){return n.__static}});function x(n){n.magic("rover",t=>{let e=n.findClosest(t,l=>l.hasAttribute("x-rover"));if(!e)throw"No x-rover directive found, this magic meant to be used under x-rover root context...";return E(e)}),n.magic("roverOption",t=>{let e=n.findClosest(t,i=>i.hasAttribute("x-rover:option"));if(!e)throw"No x-rover:option directive found, this magic meant to be used per option context...";let l=n.$data(e);return R(l)}),n.magic("roverOptions",t=>{let e=n.findClosest(t,i=>i.hasAttribute("x-option:options"));if(!e)throw"No x-rover:options directive found, this magic meant to be used per options context...";let l=n.$data(e);return O(l)})}function b(n){n.directive("rover",(s,{value:a,modifiers:p,expression:d},{Alpine:_,effect:T,evaluate:k})=>{switch(a){case null:t(_,s,T);break;case"input":e(_,s);break;case"button":o(_,s);break;case"options":l(s);break;case"option":i(_,s,d,k);break;case"group":r(_,s);break;case"loading":c(_,s,p);break;case"separator":h(_,s);break;case"empty":u(_,s);break;default:console.error("invalid x-rover value",a,"use input, button, option, options, group or leave mepty for root level instead");break}}).before("data"),x(n);function t(s,a,p){s.bind(a,{"x-data"(){return{...y({el:a,effect:p})}}})}function e(s,a){s.bind(a,{"x-ref":"__input","x-model":"__searchQuery","x-bind:id"(){return this.$id("rover-input")},role:"combobox",tabindex:"0","aria-autocomplete":"list","x-init"(){this.$el.dataset.slot="rover-input"}})}function l(s){n.bind(s,{"x-ref":"__options","x-bind:id"(){return this.$id("rover-options")},role:"listbox","x-on:click.away"(a){this.__handleClickAway(a)},"x-init"(){return this.$data.__static=n.extractProp(this.$el,"static",!1),n.bound(this.$el,"keepActivated")&&(this.__keepActivated=!0),this.$el.dataset.slot="rover-options"},"x-data"(){return g(n)},"x-show"(){return this.$data.__static?!0:this.$data.__isOpen}})}function i(s,a,p,d){s.bind(a,{"x-id"(){return["rover-option"]},"x-bind:id"(){return this.$id("rover-option")},role:"option","x-data"(){let _=null;return p!==""&&(_=d(p)),f(s,this.__nextOptionId(),_)}})}function r(s,a){s.bind(a,{"x-id"(){return["rover-group"]},"x-bind:id"(){return this.$id("rover-group")},role:"group","x-init"(){let p=this.$id("rover-group");this.$el.dataset.slot="rover-group",this.$el.setAttribute("aria-labelledby",`${p}-label`);let d=String(this.__nextGroupId());this.$el.dataset.key=d,this.__pushGroupToItems(d)}})}function o(s,a){s.bind(a,{"x-ref":"__button","x-bind:id"(){return this.$id("rover-button")},tabindex:"-1","aria-haspopup":"true","x-on:click"(p){this.__isDisabled||(this.__isOpen?(this.__close(),this.__resetInput()):(p.preventDefault(),this.__open()),requestAnimationFrame(()=>this.$refs.__input.focus({preventScroll:!0})))}})}function u(s,a){s.bind(a,{"x-bind:id"(){return this.$id("rover-button")},tabindex:"-1","aria-haspopup":"true","x-show"(){return Array.isArray(this.__filteredKeys)&&this.__filteredKeys.length===0&&this.__searchQuery.length>0}})}function c(s,a,p){let d=s.$data(a);p.filter(_=>_==="hide")}function h(s,a){s.bind(a,{"x-init"(){this.$el.dataset.slot="rover-separator";let p=String(this.__nextSeparatorId());this.$el.dataset.key=p,this.__pushSeparatorToItems(p),this.$el.setAttribute("role","separator"),this.$el.setAttribute("aria-orientation","horizontal")}})}}document.addEventListener("alpine:init",()=>{window.Alpine.plugin(b)});})();
