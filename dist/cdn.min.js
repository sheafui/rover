(()=>{function f(){return{init(){let n=Alpine.extractProp(this.$el,"display-value");n&&(this.__displayValue=n),this.handleEvents()},handleEvents(){this.$el.addEventListener("focus",n=>{this.__startTyping()}),this.$el.addEventListener("input",n=>{n.stopPropagation(),console.log(n),this.__isTyping&&this.__open()}),this.$el.addEventListener("blur",()=>{this.__stopTyping()}),this.$el.addEventListener("keydown",n=>{switch(n.key){case"ArrowDown":if(n.preventDefault(),n.stopPropagation(),!this.__isOpen){this.__open();break}this.__activateNext();break;case"ArrowUp":if(n.preventDefault(),n.stopPropagation(),!this.__isOpen){this.__open();break}this.__activatePrev();break;case"Enter":n.preventDefault(),n.stopPropagation(),this.__selectActive(),this.__stopTyping(),this.__isMultiple||(this.__close(),this.__resetInput());break}})}}}function v(n,i,e){let t="option";return{__uniqueKey:"option-"+i,init(){this.$el.dataset.slot=t;let a=n.extractProp(this.$el,"value");this.$el.dataset.key=this.__uniqueKey,this.$el.dataset.value=a;let s=n.extractProp(this.$el,"disabled",!1,!1);this.__add(this.__uniqueKey,a,s),this.$watch("__activedKey",l=>{l===this.__uniqueKey?this.$el.setAttribute("data-active",!0):this.$el.removeAttribute("data-active")}),this.$watch("__selectedKeys",l=>{let o=!1;this.__isMultiple?o=l.includes(this.__uniqueKey):o=l===this.__uniqueKey,o?(this.$el.setAttribute("aria-selected",!0),this.$el.setAttribute("data-selected",!0)):(this.$el.setAttribute("aria-selected",!1),this.$el.removeAttribute("data-selected"))}),this.$nextTick(()=>{s&&this.$el.setAttribute("tabindex",-1)})},destroy(){this.__forget(this.__uniqueKey)}}}var b=class{#t=[];#s=new Map;#e=-1;#_=!1;#i=null;#l=null;#a="";#n=null;#o=!1;constructor(i={},e=()=>{}){this.pending=Alpine.reactive({state:!1}),this.activeIndex=Alpine.reactive({value:null}),this.searchThreshold=i.searchThreshold??500}add(i,e,t=!1){if(this.#s.has(i))return;let a={key:i,value:e,disabled:t};this.#t.push(a),this.#s.set(i,a),this.#h()}forget(i){let e=this.#s.get(i);if(!e)return;let t=this.#t.indexOf(e);this.#s.delete(i),this.#t.splice(t,1),this.activeIndex.value===t?(this.activeIndex.value=null,this.#e=-1):this.activeIndex.value>t&&this.activeIndex.value--,this.#h()}activate(i){let e=this.get(i);if(!e||e.disabled)return;this.#r();let t=this.#t.indexOf(e);this.activeIndex.value!==t&&(this.activeIndex.value=t,this.#e=this.#i.indexOf(t))}deactivate(){this.activeIndex.value=null,this.#e=-1}isActivated(i){let e=this.get(i);return e?this.#t.indexOf(e)===this.activeIndex.value:!1}getActiveItem(){return this.activeIndex.value===null?null:this.#t[this.activeIndex.value]}activateFirst(){this.#r(),!!this.#i.length&&(this.activeIndex.value=this.#i[0],this.#e=0)}activateLast(){this.#r(),!!this.#i.length&&(this.#e=this.#i.length-1,this.activeIndex.value=this.#i[this.#e])}activateNext(){if(this.#r(),!!this.#i.length){if(this.#e===-1){this.activateFirst();return}this.#e=(this.#e+1)%this.#i.length,this.activeIndex.value=this.#i[this.#e]}}activatePrev(){if(this.#r(),!!this.#i.length){if(this.#e===-1){this.activateLast();return}this.#e=this.#e===0?this.#i.length-1:this.#e-1,this.activeIndex.value=this.#i[this.#e]}}#h(){this.#_=!0,this.#a="",this.#n=null,this.#u()}#u(){this.#o||(this.#o=!0,this.pending.state=!0,queueMicrotask(()=>{this.#r(),this.#o=!1,this.pending.state=!1}))}toggleIsPending(){this.pending.state=!this.pending.state}#r(){if(!!this.#_){this.#i=[];for(let i=0;i<this.#t.length;i++)this.#t[i].disabled||this.#i.push(i);this.#t.length>=this.searchThreshold?this.#l=this.#t.map(i=>({key:i.key,value:String(i.value).toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"")})):this.#l=null,this.#_=!1}}search(i){if(!i)return this.#a="",this.#n=null,this.#t;let e=i.toLowerCase();if(this.#a&&e.startsWith(this.#a)&&this.#n){let a=this.#n.filter(s=>String(s.value).toLowerCase().includes(e));return this.#a=e,this.#n=a,a}let t;if(this.#l){let a=e.normalize("NFD").replace(/[\u0300-\u036f]/g,"");t=[];for(let{key:s,value:l}of this.#l)l.includes(a)&&t.push(this.#s.get(s))}else t=this.#t.filter(a=>String(a.value).toLowerCase().includes(e));return this.#a=e,this.#n=t,t}get(i){return this.#s.get(i)}getValueByKey(i){return this.get(i).value}getElementByKey(i){return this.get(i).el}getKeyByIndex(i){return i==null?null:this.#t[i]?.key??null}all(){return this.#t}get size(){return this.#t.length}},g=b;function x({el:n,effect:i}){let e=new g;return{__state:null,__isOpen:!1,__isMultiple:!1,__isTyping:!1,__isLoading:!1,__uid:0,__static:!1,__keepActivated:!0,__optionsEl:void 0,__compareBy:void 0,__activedKey:void 0,__selectedKeys:void 0,__filteredKeys:null,__searchQuery:"",__add:(t,a,s)=>e.add(t,a,s),__forget:t=>e.forget(t),__activate:t=>e.activate(t),__isActive:t=>e.isActivated(t),__deactivate:()=>e.deactivate(),__getValueByKey:t=>e.getValueByKey(t),__getElementByKey:t=>e.getElementByKey(t),__activateNext:()=>e.activateNext(),__activatePrev:()=>e.activatePrev(),__activateFirst:()=>e.activateFirst(),__activateLast:()=>e.activateLast(),__isVisible(t){return this.__searchQuery===""||!this.__filteredKeys?!0:this.__filteredKeys.includes(t)},init(){i(()=>{this.__isLoading=e.pending.state}),i(()=>{this.__activedKey=e.getKeyByIndex(e.activeIndex.value)}),i(()=>{let a=e.search(this.__searchQuery).map(s=>s.key);a.length>=0?this.__filteredKeys=a:this.__filteredKeys=null,this.__activedKey&&this.__filteredKeys&&!this.__filteredKeys.includes(this.__activedKey)&&e.deactivate(),this.__isOpen&&!e.getActiveItem()&&this.__filteredKeys&&this.__filteredKeys.length&&e.activate(this.__filteredKeys[0])}),this.__isMultiple=Alpine.extractProp(n,"multiple",!1),this.__isDisabled=Alpine.extractProp(n,"disabled",!1),this.__isMultiple?this.__selectedKeys=[]:this.__selectedKeys=null,this.__compareBy=Alpine.extractProp(n,"by");let t=Alpine.extractProp(n,"default-value",this.__isMultiple?[]:null);this.__state=t,this.__registerEventsDelector()},__open(){if(this.__isOpen)return;this.__isOpen=!0;let t=this.$refs.__input;requestAnimationFrame(()=>{t.focus({preventScroll:!0}),this.__activateSelectedOrFirst()})},__activateSelectedOrFirst(t=!0){if(!(!this.__isOpen||e.getActiveItem())){if(t&&this.__selectedKeys){let s=this.__isMultiple?this.__selectedKeys[0]:this.__selectedKeys;if(s){this.__activate(s);return}}e.activateFirst()}},__close(){this.__isOpen=!1,this.__deactivate()},__handleSelection(t){let a=this.__getValueByKey(t);if(!this.__isMultiple){this.__selectedKeys=t,this.__state===a?(this.__state=null,this.__selectedKeys=null):this.__state=a,!this.__static;return}Array.isArray(this.__selectedKeys)||(this.__selectedKeys=[]),Array.isArray(this.__state)||(this.__state=[]);let s=this.__state.findIndex(o=>this.__compare(o,a)),l=this.__selectedKeys.indexOf(t);s===-1?(this.__state.push(a),this.__selectedKeys.push(t)):(this.__state.splice(s,1),this.__selectedKeys.splice(l,1))},__selectActive(){!this.__activedKey||this.__handleSelection(this.__activedKey)},__startTyping(){this.__isTyping=!0},__stopTyping(){this.__isTyping=!1},__resetInput(){let t=this.$refs.__input;if(!t)return;let a=this.__getCurrentValue();t.value=a},__getCurrentValue(){return!this.$refs.__input||!this.__state?"":typeof this.__state=="string"?this.__state:""},__compare(t,a){let s=this.__compareBy;if(s||(s=(l,o)=>Alpine.raw(l)===Alpine.raw(o)),typeof s=="string"){let l=s;s=(o,d)=>!o||typeof o!="object"||!d||typeof d!="object"?Alpine.raw(o)===Alpine.raw(d):o[l]===d[l]}return s(t,a)},__nextId(){return++this.__uid},__registerEventsDelector(){let t=s=>Alpine.findClosest(s,l=>l.dataset.slot==="option"),a=s=>function(l){l.stopPropagation();let o=t(l.target);!o||s(o)};this.$nextTick(()=>{this.__optionsEl=this.$refs.__options,!!this.__optionsEl&&(this.__optionsEl.addEventListener("click",a(s=>{this.__handleSelection(s.dataset.key),!this.__isMultiple&&!this.__static&&(this.__close(),this.__resetInput()),this.$nextTick(()=>this.$refs.__input.focus({preventScroll:!0}))})),this.__optionsEl.addEventListener("mouseover",a(s=>{this.__activate(s.dataset.key)})),this.__optionsEl.addEventListener("mousemove",a(s=>{this.__isActive()||this.__activate(s.dataset.key)})),this.__optionsEl.addEventListener("mouseout",a(()=>{this.__keepActivated||this.__deactivate()})))})}}}function y(n){n.directive("combobox",(r,{value:_,modifiers:h,expression:c},{Alpine:u,effect:p,cleanup:K})=>{switch(_){case null:i(u,r,p);break;case"input":e(u,r);break;case"button":l(u,r);break;case"options":t(r);break;case"option":a(u,r,p);break;case"options-group":s(u,r,p);break;case"loading":d(u,r,h,c);break;case"separator":m(u,r,h,c);break;case"on-empty":o(u,r,h,c);break;default:console.error("invalid x-combobox value",_,"use input, button, option, options or leave mepty for root level instead");break}});function i(r,_,h){r.bind(_,{"x-data"(){return x({el:_,effect:h})}})}function e(r,_){r.bind(_,{"x-ref":"__input","x-model":"__searchQuery","x-bind:id"(){return this.$id("combobox-input")},role:"combobox",tabindex:"0","aria-autocomplete":"list","x-data"(){return f()}})}function t(r){n.bind(r,{"x-ref":"__options","x-bind:id"(){return this.$id("combobox-options")},role:"listbox","x-init"(){return this.$data.__static=n.extractProp(this.$el,"static",!1),n.bound(this.$el,"hold")&&(this.__keepActivated=!0),this.$el.dataset.slot="options"},"x-show"(){return this.$data.__static?!0:this.$data.__isOpen}})}function a(r,_,h){r.bind(_,{"x-id"(){return["combobox-option"]},"x-bind:id"(){return this.$id("combobox-option")},role:"option","x-show"(){return this.$data.__isVisible(this.$el.dataset.key)},"x-data"(){return v(r,this.__nextId(),h)}})}function s(r,_,h){r.bind(_,{"x-id"(){return["combobox-options-group"]},"x-bind:id"(){return this.$id("combobox-options-group")},role:"option","x-show"(){return!0}})}function l(r,_){r.bind(_,{"x-ref":"__button","x-bind:id"(){return this.$id("combobox-button")},tabindex:"-1","aria-haspopup":"true","x-on:click"(h){this.__isDisabled||(this.__isOpen?(this.__close(),this.__resetInput()):(h.preventDefault(),this.__open()),requestAnimationFrame(()=>this.$refs.__input.focus({preventScroll:!0})))}})}function o(r,_){r.bind(_,{"x-bind:id"(){return this.$id("combobox-button")},tabindex:"-1","aria-haspopup":"true","x-show"(){return Array.isArray(this.__filteredKeys)&&this.__filteredKeys.length===0}})}function d(r,_,h){r.$data(_).__isLoading}function m(r,_,h){}}document.addEventListener("alpine:initializing",()=>{y(window.Alpine)});})();
