(()=>{function f(n){return{init(){let e=n.extractProp(this.$el,"disabled",!1,!1),i=n.extractProp(this.$el,"value","");this.$el.dataset.value=i,this.__add(i,e),this.$nextTick(()=>{e&&this.$el.setAttribute("tabindex","-1")})},destroy(){this.__forget(this.__uniqueKey)}}}var m=class{constructor(e={}){this.items=[];this.currentQuery="";this.currentResults=[];this.navIndex=[];this.activeNavPos=-1;this.needsReindex=!1;this.isProcessing=!1;this.pending=Alpine.reactive({state:!1}),this.activeIndex=Alpine.reactive({value:void 0}),this.searchThreshold=e.searchThreshold??500}add(e,i=!1){let t={value:e,disabled:i};this.items.push(t),this.invalidate()}forget(e){let i=this.items.findIndex(t=>t.value===e);i!==-1&&(this.items.splice(i,1),this.activeIndex.value===i?(this.activeIndex.value=void 0,this.activeNavPos=-1):this.activeIndex.value!==void 0&&this.activeIndex.value>i&&this.activeIndex.value--,this.invalidate())}invalidate(){this.needsReindex=!0,this.currentQuery="",this.currentResults=[],this.scheduleBatchAsANextMicroTask()}scheduleBatchAsANextMicroTask(){this.isProcessing||(this.isProcessing=!0,this.pending.state=!0,queueMicrotask(()=>{this.rebuildNavIndex(),this.isProcessing=!1,this.pending.state=!1}))}rebuildNavIndex(){this.navIndex=[];let e=this.currentResults.length>0?this.currentResults:this.items;for(let i=0;i<this.items.length;i++)!this.items[i]?.disabled&&e.includes(this.items[i])&&this.navIndex.push(i)}toggleIsPending(){this.pending.state=!this.pending.state}search(e){if(e==="")return this.currentQuery="",this.currentResults=[],this.rebuildNavIndex(),this.items;let i=e.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"");if(this.currentQuery&&i.startsWith(this.currentQuery)&&this.currentResults.length>0){let r=this.currentResults.filter(s=>String(s.value).toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").includes(i));return this.currentQuery=i,this.currentResults=r,this.rebuildNavIndex(),r}let t=this.items.filter(r=>String(r.value).toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").includes(i));return this.currentQuery=i,this.currentResults=t,this.rebuildNavIndex(),t}get(e){return this.items.find(i=>i.value===e)}getByIndex(e){return e==null||e===void 0?null:this.items[e]??null}all(){return this.items}get size(){return this.items.length}activate(e){let i=this.items.findIndex(r=>r.value===e);i===-1||this.items[i]?.disabled||(this.rebuildNavIndex(),this.activeIndex.value!==i&&(this.activeIndex.value=i,this.activeNavPos=this.navIndex.indexOf(i)))}deactivate(){this.activeIndex.value=void 0,this.activeNavPos=-1}isActivated(e){let i=this.items.findIndex(t=>t.value===e);return i===-1?!1:i===this.activeIndex.value}getActiveItem(){return this.activeIndex.value===void 0?null:this.items[this.activeIndex.value]??null}activateFirst(){if(this.rebuildNavIndex(),!this.navIndex.length)return;let e=this.navIndex[0];e!==void 0&&(this.activeIndex.value=e,this.activeNavPos=0)}activateLast(){if(this.rebuildNavIndex(),!this.navIndex.length)return;this.activeNavPos=this.navIndex.length-1;let e=this.navIndex[this.activeNavPos];typeof e=="number"&&(this.activeIndex.value=e)}activateNext(){if(this.rebuildNavIndex(),!this.navIndex.length)return;if(this.activeNavPos===-1){this.activateFirst();return}this.activeNavPos=(this.activeNavPos+1)%this.navIndex.length;let e=this.navIndex[this.activeNavPos];e!==void 0&&(this.activeIndex.value=e)}activatePrev(){if(this.rebuildNavIndex(),!this.navIndex.length)return;if(this.activeNavPos===-1){this.activateLast();return}this.activeNavPos=this.activeNavPos===0?this.navIndex.length-1:this.activeNavPos-1;let e=this.navIndex[this.activeNavPos];e!==void 0&&(this.activeIndex.value=e)}},y=m;function p(n,e,i,t){n.addEventListener(e,i,{signal:t.signal})}function I(n){let e=n.$el.querySelector("[x-rover\\:input]");return e||console.warn("Input element with [x-rover\\:input] not found"),{controller:new AbortController,on(i,t){if(!e)return;p(e,i,s=>{t(s,n.__activatedValue??void 0)},this.controller)},get value(){return e?e.value:""},set value(i){e&&(e.value=i)},enableDefaultInputHandlers(i=[]){!e||(i.includes("focus")||this.on("focus",()=>n.__startTyping()),i.includes("blur")||this.on("blur",()=>n.__stopTyping()),i.includes("keydown")||this.on("keydown",t=>{switch(t.key){case"ArrowDown":t.preventDefault(),t.stopPropagation(),n.__activateNext();break;case"ArrowUp":t.preventDefault(),t.stopPropagation(),n.__activatePrev();break;case"Escape":t.preventDefault(),t.stopPropagation(),requestAnimationFrame(()=>e?.focus({preventScroll:!0}));break}}))},destroy(){this.controller.abort()}}}function M(n){let e=()=>Array.from(n.$el.querySelectorAll("[x-rover\\:option]"));return{controller:new AbortController,on(i,t){n.$nextTick(()=>{let r=e();if(!r)return;let s=l=>{t(l,n.__activatedValue??void 0)};r.forEach(l=>{p(l,i,s,this.controller)})})},destroy(){this.controller.abort()}}}function A(n){let e=n.$el.querySelector("[x-rover\\:options]");e||console.warn("Options container not found");let i=t=>{if(!(!t||!(t instanceof HTMLElement)))return Alpine.findClosest(t,r=>r.hasAttribute("x-rover:option"))};return{controller:new AbortController,on(t,r){if(!e)return;p(e,t,l=>{let v=i(l.target);r(l,v,n.__activatedValue??null)},this.controller)},findClosestOption:i,enableDefaultOptionsHandlers(t=[]){Object.entries({click:s=>{!s.dataset.value||n.$nextTick(()=>n.$refs.__input?.focus({preventScroll:!0}))},mouseover:s=>{!s.dataset.value||n.__activate(s.dataset.value)},mousemove:s=>{!s.dataset.value||n.__isActive(s.dataset.value)||n.__activate(s.dataset.value)},mouseout:()=>{n.__keepActivated||n.__deactivate()}}).forEach(([s,l])=>{t.includes(s)||this.on(s,(v,u)=>{v.stopPropagation(),!!u&&l(u)})})},get all(){let t=n.__optionsEls;return t?Array.from(t):[]},destroy(){this.controller.abort()}}}function E(n){let e=n.$el.querySelector("[x-rover\\:button]");return{controller:new AbortController,on(i,t){if(!e)return;p(e,i,s=>{t(s,n.__activatedValue??void 0)},this.controller)},destroy(){this.controller.abort()}}}function g({effect:n}){let e=new y,i="rover-root";return{__collection:e,__optionsEls:void 0,__groupsEls:void 0,__isOpen:!1,__isTyping:!1,__isLoading:!1,__g_id:-1,__s_id:-1,__static:!1,__keepActivated:!0,__optionsEl:void 0,__prevActivatedValue:void 0,__activatedValue:void 0,__items:[],_x__searchQuery:"",__filteredValues:null,__filteredValuesSet:new Set,__inputManager:void 0,__optionsManager:void 0,__optionManager:void 0,__buttonManager:void 0,__add:(t,r)=>e.add(t,r),__forget:t=>e.forget(t),__activate:t=>e.activate(t),__deactivate:()=>e.deactivate(),__isActive:t=>e.isActivated(t),__getActiveItem:()=>e.getActiveItem(),__activateNext:()=>e.activateNext(),__activatePrev:()=>e.activatePrev(),__activateFirst:()=>e.activateFirst(),__activateLast:()=>e.activateLast(),__searchUsingQuery:t=>e.search(t),__getByIndex:t=>e.getByIndex(t),init(){this.$el.dataset.slot=i,this.__setupManagers(),n(()=>{this.__isLoading=e.pending.state}),n(()=>{if(String(this._x__searchQuery).length>0){let t=this.__searchUsingQuery(this._x__searchQuery).map(r=>r.value);t.length>=0&&(this.__filteredValues=t)}else this.__filteredValues=null;this.__activatedValue&&this.__filteredValues&&!this.__filteredValues.includes(this.__activatedValue)&&this.__deactivate(),this.__isOpen&&!this.__getActiveItem()&&this.__filteredValues&&this.__filteredValues.length&&this.__activate(this.__filteredValues[0])}),this.$nextTick(()=>{this.__optionsEls=Array.from(this.$el.querySelectorAll("[x-rover\\:option]")),this.__optionIndex=new Map,this.__optionsEls.forEach(t=>{let r=t.dataset.value;r&&this.__optionIndex.set(r,t)}),n(()=>{let t=this.__getByIndex(e.activeIndex.value),r=this.__activatedValue=t?.value,s=this.__filteredValues?new Set(this.__filteredValues):null;requestAnimationFrame(()=>{let l=performance.now();this.__optionsEls.forEach(u=>{let h=u.dataset.value;!h||(s!==null?u.hidden=!s.has(h):u.hidden=!1,h===r?(u.setAttribute("data-active","true"),u.setAttribute("aria-current","true"),u.scrollIntoView({block:"nearest"})):(u.removeAttribute("data-active"),u.removeAttribute("aria-current")))}),console.log(performance.now()-l),this.__prevActivatedValue=r})})})},__setupManagers(){this.__inputManager=I(this),this.__optionManager=M(this),this.__optionsManager=A(this),this.__buttonManager=E(this)},__open(){this.__isOpen||(this.__isOpen=!0,requestAnimationFrame(()=>{this.$refs?._x__input?.focus({preventScroll:!0})}))},__pushSeparatorToItems(t){this.__items.push({type:"s",id:t})},__pushGroupToItems(t){this.__items.push({type:"g",id:t})},__startTyping(){this.__isTyping=!0},__stopTyping(){this.__isTyping=!1},__nextGroupId(){return++this.__g_id},__nextSeparatorId(){return++this.__s_id},destroy(){this.__inputManager?.destroy(),this.__optionManager?.destroy(),this.__optionsManager?.destroy(),this.__buttonManager?.destroy()}}}var T=n=>{let e=Alpine.$data(n);return{get collection(){return e.__collection},get input(){return e.__inputManager},get option(){return e.__optionManager},get options(){return e.__optionsManager},get button(){return e.__buttonManager},activate(i){e.__collection.activate(i)},deactivate(){e.__collection.deactivate()},getActiveItem(){return e.__collection.getActiveItem()},activateNext(){e.__collection.activateNext()},activatePrev(){e.__collection.activatePrev()},activateFirst(){e.__collection.activateFirst()},activateLast(){e.__collection.activateLast()},searchUsing(i){return e.__collection.search(i)}}};var R=n=>({activate(e){n.__collection.activate(e)},deactivate(){n.__collection.deactivate()},getActiveItem(){return n.__collection.getActiveItem()},activateNext(){n.__collection.activateNext()},activatePrev(){n.__collection.activatePrev()},activateFirst(){n.__collection.activateFirst()},activateLast(){n.__collection.activateLast()},searchUsing(e){return n.__collection.search(e)}});var L=n=>({isOpen(){return n.__isOpen},isStatic(){return n.__static}});function x(n){n.magic("rover",e=>{let i=n.findClosest(e,t=>t.hasAttribute("x-rover"));if(!i)throw"No x-rover directive found, this magic meant to be used under x-rover root context...";return T(i)}),n.magic("roverOption",e=>{let i=n.findClosest(e,r=>r.hasAttribute("x-rover:option"));if(!i)throw"No x-rover:option directive found, this magic meant to be used per option context...";let t=n.$data(i);return R(t)}),n.magic("roverOptions",e=>{let i=n.findClosest(e,r=>r.hasAttribute("x-option:options"));if(!i)throw"No x-rover:options directive found, this magic meant to be used per options context...";let t=n.$data(i);return L(t)})}function b(n){n.directive("rover",(o,{value:a,modifiers:c},{Alpine:d,effect:_})=>{switch(a){case null:e(d,o,_);break;case"input":i(d,o);break;case"button":l(d,o);break;case"options":t(o);break;case"option":r(d,o);break;case"group":s(d,o);break;case"loading":u(d,o,c);break;case"separator":h(d,o);break;case"empty":v(d,o);break;default:console.error("invalid x-rover value",a,"use input, button, option, options, group or leave mepty for root level instead");break}}).before("data"),x(n);function e(o,a,c){o.bind(a,{"x-data"(){return{...g({effect:c})}}})}function i(o,a){o.bind(a,{"x-ref":"_x__input","x-model":"_x__searchQuery","x-bind:id"(){return this.$id("rover-input")},role:"combobox",tabindex:"0","aria-autocomplete":"list"})}function t(o){n.bind(o,{"x-ref":"__options","x-bind:id"(){return this.$id("rover-options")},role:"listbox","x-init"(){n.bound(this.$el,"keepActivated")&&(this.__keepActivated=!0)}})}function r(o,a){o.bind(a,{"x-id"(){return["rover-option"]},"x-bind:id"(){return this.$id("rover-option")},role:"option","x-data"(){return f(o)}})}function s(o,a){o.bind(a,{"x-id"(){return["rover-group"]},"x-bind:id"(){return this.$id("rover-group")},role:"group","x-init"(){let c=this.$id("rover-group");this.$el.setAttribute("aria-labelledby",`${c}-label`)}})}function l(o,a){o.bind(a,{"x-ref":"__button","x-bind:id"(){return this.$id("rover-button")},tabindex:"-1","aria-haspopup":"true"})}function v(o,a){o.bind(a,{"x-bind:id"(){return this.$id("rover-button")},tabindex:"-1","aria-haspopup":"true","x-show"(){return Array.isArray(this.__filteredValues)&&this.__filteredValues.length===0&&this._x__searchQuery.length>0}})}function u(o,a,c){let d=o.$data(a);c.filter(_=>_==="hide")}function h(o,a){o.bind(a,{"x-init"(){let c=String(this.__nextSeparatorId());this.$el.dataset.key=c,this.__pushSeparatorToItems(c),this.$el.setAttribute("role","separator"),this.$el.setAttribute("aria-orientation","horizontal")}})}}document.addEventListener("alpine:init",()=>{window.Alpine.plugin(b)});})();
