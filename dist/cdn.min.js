(()=>{function _(r){return{init(){let e=r.extractProp(this.$el,"disabled",!1,!1),t=r.extractProp(this.$el,"value",""),i=r.extractProp(this.$el,"data-search",t),n=String(i).toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").trim();this.$el.dataset.value=t,this.__add(t,n,e),this.$nextTick(()=>{e&&this.$el.setAttribute("tabindex","-1")})},destroy(){this.__forget(this.__uniqueKey)}}}var h=class{constructor(e={}){this.items=[];this.currentQuery="";this.currentResults=[];this.navIndex=[];this.activeNavPos=-1;this.needsReindex=!1;this.isProcessing=!1;this.pending=Alpine.reactive({state:!1}),this.activeIndex=Alpine.reactive({value:void 0}),this.searchThreshold=e.searchThreshold??500}add(e,t,i=!1){let n={value:e,disabled:i,searchable:t};this.items.push(n),this.invalidate()}forget(e){let t=this.items.findIndex(i=>i.value===e);t!==-1&&(this.items.splice(t,1),this.activeIndex.value===t?(this.activeIndex.value=void 0,this.activeNavPos=-1):this.activeIndex.value!==void 0&&this.activeIndex.value>t&&this.activeIndex.value--,this.invalidate())}invalidate(){this.needsReindex=!0,this.currentQuery="",this.currentResults=[],this.scheduleBatchAsANextMicroTask()}scheduleBatchAsANextMicroTask(){this.isProcessing||(this.isProcessing=!0,this.pending.state=!0,queueMicrotask(()=>{this.rebuildNavIndex(),this.isProcessing=!1,this.pending.state=!1}))}rebuildNavIndex(){this.navIndex=[];let e=this.currentResults.length>0?this.currentResults:this.items;for(let t=0;t<this.items.length;t++)!this.items[t]?.disabled&&e.includes(this.items[t])&&this.navIndex.push(t)}toggleIsPending(){this.pending.state=!this.pending.state}search(e){if(e==="")return this.currentQuery="",this.currentResults=[],this.rebuildNavIndex(),this.items;let t=e.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"");if(this.currentQuery&&t.startsWith(this.currentQuery)&&this.currentResults.length>0){let n=this.currentResults.filter(a=>a.searchable.includes(t));return this.currentQuery=t,this.currentResults=n,this.rebuildNavIndex(),n}let i=this.items.filter(n=>n.searchable.includes(t));return this.currentQuery=t,this.currentResults=i,this.rebuildNavIndex(),i}get(e){return this.items.find(t=>t.value===e)}getByIndex(e){return e==null||e===void 0?null:this.items[e]??null}all(){return this.items}get size(){return this.items.length}activate(e){let t=this.items.findIndex(n=>n.value===e);t===-1||this.items[t]?.disabled||(this.rebuildNavIndex(),this.activeIndex.value!==t&&(this.activeIndex.value=t,this.activeNavPos=this.navIndex.indexOf(t)))}deactivate(){this.activeIndex.value=void 0,this.activeNavPos=-1}isActivated(e){let t=this.items.findIndex(i=>i.value===e);return t===-1?!1:t===this.activeIndex.value}getActiveItem(){return this.activeIndex.value===void 0?null:this.items[this.activeIndex.value]??null}activateFirst(){if(this.rebuildNavIndex(),!this.navIndex.length)return;let e=this.navIndex[0];e!==void 0&&(this.activeIndex.value=e,this.activeNavPos=0)}activateLast(){if(this.rebuildNavIndex(),!this.navIndex.length)return;this.activeNavPos=this.navIndex.length-1;let e=this.navIndex[this.activeNavPos];typeof e=="number"&&(this.activeIndex.value=e)}activateNext(){if(this.rebuildNavIndex(),!this.navIndex.length)return;if(this.activeNavPos===-1){this.activateFirst();return}this.activeNavPos=(this.activeNavPos+1)%this.navIndex.length;let e=this.navIndex[this.activeNavPos];e!==void 0&&(this.activeIndex.value=e)}activatePrev(){if(this.rebuildNavIndex(),!this.navIndex.length)return;if(this.activeNavPos===-1){this.activateLast();return}this.activeNavPos=this.activeNavPos===0?this.navIndex.length-1:this.activeNavPos-1;let e=this.navIndex[this.activeNavPos];e!==void 0&&(this.activeIndex.value=e)}activateByKey(e){if(!e)return;let t=e.toLowerCase(),i=this.items.find(n=>!n.disabled&&n.value.toLowerCase().startsWith(t));i&&this.activate(i.value)}},x=h;function p(r,e,t,i){r.addEventListener(e,t,{signal:i.signal})}function b(r){let e=r.$root.querySelector("[x-rover\\:input]"),t=()=>e?!0:(console.warn("Input element with [x-rover\\:input] not found"),!1);return{controller:new AbortController,on(i,n){if(!t())return;p(e,i,o=>{n(o,r.__activatedValue??void 0)},this.controller)},get value(){return e?e.value:""},set value(i){e&&(e.value=i)},focus(i=!0){requestAnimationFrame(()=>e?.focus({preventScroll:i}))},enableDefaultInputHandlers(i=[]){!t()||(i.includes("focus")||this.on("focus",()=>r.__startTyping()),i.includes("blur")||this.on("blur",()=>r.__stopTyping()),i.includes("keydown")||this.on("keydown",n=>{switch(n.key){case"ArrowDown":n.preventDefault(),n.stopPropagation(),r.__activateNext();break;case"ArrowUp":n.preventDefault(),n.stopPropagation(),r.__activatePrev();break;case"Escape":n.preventDefault(),n.stopPropagation(),requestAnimationFrame(()=>this.focus(!0));break;case"Home":n.preventDefault(),r.__activateFirst();break;case"End":n.preventDefault(),r.__activateLast();break;case"Tab":r.__stopTyping();break}}))},destroy(){this.controller.abort()}}}function y(r){let e=()=>Array.from(r.$el.querySelectorAll("[x-rover\\:option]"));return{controller:new AbortController,on(t,i){r.$nextTick(()=>{let n=e();if(!n)return;let a=o=>{i(o,r.__activatedValue??void 0)};n.forEach(o=>{p(o,t,a,this.controller)})})},destroy(){this.controller.abort()}}}function I(r){let e=r.$el.querySelector("[x-rover\\:options]");e||console.warn("Options container not found");let t=i=>{if(!(!i||!(i instanceof HTMLElement)))return Alpine.findClosest(i,n=>n.hasAttribute("x-rover:option"))};return{controller:new AbortController,on(i,n){if(!e)return;p(e,i,o=>{let u=t(o.target);n(o,u,r.__activatedValue??null)},this.controller)},findClosestOption:t,enableDefaultOptionsHandlers(i=[]){!e||(e.tabIndex=0,i.includes("mouseover")||this.on("mouseover",(n,a)=>{!a?.dataset.value||r.__activate(a.dataset.value)}),i.includes("mousemove")||this.on("mousemove",(n,a)=>{!a?.dataset.value||r.__isActive(a.dataset.value)||r.__activate(a.dataset.value)}),i.includes("mouseout")||this.on("mouseout",()=>{r.__keepActivated||r.__deactivate()}),i.includes("keydown")||this.on("keydown",n=>{switch(n.stopPropagation(),n.key){case"ArrowDown":n.preventDefault(),r.__activateNext();break;case"ArrowUp":n.preventDefault(),r.__activatePrev();break;case"Home":n.preventDefault(),r.__activateFirst();break;case"End":n.preventDefault(),r.__activateLast();break;case"Escape":n.preventDefault(),r.__deactivate();break;case"Tab":r.__deactivate();break}}))},get all(){let i=r.__optionsEls;return i?Array.from(i):[]},destroy(){this.controller.abort()}}}function A(r){let e=r.$el.querySelector("[x-rover\\:button]");return{controller:new AbortController,on(t,i){if(!e)return;p(e,t,a=>{i(a,r.__activatedValue??void 0)},this.controller)},destroy(){this.controller.abort()}}}function f({effect:r}){let e=new x;return{__collection:e,__optionsEls:void 0,__groupsEls:void 0,__optionIndex:void 0,__isOpen:!1,__isTyping:!1,__isLoading:!1,__g_id:-1,__s_id:-1,__static:!1,__keepActivated:!0,__optionsEl:void 0,__prevActivatedValue:void 0,__activatedValue:void 0,__items:[],_x__searchQuery:"",__filteredValues:null,__prevVisibleArray:null,__prevActiveValue:void 0,__effectRAF:null,__inputManager:void 0,__optionsManager:void 0,__optionManager:void 0,__buttonManager:void 0,__add:(t,i,n)=>e.add(t,i,n),__forget:t=>e.forget(t),__activate:t=>e.activate(t),__deactivate:()=>e.deactivate(),__isActive:t=>e.isActivated(t),__getActiveItem:()=>e.getActiveItem(),__activateNext:()=>e.activateNext(),__activatePrev:()=>e.activatePrev(),__activateFirst:()=>e.activateFirst(),__activateLast:()=>e.activateLast(),__searchUsingQuery:t=>e.search(t),__getByIndex:t=>e.getByIndex(t),init(){this.__setupManagers(),r(()=>{this.__isLoading=e.pending.state}),this.$watch("_x__searchQuery",t=>{if(t.length>0){let i=this.__searchUsingQuery(t).map(o=>o.value),n=this.__filteredValues;(!n||n.length!==i.length||i.some((o,u)=>o!==n[u]))&&(this.__filteredValues=i)}else this.__filteredValues!==null&&(this.__filteredValues=null);this.__activatedValue&&this.__filteredValues&&!this.__filteredValues.includes(this.__activatedValue)&&this.__deactivate(),!this.__getActiveItem()&&this.__filteredValues&&this.__filteredValues.length&&this.__activate(this.__filteredValues[0])}),this.$nextTick(()=>{this.__optionsEls=Array.from(this.$el.querySelectorAll("[x-rover\\:option]")),this.__optionIndex=new Map,this.__optionsEls.forEach(t=>{let i=t.dataset.value;i&&this.__optionIndex.set(i,t)}),r(()=>{let t=this.__getByIndex(e.activeIndex.value),i=this.__activatedValue=t?.value,n=this.__filteredValues;requestAnimationFrame(()=>{this.__patchItemsVisibility(n),this.__patchItemsActivity(i),this.__handleSeparatorsVisibility(),this.__handleGroupsVisibility()})})})},__handleGroupsVisibility(){},__handleSeparatorsVisibility(){},__patchItemsVisibility(t){if(!this.__optionsEls||!this.__optionIndex)return;let i=this.__prevVisibleArray;if(t===i)return;if(t===null){if(i===null)return;this.__optionsEls.forEach(o=>{o.style.display=""}),this.__prevVisibleArray=null;return}let n=new Set(t),a=i?new Set(i):null;if(a===null){this.__optionsEls.forEach(o=>{let u=o.dataset.value;if(!u)return;let v=!n.has(u);o.style.display!==(v?"none":"")&&(o.style.display=v?"none":"")}),this.__prevVisibleArray=t;return}for(let o of a)if(!n.has(o)){let u=this.__optionIndex.get(o);u&&(u.style.display="none")}for(let o of n)if(!a.has(o)){let u=this.__optionIndex.get(o);u&&(u.style.display="")}this.__prevVisibleArray=t},__patchItemsActivity(t){let i=this.__prevActiveValue;if(i!==t){if(i){let n=this.__optionIndex.get(i);n&&(n.removeAttribute("data-active"),n.removeAttribute("aria-current"))}if(t){let n=this.__optionIndex.get(t);n&&(n.setAttribute("data-active","true"),n.setAttribute("aria-current","true"),requestAnimationFrame(()=>{n.scrollIntoView({block:"nearest"})}))}this.__prevActiveValue=t}},__setupManagers(){this.__inputManager=b(this),this.__optionManager=y(this),this.__optionsManager=I(this),this.__buttonManager=A(this)},__open(){this.__isOpen||(this.__isOpen=!0,requestAnimationFrame(()=>{this.$refs?._x__input?.focus({preventScroll:!0})}))},__pushSeparatorToItems(t){this.__items.push({type:"s",id:t})},__pushGroupToItems(t){this.__items.push({type:"g",id:t})},__startTyping(){this.__isTyping=!0},__stopTyping(){this.__isTyping=!1},__nextGroupId(){return++this.__g_id},__nextSeparatorId(){return++this.__s_id},destroy(){this.__inputManager?.destroy(),this.__optionManager?.destroy(),this.__optionsManager?.destroy(),this.__buttonManager?.destroy()}}}var M=r=>{let e=Alpine.$data(r);return{get collection(){return e.__collection},get input(){return e.__inputManager},get option(){return e.__optionManager},get options(){return e.__optionsManager},get button(){return e.__buttonManager},get isLoading(){return e.__isLoading},get inputEl(){return e.$root.querySelector("[x-rover\\:input]")},reindex(){},getOptionElByValue(t){return e.__optionIndex?.get(t)},activate(t){e.__collection.activate(t)},deactivate(){e.__collection.deactivate()},getActiveItem(){return e.__collection.getActiveItem()},activateNext(){e.__collection.activateNext()},activatePrev(){e.__collection.activatePrev()},activateFirst(){e.__collection.activateFirst()},activateLast(){e.__collection.activateLast()},activateByKey(t){e.__collection.activateByKey(t)},searchUsing(t){return e.__collection.search(t)}}};var E=r=>({activate(e){r.__collection.activate(e)},deactivate(){r.__collection.deactivate()},getActiveItem(){return r.__collection.getActiveItem()},activateNext(){r.__collection.activateNext()},activatePrev(){r.__collection.activatePrev()},activateFirst(){r.__collection.activateFirst()},activateLast(){r.__collection.activateLast()},searchUsing(e){return r.__collection.search(e)}});var R=r=>({isOpen(){return r.__isOpen},isStatic(){return r.__static}});function m(r){r.magic("rover",e=>{let t=r.findClosest(e,i=>i.hasAttribute("x-rover"));if(!t)throw"No x-rover directive found, this magic meant to be used under x-rover root context...";return M(t)}),r.magic("roverOption",e=>{let t=r.findClosest(e,n=>n.hasAttribute("x-rover:option"));if(!t)throw"No x-rover:option directive found, this magic meant to be used per option context...";let i=r.$data(t);return E(i)}),r.magic("roverOptions",e=>{let t=r.findClosest(e,n=>n.hasAttribute("x-option:options"));if(!t)throw"No x-rover:options directive found, this magic meant to be used per options context...";let i=r.$data(t);return R(i)})}function g(r){r.directive("rover",(s,{value:l,modifiers:c},{Alpine:d,effect:L})=>{switch(l){case null:e(d,s,L);break;case"input":t(d,s);break;case"button":o(d,s);break;case"options":i(s);break;case"option":n(d,s);break;case"group":a(d,s);break;case"loading":v(d,s,c);break;case"separator":T(d,s);break;case"empty":u(d,s);break;default:console.error("invalid x-rover value",l,"use input, button, option, options, group or leave mepty for root level instead");break}}).before("data"),m(r);function e(s,l,c){s.bind(l,{"x-data"(){return{...f({effect:c})}}})}function t(s,l){s.bind(l,{"x-model":"_x__searchQuery","x-bind:id"(){return this.$id("rover-input")},role:"combobox",tabindex:"0","aria-autocomplete":"list"})}function i(s){r.bind(s,{"x-ref":"__options","x-bind:id"(){return this.$id("rover-options")},role:"listbox","x-init"(){r.bound(this.$el,"keepActivated")&&(this.__keepActivated=!0)},"x-bind:data-loading"(){return this.__isLoading}})}function n(s,l){s.bind(l,{"x-id"(){return["rover-option"]},"x-bind:id"(){return this.$id("rover-option")},role:"option","x-data"(){return _(s)}})}function a(s,l){s.bind(l,{"x-id"(){return["rover-group"]},"x-bind:id"(){return this.$id("rover-group")},role:"group","x-init"(){let c=this.$id("rover-group");this.$el.setAttribute("aria-labelledby",`${c}-label`)}})}function o(s,l){s.bind(l,{"x-ref":"__button","x-bind:id"(){return this.$id("rover-button")},tabindex:"-1","aria-haspopup":"true"})}function u(s,l){s.bind(l,{"x-bind:id"(){return this.$id("rover-button")},tabindex:"-1","aria-haspopup":"true","x-show"(){return Array.isArray(this.__filteredValues)&&this.__filteredValues.length===0&&this._x__searchQuery.length>0}})}function v(s,l,c){let d=c.includes("hide");s.bind(l,{"x-show"(){return d?!this.__isLoading:this.__isLoading},role:"status","aria-live":"polite","aria-atomic":"true"})}function T(s,l){s.bind(l,{"x-init"(){let c=String(this.__nextSeparatorId());this.$el.dataset.key=c,this.__pushSeparatorToItems(c),this.$el.setAttribute("role","separator"),this.$el.setAttribute("aria-orientation","horizontal")}})}}document.addEventListener("alpine:init",()=>{window.Alpine.plugin(g)});})();
