(()=>{function h(r){return{__value:void 0,init(){let e=r.extractProp(this.$el,"disabled",!1,!1),t=this.__value=r.extractProp(this.$el,"value",""),i=r.extractProp(this.$el,"data-label",""),n=r.extractProp(this.$el,"data-search",t),a=String(n).toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").trim();this.$el.dataset.value=t,this.__add(t,i,a,e),this.$nextTick(()=>{e&&this.$el.setAttribute("tabindex","-1")})},destroy(){this.__forget(this.__value)}}}var _=class{constructor(e){this.itemsMap=new Map;this.VALUES_IN_DOM_ORDER=[];this.currentQuery="";this.currentResults=[];this.navIndex=[];this._navPosMap=new Map;this._navDirty=!1;this._flushQueued=!1;this.typedBuffer="";this.bufferResetTimeout=null;this.bufferDelay=500;this.pending=Alpine.reactive({value:!1}),this.activatedValue=Alpine.reactive({value:null}),this.searchThreshold=e.searchThreshold??500}add(e,t,i,n=!1){this.itemsMap.has(e)||(this.itemsMap.set(e,{value:e,label:t,searchable:i,disabled:n}),this._markDirty())}forget(e){let t=this.itemsMap.get(e);if(!t)return;this.itemsMap.delete(e);let i=this.currentResults.indexOf(t);i!==-1&&this.currentResults.splice(i,1),this.activatedValue.value===e&&(this.activatedValue.value=null),this._markDirty()}static _normalize(e){let t=e.toLowerCase();return/[^\u0000-\u007f]/.test(t)?t.normalize("NFD").replace(/[\u0300-\u036f]/g,""):t}search(e){let t=_._normalize(e),n=this.currentQuery&&t.startsWith(this.currentQuery)&&this.currentResults.length?this.currentResults:Array.from(this.itemsMap.values()),a=[],s=[];for(let l of n){let v=l.searchable;v.startsWith(t)?a.push(l):v.includes(t)&&s.push(l)}return this.currentQuery=t,this.currentResults=a.length||s.length?a.concat(s):[],this._markDirty(),this.currentResults}reset(){this.currentQuery="",this.currentResults=[],this._markDirty()}get(e){return this.itemsMap.get(e)}getActiveItem(){return this.activatedValue.value?this.itemsMap.get(this.activatedValue.value)??null:null}getAllValues(){return this.VALUES_IN_DOM_ORDER}get size(){return this.itemsMap.size}_markDirty(){this._navDirty=!0,this._flushQueued||(this._flushQueued=!0,queueMicrotask(()=>{this._flushQueued=!1,this._navDirty&&this._rebuildNavIndex()}))}_ensureNavIndex(){this._navDirty&&this._rebuildNavIndex()}_rebuildNavIndex(){let e=this.currentResults.length?new Set(this.currentResults):null,t=[];for(let i of this.VALUES_IN_DOM_ORDER){let n=this.itemsMap.get(i);!n||n.disabled||e!==null&&!e.has(n)||t.push(i)}this.navIndex=t,this._navPosMap=new Map(t.map((i,n)=>[i,n])),this._navDirty=!1}setValuesInDomOrder(e){this.VALUES_IN_DOM_ORDER=e,this._navDirty=!0,this._rebuildNavIndex()}activate(e){this._ensureNavIndex();let t=this.itemsMap.get(e);!t||t.disabled||this.activatedValue.value!==e&&(this.activatedValue.value=e)}deactivate(){this.activatedValue.value=null}isActivated(e){return this.activatedValue.value===e}_setActiveByIndex(e){let t=this.navIndex[e];t!==void 0&&(this.activatedValue.value=t)}activateFirst(){this._ensureNavIndex(),!!this.navIndex.length&&this._setActiveByIndex(0)}activateLast(){this._ensureNavIndex(),!!this.navIndex.length&&this._setActiveByIndex(this.navIndex.length-1)}activateNext(){if(this._ensureNavIndex(),!this.navIndex.length)return;let e=this.activatedValue.value!==null?this._navPosMap.get(this.activatedValue.value)??-1:-1;this._setActiveByIndex(e===-1?0:(e+1)%this.navIndex.length)}activatePrev(){if(this._ensureNavIndex(),!this.navIndex.length)return;let e=this.activatedValue.value!==null?this._navPosMap.get(this.activatedValue.value)??-1:-1;this._setActiveByIndex(e<=0?this.navIndex.length-1:e-1)}activateByKey(e){if(this._ensureNavIndex(),this.typedBuffer+=e.toLowerCase(),this.bufferResetTimeout&&clearTimeout(this.bufferResetTimeout),this.bufferResetTimeout=setTimeout(()=>this.typedBuffer="",this.bufferDelay),!this.navIndex.length)return;let t=this.activatedValue.value!==null?this._navPosMap.get(this.activatedValue.value)??-1:-1,i=t===-1?0:(t+1)%this.navIndex.length,n=this.navIndex.length;for(let a=0;a<n;a++){let s=this.navIndex[(i+a)%n],l=this.itemsMap.get(s);if(l&&l.searchable.startsWith(this.typedBuffer)){this.activatedValue.value=s;break}}}},b=_;function d(r,e,t,i){r.addEventListener(e,t,{signal:i.signal})}function y(r){let e=r.$root.querySelector("[x-rover\\:input]"),t=()=>e?!0:(console.warn("Input element with [x-rover\\:input] not found"),!1);return{controller:new AbortController,on(i,n){if(!t())return;d(e,i,s=>{n(s,r.__activatedValue??void 0)},this.controller)},get value(){return e?e.value:""},set value(i){e&&(e.value=i)},focus(i=!0){requestAnimationFrame(()=>e?.focus({preventScroll:i}))},enableDefaultInputHandlers(i=[]){!t()||(i.includes("focus")||this.on("focus",()=>r.__startTyping()),i.includes("blur")||this.on("blur",()=>r.__stopTyping()),i.includes("keydown")||this.on("keydown",n=>{switch(n.key){case"ArrowDown":n.preventDefault(),n.stopPropagation(),r.__activateNext();break;case"ArrowUp":n.preventDefault(),n.stopPropagation(),r.__activatePrev();break;case"Escape":n.preventDefault(),n.stopPropagation(),requestAnimationFrame(()=>this.focus(!0));break;case"Home":n.preventDefault(),r.__activateFirst();break;case"End":n.preventDefault(),r.__activateLast();break;case"Tab":r.__stopTyping();break}}))},get el(){return e},destroy(){this.controller.abort()}}}function x(r){let e=()=>Array.from(r.$el.querySelectorAll("[x-rover\\:option]"));return{controller:new AbortController,on(t,i){r.$nextTick(()=>{let n=e();if(!n)return;let a=s=>{i(s,r.__activatedValue??void 0)};n.forEach(s=>{d(s,t,a,this.controller)})})},destroy(){this.controller.abort()}}}function M(r){let e=r.$el.querySelector("[x-rover\\:options]");e||console.warn("Options container not found");let t=i=>{if(!(!i||!(i instanceof HTMLElement)))return Alpine.findClosest(i,n=>n.hasAttribute("x-rover:option"))};return{controller:new AbortController,on(i,n){if(!e)return;d(e,i,s=>{let l=t(s.target);n(s,l,r.__activatedValue??null)},this.controller)},findClosestOption:t,enableDefaultOptionsHandlers(i=[]){!e||(e.tabIndex=0,i.includes("mouseover")||this.on("mouseover",(n,a)=>{!a?.dataset.value||r.__activate(a.dataset.value)}),i.includes("mousemove")||this.on("mousemove",(n,a)=>{!a?.dataset.value||r.__isActive(a.dataset.value)||r.__activate(a.dataset.value)}),i.includes("mouseout")||this.on("mouseout",()=>{r.__keepActivated||r.__deactivate()}),i.includes("keydown")||this.on("keydown",n=>{switch(n.stopPropagation(),n.key){case"ArrowDown":n.preventDefault(),r.__activateNext();break;case"ArrowUp":n.preventDefault(),r.__activatePrev();break;case"Home":n.preventDefault(),r.__activateFirst();break;case"End":n.preventDefault(),r.__activateLast();break;case"Escape":n.preventDefault(),r.__deactivate();break;case"Tab":r.__deactivate();break}}))},get all(){let i=r.__optionsEls;return i?Array.from(i):[]},flush(){r.__flush()},destroy(){this.controller.abort()}}}function I(r){let e=r.$el.querySelector("[x-rover\\:button]");return{controller:new AbortController,on(t,i){if(!e)return;d(e,t,a=>{i(a,r.__activatedValue??void 0)},this.controller)},destroy(){this.controller.abort()}}}function f({effect:r}){let e=new b({preventDuplication:!0});return{__collection:e,__optionsEls:void 0,__groupsEls:void 0,__optionIndex:void 0,__isOpen:!1,__isTyping:!1,__isLoading:!1,__g_id:-1,__s_id:-1,__static:!1,__keepActivated:!0,__optionsEl:void 0,__prevActivatedValue:void 0,__activatedValue:void 0,__items:[],__filteredValues:null,__prevVisibleArray:null,__prevActiveValue:void 0,__externalQuery:null,__effectRAF:null,__inputManager:void 0,__optionsManager:void 0,__optionManager:void 0,__buttonManager:void 0,__add:(t,i,n,a)=>e.add(t,i,n,a),__forget:t=>e.forget(t),__activate:t=>e.activate(t),__deactivate:()=>e.deactivate(),__isActive:t=>e.isActivated(t),__getActiveItem:()=>e.getActiveItem(),__activateNext:()=>e.activateNext(),__activatePrev:()=>e.activatePrev(),__activateFirst:()=>e.activateFirst(),__activateLast:()=>e.activateLast(),__searchUsingQuery:t=>e.search(t),__getItemByValue:t=>e.get(t),__getLabelByValue(t){return this.__getItemByValue(t)?.label},__getSearchableByValue(t){return this.__getItemByValue(t)?.searchable},__getDisabledByValue(t){return this.__getItemByValue(t)?.disabled},init(){this.__setupManagers(),r(()=>{this.__isLoading=e.pending.value}),this.__inputManager.on("input",t=>{let i=t?.target;if(!(i._x_model?.get()!==void 0)){let s=i.value;s.length>0?this.__filteredValues=this.__searchUsingQuery(s).map(l=>l.value):(this.__filteredValues=null,e.reset())}let a=this.__filteredValues??this.__collection.getAllValues();this.__activatedValue&&!a.includes(this.__activatedValue)&&this.__deactivate(),this.__collection.getActiveItem()||this.__collection.activateFirst()}),this.$nextTick(()=>{this.__buildOptions(),this.__setValuesInDomOrder(),r(()=>{let t=e.getActiveItem(),i=this.__activatedValue=t?.value,n=this.__filteredValues;requestAnimationFrame(()=>{this.patchItemsVisibility(n),this.patchSeparatorVisibility(n),this.patchItemsActivity(i)})})})},patchItemsVisibility(t){if(!this.__optionsEls||!this.__optionIndex)return;let i=this.__prevVisibleArray;if(t===i)return;if(t===null){if(i===null)return;this.__optionsEls.forEach(s=>{s.style.display=""}),this.__prevVisibleArray=null;return}let n=new Set(t),a=i?new Set(i):null;if(a===null){this.__optionsEls.forEach(s=>{let l=s.dataset.value;if(!l)return;let v=!n.has(l);s.style.display!==(v?"none":"")&&(s.style.display=v?"none":"")}),this.__prevVisibleArray=t;return}for(let s of a)if(!n.has(s)){let l=this.__optionIndex.get(s);l&&(l.style.display="none")}for(let s of n)if(!a.has(s)){let l=this.__optionIndex.get(s);l&&(l.style.display="")}this.__prevVisibleArray=t},patchItemsActivity(t){let i=this.__prevActiveValue;if(i!==t){if(i){let n=this.__optionIndex.get(i);n&&(n.removeAttribute("data-active"),n.removeAttribute("aria-current"))}if(t){let n=this.__optionIndex.get(t);n&&(n.setAttribute("data-active","true"),n.setAttribute("aria-current","true"),requestAnimationFrame(()=>{n.scrollIntoView({block:"nearest"})}))}this.__prevActiveValue=t}},patchSeparatorVisibility(t){let i=this.$el.querySelectorAll("[x-rover\\:separator]");if(!i.length)return;let n=t!==null;i.forEach(a=>{a.style.display=n?"none":""})},__flush(){this.__buildOptions(),this.__setValuesInDomOrder()},__setValuesInDomOrder(){let t=this.__optionsEls.map(i=>i.dataset.value);e.setValuesInDomOrder(t)},__buildOptions(){this.__optionsEls=Array.from(this.$el.querySelectorAll("[x-rover\\:option]")),this.__optionIndex=new Map,this.__optionsEls.forEach(t=>{let i=t.dataset.value;i&&this.__optionIndex.set(i,t)})},__setupManagers(){this.__inputManager=y(this),this.__optionManager=x(this),this.__optionsManager=M(this),this.__buttonManager=I(this)},__open(){this.__isOpen||(this.__isOpen=!0,requestAnimationFrame(()=>{this.$refs?._x__input?.focus({preventScroll:!0})}))},__startTyping(){this.__isTyping=!0},__stopTyping(){this.__isTyping=!1},__getActiveItemEl(){let t=e.getActiveItem()?.value;if(!!t)return this.__optionIndex?.get(t)},destroy(){this.__inputManager?.destroy(),this.__optionManager?.destroy(),this.__optionsManager?.destroy(),this.__buttonManager?.destroy(),this.cleanInjectedStyles()},cleanInjectedStyles(){let t=document.getElementById("rover-group-styles");!t||t.remove()}}}var A=r=>{let e=Alpine.$data(r);return{get collection(){return e.__collection},get input(){return e.__inputManager},get option(){return e.__optionManager},get options(){return e.__optionsManager},get button(){return e.__buttonManager},get isLoading(){return e.__isLoading},get inputEl(){return e.$root.querySelector("[x-rover\\:input]")},getActiveItemEl(){return e.__getActiveItemEl()},getItemByValue(t){return e.__getItemByValue(t)},getLabel(t){return e.__getLabelByValue(t)},isDisabled(t){return e.__getDisabledByValue(t)},getSearchable(t){return e.__getSearchableByValue(t)},getActiveItemId(){return this.getActiveItemEl()?.id},reIndex(){},getOptionElByValue(t){return e.__optionIndex?.get(t)},activate(t){e.__collection.activate(t)},deactivate(){e.__collection.deactivate()},getActiveItem(){return e.__collection.getActiveItem()},activateNext(){e.__collection.activateNext()},activatePrev(){e.__collection.activatePrev()},activateFirst(){e.__collection.activateFirst()},activateLast(){e.__collection.activateLast()},activateByKey(t){e.__collection.activateByKey(t)},searchUsing(t){return e.__collection.search(t)},reconcileDom(){this.options.flush(),this.activateFirst()}}};var E=r=>({activate(e){r.__collection.activate(e)},deactivate(){r.__collection.deactivate()},getActiveItem(){return r.__collection.getActiveItem()},activateNext(){r.__collection.activateNext()},activatePrev(){r.__collection.activatePrev()},activateFirst(){r.__collection.activateFirst()},activateLast(){r.__collection.activateLast()},searchUsing(e){return r.__collection.search(e)}});var R=r=>({isOpen(){return r.__isOpen},isStatic(){return r.__static}});function m(r){r.magic("rover",e=>{let t=r.findClosest(e,i=>i.hasAttribute("x-rover"));if(!t)throw"No x-rover directive found, this magic meant to be used under x-rover root context...";return A(t)}),r.magic("roverOption",e=>{let t=r.findClosest(e,n=>n.hasAttribute("x-rover:option"));if(!t)throw"No x-rover:option directive found, this magic meant to be used per option context...";let i=r.$data(t);return E(i)}),r.magic("roverOptions",e=>{let t=r.findClosest(e,n=>n.hasAttribute("x-rover:options"));if(!t)throw"No x-rover:options directive found, this magic meant to be used per options context...";let i=r.$data(t);return R(i)})}function g(r){r.directive("rover",(o,{value:u,modifiers:p},{Alpine:c,effect:V})=>{switch(u){case null:e(c,o,V);break;case"input":t(c,o);break;case"button":s(c,o);break;case"options":i(o);break;case"option":n(c,o);break;case"group":a(c,o);break;case"loading":v(c,o,p);break;case"separator":T(c,o);break;case"empty":l(c,o);break;default:console.error("invalid x-rover value",u,"use input, button, option, options, group or leave mepty for root level instead");break}}).before("data"),m(r);function e(o,u,p){o.bind(u,{"x-data"(){return{...f({effect:p})}}})}function t(o,u){o.bind(u,{"x-bind:id"(){return this.$id("rover-input")},tabindex:"0","aria-autocomplete":"list","x-bind:aria-controls"(){return this.$id("rover-options")},"x-bind:aria-activedescendant"(){let p=this.__activatedValue;return p?this.__optionIndex?.get(p)?.id??!1:!1}})}function i(o){r.bind(o,{"x-bind:id"(){return this.$id("rover-options")},role:"listbox","aria-orientation":"vertical","x-bind:data-loading"(){return this.__isLoading}})}function n(o,u){o.bind(u,{"x-id"(){return["rover-option"]},"x-bind:id"(){return this.$id("rover-option")},role:"option","x-bind:aria-disabled"(){return this.$el.hasAttribute("disabled")?"true":"false"},"x-data"(){return h(o)}})}function a(o,u){o.bind(u,{"x-id"(){return["rover-group"]},"x-bind:id"(){return this.$id("rover-group")},role:"group","x-init"(){let p=this.$id("rover-group");if(this.$el.setAttribute("aria-labelledby",`${p}-label`),!document.getElementById("rover-group-styles")){let c=document.createElement("style");c.id="rover-group-styles",c.textContent=`
                        [x-rover\\:group]:not(:has([x-rover\\:option]:not([style*="display: none"]))) {
                            display: none;
                        }
                    `,document.head.appendChild(c)}}})}function s(o,u){o.bind(u,{"x-ref":"__button","x-bind:id"(){return this.$id("rover-button")},tabindex:"-1"})}function l(o,u){o.bind(u,{tabindex:"-1","aria-haspopup":"true","x-show"(){return Array.isArray(this.__filteredValues)&&this.__filteredValues.length===0&&this.__inputManager.value.length>0}})}function v(o,u,p){let c=p.includes("hide");o.bind(u,{"x-show"(){return c?!this.__isLoading:this.__isLoading},role:"status","aria-live":"polite","aria-atomic":"true"})}function T(o,u){o.bind(u,{"x-init"(){this.$el.setAttribute("role","separator"),this.$el.setAttribute("aria-orientation","horizontal")}})}}document.addEventListener("alpine:init",()=>{window.Alpine.plugin(g)});})();
