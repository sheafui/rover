(()=>{function c(o){return{init(){let t=o.extractProp(this.$el,"display-value","");t&&(this.__displayValue=t),this.handleEvents()},handleEvents(){this.$el.addEventListener("focus",()=>{this.__startTyping()}),this.$el.addEventListener("input",t=>{t.stopPropagation(),console.log(t),this.__isTyping&&this.__open()}),this.$el.addEventListener("blur",()=>{this.__stopTyping()}),this.$el.addEventListener("keydown",t=>{switch(t.key){case"ArrowDown":if(t.preventDefault(),t.stopPropagation(),!this.__isOpen){this.__open();break}this.__activateNext();break;case"ArrowUp":if(t.preventDefault(),t.stopPropagation(),!this.__isOpen){this.__open();break}this.__activatePrev();break;case"Enter":t.preventDefault(),t.stopPropagation(),this.__selectActive(),this.__stopTyping(),this.__isMultiple||(this.__close(),this.__resetInput());break}})}}}function f(o,t){let i="option";return{__uniqueKey:"option-"+t,init(){this.$el.dataset.slot=i;let e=o.extractProp(this.$el,"value","");this.$el.dataset.key=this.__uniqueKey,this.$el.dataset.value=e;let n=o.extractProp(this.$el,"disabled",!1,!1);this.__add(this.__uniqueKey,e,n),this.$watch("__activedKey",s=>{s===this.__uniqueKey?this.$el.setAttribute("data-active",!0):this.$el.removeAttribute("data-active")}),this.$watch("__selectedKeys",s=>{let r=!1;this.__isMultiple?r=s.includes(this.__uniqueKey):r=s===this.__uniqueKey,r?(this.$el.setAttribute("aria-selected",!0),this.$el.setAttribute("data-selected",!0)):(this.$el.setAttribute("aria-selected",!1),this.$el.removeAttribute("data-selected"))}),this.$nextTick(()=>{n&&this.$el.setAttribute("tabindex",-1)})},destroy(){this.__forget(this.__uniqueKey)}}}var v=class{constructor(t={},i=()=>{}){this.#t=[];this.#s=new Map;this.#e=-1;this.#o=!1;this.#i=null;this.#l=null;this.#n="";this.#a=null;this.#_=!1;this.pending=Alpine.reactive({state:!1}),this.activeIndex=Alpine.reactive({value:null}),this.searchThreshold=t.searchThreshold??500}#t;#s;#e;#o;#i;#l;#n;#a;#_;add(t,i,e=!1){if(this.#s.has(t))return;let n={key:t,value:i,disabled:e};this.#t.push(n),this.#s.set(t,n),this.#h()}forget(t){let i=this.#s.get(t);if(!i)return;let e=this.#t.indexOf(i);this.#s.delete(t),this.#t.splice(e,1),this.activeIndex.value===e?(this.activeIndex.value=null,this.#e=-1):this.activeIndex.value>e&&this.activeIndex.value--,this.#h()}activate(t){let i=this.get(t);if(!i||i.disabled)return;this.#r();let e=this.#t.indexOf(i);this.activeIndex.value!==e&&(this.activeIndex.value=e,this.#e=this.#i.indexOf(e))}deactivate(){this.activeIndex.value=null,this.#e=-1}isActivated(t){let i=this.get(t);return i?this.#t.indexOf(i)===this.activeIndex.value:!1}getActiveItem(){return this.activeIndex.value===null?null:this.#t[this.activeIndex.value]}activateFirst(){this.#r(),!!this.#i.length&&(this.activeIndex.value=this.#i[0],this.#e=0)}activateLast(){this.#r(),!!this.#i.length&&(this.#e=this.#i.length-1,this.activeIndex.value=this.#i[this.#e])}activateNext(){if(this.#r(),!!this.#i.length){if(this.#e===-1){this.activateFirst();return}this.#e=(this.#e+1)%this.#i.length,this.activeIndex.value=this.#i[this.#e]}}activatePrev(){if(this.#r(),!!this.#i.length){if(this.#e===-1){this.activateLast();return}this.#e=this.#e===0?this.#i.length-1:this.#e-1,this.activeIndex.value=this.#i[this.#e]}}#h(){this.#o=!0,this.#n="",this.#a=null,this.#u()}#u(){this.#_||(this.#_=!0,this.pending.state=!0,queueMicrotask(()=>{this.#r(),this.#_=!1,this.pending.state=!1}))}toggleIsPending(){this.pending.state=!this.pending.state}#r(){if(!!this.#o){this.#i=[];for(let t=0;t<this.#t.length;t++)this.#t[t].disabled||this.#i.push(t);this.#t.length>=this.searchThreshold?this.#l=this.#t.map(t=>({key:t.key,value:String(t.value).toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"")})):this.#l=null,this.#o=!1}}search(t){if(!t)return this.#n="",this.#a=null,this.#t;let i=t.toLowerCase();if(this.#n&&i.startsWith(this.#n)&&this.#a){let n=this.#a.filter(s=>String(s.value).toLowerCase().includes(i));return this.#n=i,this.#a=n,n}let e;if(this.#l){let n=i.normalize("NFD").replace(/[\u0300-\u036f]/g,"");e=[];for(let{key:s,value:r}of this.#l)r.includes(n)&&e.push(this.#s.get(s))}else e=this.#t.filter(n=>String(n.value).toLowerCase().includes(i));return this.#n=i,this.#a=e,e}get(t){return this.#s.get(t)}getValueByKey(t){return this.get(t).value}getElementByKey(t){return this.get(t).el}getKeyByIndex(t){return t==null?null:this.#t[t]?.key??null}all(){return this.#t}get size(){return this.#t.length}},x=v;function y({el:o,effect:t}){let i=new x;return{__state:null,__isOpen:!1,__isMultiple:!1,__isTyping:!1,__isLoading:!1,__uid:0,__static:!1,__keepActivated:!0,__optionsEl:void 0,__compareBy:void 0,__activedKey:void 0,__selectedKeys:void 0,__filteredKeys:null,__searchQuery:"",__add:(e,n,s)=>i.add(e,n,s),__forget:e=>i.forget(e),__activate:e=>i.activate(e),__isActive:e=>i.isActivated(e),__deactivate:()=>i.deactivate(),__getValueByKey:e=>i.getValueByKey(e),__getElementByKey:e=>i.getElementByKey(e),__activateNext:()=>i.activateNext(),__activatePrev:()=>i.activatePrev(),__activateFirst:()=>i.activateFirst(),__activateLast:()=>i.activateLast(),__isVisible(e){return this.__searchQuery===""||!this.__filteredKeys?!0:this.__filteredKeys.includes(e)},init(){t(()=>{this.__isLoading=i.pending.state}),t(()=>{this.__activedKey=i.getKeyByIndex(i.activeIndex.value)}),t(()=>{let n=i.search(this.__searchQuery).map(s=>s.key);n.length>=0?this.__filteredKeys=n:this.__filteredKeys=null,this.__activedKey&&this.__filteredKeys&&!this.__filteredKeys.includes(this.__activedKey)&&i.deactivate(),this.__isOpen&&!i.getActiveItem()&&this.__filteredKeys&&this.__filteredKeys.length&&i.activate(this.__filteredKeys[0])}),this.__isMultiple=Alpine.extractProp(o,"multiple",!1),this.__isDisabled=Alpine.extractProp(o,"disabled",!1),this.__isMultiple?this.__selectedKeys=[]:this.__selectedKeys=null,this.__compareBy=Alpine.extractProp(o,"by");let e=Alpine.extractProp(o,"default-value",this.__isMultiple?[]:null);this.__state=e,this.__registerEventsDelector()},__open(){if(this.__isOpen)return;this.__isOpen=!0;let e=this.$refs.__input;requestAnimationFrame(()=>{e.focus({preventScroll:!0}),this.__activateSelectedOrFirst()})},__activateSelectedOrFirst(e=!0){if(!(!this.__isOpen||i.getActiveItem())){if(e&&this.__selectedKeys){let s=this.__isMultiple?this.__selectedKeys[0]:this.__selectedKeys;if(s){this.__activate(s);return}}i.activateFirst()}},__close(){this.__isOpen=!1,this.__deactivate()},__handleSelection(e){let n=this.__getValueByKey(e);if(!this.__isMultiple){this.__selectedKeys=e,this.__state===n?(this.__state=null,this.__selectedKeys=null):this.__state=n,!this.__static;return}Array.isArray(this.__selectedKeys)||(this.__selectedKeys=[]),Array.isArray(this.__state)||(this.__state=[]);let s=this.__state.findIndex(_=>this.__compare(_,n)),r=this.__selectedKeys.indexOf(e);s===-1?(this.__state.push(n),this.__selectedKeys.push(e)):(this.__state.splice(s,1),this.__selectedKeys.splice(r,1))},__selectActive(){!this.__activedKey||this.__handleSelection(this.__activedKey)},__startTyping(){this.__isTyping=!0},__stopTyping(){this.__isTyping=!1},__resetInput(){let e=this.$refs.__input;if(!e)return;let n=this.__getCurrentValue();e.value=n},__getCurrentValue(){return!this.$refs.__input||!this.__state?"":typeof this.__state=="string"?this.__state:""},__compare(e,n){let s=this.__compareBy;if(s||(s=(r,_)=>Alpine.raw(r)===Alpine.raw(_)),typeof s=="string"){let r=s;s=(_,d)=>!_||typeof _!="object"||!d||typeof d!="object"?Alpine.raw(_)===Alpine.raw(d):_[r]===d[r]}return s(e,n)},__nextId(){return++this.__uid},__registerEventsDelector(){let e=s=>Alpine.findClosest(s,r=>r.dataset.slot==="option"),n=s=>function(r){r.stopPropagation();let _=e(r.target);!_||s(_)};this.$nextTick(()=>{this.__optionsEl=this.$refs.__options,!!this.__optionsEl&&(this.__optionsEl.addEventListener("click",n(s=>{this.__handleSelection(s.dataset.key),!this.__isMultiple&&!this.__static&&(this.__close(),this.__resetInput()),this.$nextTick(()=>this.$refs.__input.focus({preventScroll:!0}))})),this.__optionsEl.addEventListener("mouseover",n(s=>{this.__activate(s.dataset.key)})),this.__optionsEl.addEventListener("mousemove",n(s=>{this.__isActive()||this.__activate(s.dataset.key)})),this.__optionsEl.addEventListener("mouseout",n(()=>{this.__keepActivated||this.__deactivate()})))})}}}function b(o){o.directive("combobox",(a,{value:l,modifiers:u},{Alpine:h,effect:p})=>{switch(l){case null:t(h,a,p);break;case"input":i(h,a);break;case"button":r(h,a);break;case"options":e(a);break;case"option":n(h,a);break;case"options-group":s(h,a);break;case"loading":d(h,a,u);break;case"separator":m(h,a);break;case"empty":_(h,a);break;default:console.error("invalid x-combobox value",l,"use input, button, option, options or leave mepty for root level instead");break}}).before("bind");function t(a,l,u){a.bind(l,{"x-data"(){return y({el:l,effect:u})}})}function i(a,l){a.bind(l,{"x-ref":"__input","x-model":"__searchQuery","x-bind:id"(){return this.$id("combobox-input")},role:"combobox",tabindex:"0","aria-autocomplete":"list","x-data"(){return c(a)}})}function e(a){o.bind(a,{"x-ref":"__options","x-bind:id"(){return this.$id("combobox-options")},role:"listbox","x-init"(){return this.$data.__static=o.extractProp(this.$el,"static",!1),o.bound(this.$el,"keepActivated")&&(this.__keepActivated=!0),this.$el.dataset.slot="options"},"x-show"(){return this.$data.__static?!0:this.$data.__isOpen}})}function n(a,l){a.bind(l,{"x-id"(){return["combobox-option"]},"x-bind:id"(){return this.$id("combobox-option")},role:"option","x-show"(){return this.$data.__isVisible(this.$el.dataset.key)},"x-data"(){return f(a,this.__nextId())}})}function s(a,l){a.bind(l,{"x-id"(){return["combobox-options-group"]},"x-bind:id"(){return this.$id("combobox-options-group")},role:"option","x-show"(){return!0}})}function r(a,l){a.bind(l,{"x-ref":"__button","x-bind:id"(){return this.$id("combobox-button")},tabindex:"-1","aria-haspopup":"true","x-on:click"(u){this.__isDisabled||(this.__isOpen?(this.__close(),this.__resetInput()):(u.preventDefault(),this.__open()),requestAnimationFrame(()=>this.$refs.__input.focus({preventScroll:!0})))}})}function _(a,l){a.bind(l,{"x-bind:id"(){return this.$id("combobox-button")},tabindex:"-1","aria-haspopup":"true","x-show"(){return Array.isArray(this.__filteredKeys)&&this.__filteredKeys.length===0}})}function d(a,l,u){let h=a.$data(l);u.filter(p=>p==="hide")}function m(a,l){a.bind(l,{})}}document.addEventListener("alpine:init",()=>{window.Alpine.plugin(b)});})();
