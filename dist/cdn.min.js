(()=>{function h(n){return{__value:void 0,init(){let e=n.extractProp(this.$el,"disabled",!1,!1),t=this.__value=n.extractProp(this.$el,"value",""),i=n.extractProp(this.$el,"data-search",t),r=String(i).toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").trim();this.$el.dataset.value=t,this.__add(t,r,e),this.$nextTick(()=>{e&&this.$el.setAttribute("tabindex","-1")})},destroy(){this.__forget(this.__value)}}}var _=class{constructor(e){this.itemsMap=new Map;this.currentQuery="";this.currentResults=[];this.navIndex=[];this._navDirty=!1;this._flushQueued=!1;this.typedBuffer="";this.bufferResetTimeout=null;this.bufferDelay=500;this.pending=Alpine.reactive({value:!1}),this.activatedValue=Alpine.reactive({value:null}),this.searchThreshold=e.searchThreshold??500}add(e,t,i=!1){if(!this.itemsMap.has(e)){if(this.itemsMap.set(e,{value:e,searchable:t,disabled:i}),this.currentQuery&&this.currentResults.length){let r=this.itemsMap.get(e);!i&&r.searchable.includes(this.currentQuery)&&this.currentResults.push(r)}this._markDirty()}}forget(e){let t=this.itemsMap.get(e);if(!t)return;this.itemsMap.delete(e);let i=this.currentResults.indexOf(t);i!==-1&&this.currentResults.splice(i,1),this.activatedValue.value===e&&(this.activatedValue.value=null),this._markDirty()}static _normalize(e){return e.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"")}search(e){if(!e)return this.currentQuery="",this.currentResults=[],this._markDirty(),Array.from(this.itemsMap.values());let t=_._normalize(e),i=this.currentQuery&&t.startsWith(this.currentQuery)&&this.currentResults.length?this.currentResults:Array.from(this.itemsMap.values()),r=[],o=[];for(let a of i){let l=a.searchable;l.startsWith(t)?r.push(a):l.includes(t)&&o.push(a)}return this.currentQuery=t,this.currentResults=r.concat(o),this._markDirty(),this.currentResults}get(e){return this.itemsMap.get(e)}getActiveItem(){return this.activatedValue.value?this.itemsMap.get(this.activatedValue.value)??null:null}all(){return Array.from(this.itemsMap.values())}get size(){return this.itemsMap.size}_markDirty(){this._navDirty=!0,this._flushQueued||(this._flushQueued=!0,queueMicrotask(()=>{this._flushQueued=!1,this._navDirty&&this._rebuildNavIndex()}))}_ensureNavIndex(){this._navDirty&&this._rebuildNavIndex()}_rebuildNavIndex(){this._navDirty=!1;let e=this.currentResults.length?this.currentResults:Array.from(this.itemsMap.values());this.navIndex=e.filter(t=>!t.disabled).map(t=>t.value),this.activatedValue.value&&!this.navIndex.includes(this.activatedValue.value)||!this.activatedValue.value&&this.navIndex.length>0&&(this.activatedValue.value=null)}activate(e){this._ensureNavIndex();let t=this.itemsMap.get(e);!t||t.disabled||this.activatedValue.value!==e&&(this.activatedValue.value=e)}deactivate(){this.activatedValue.value=null}isActivated(e){return this.activatedValue.value===e}setActiveByIndex(e){e<0||e>=this.navIndex.length||(this.activatedValue.value=this.navIndex[e])}activateFirst(){this._ensureNavIndex(),!!this.navIndex.length&&this.setActiveByIndex(0)}activateLast(){this._ensureNavIndex(),!!this.navIndex.length&&this.setActiveByIndex(this.navIndex.length-1)}activateNext(){if(this._ensureNavIndex(),!this.navIndex.length)return;let e=this.activatedValue.value?this.navIndex.indexOf(this.activatedValue.value):-1,t=e===-1?0:(e+1)%this.navIndex.length;this.setActiveByIndex(t)}activatePrev(){if(this._ensureNavIndex(),!this.navIndex.length)return;let e=this.activatedValue.value?this.navIndex.indexOf(this.activatedValue.value):-1,t=e<=0?this.navIndex.length-1:e-1;this.setActiveByIndex(t)}activateByKey(e){if(this._ensureNavIndex(),this.typedBuffer+=e.toLowerCase(),this.bufferResetTimeout&&clearTimeout(this.bufferResetTimeout),this.bufferResetTimeout=setTimeout(()=>this.typedBuffer="",this.bufferDelay),!this.navIndex.length)return;let t=this.activatedValue.value?this.navIndex.indexOf(this.activatedValue.value)+1:0;for(let i=0;i<this.navIndex.length;i++){let r=(t+i)%this.navIndex.length,o=this.itemsMap.get(this.navIndex[r]);if(o&&!o.disabled&&o.searchable.startsWith(this.typedBuffer)){this.activatedValue.value=o.value;break}}}},x=_;function v(n,e,t,i){n.addEventListener(e,t,{signal:i.signal})}function y(n){let e=n.$root.querySelector("[x-rover\\:input]"),t=()=>e?!0:(console.warn("Input element with [x-rover\\:input] not found"),!1);return{controller:new AbortController,on(i,r){if(!t())return;v(e,i,a=>{r(a,n.__activatedValue??void 0)},this.controller)},get value(){return e?e.value:""},set value(i){e&&(e.value=i)},focus(i=!0){requestAnimationFrame(()=>e?.focus({preventScroll:i}))},enableDefaultInputHandlers(i=[]){!t()||(i.includes("focus")||this.on("focus",()=>n.__startTyping()),i.includes("blur")||this.on("blur",()=>n.__stopTyping()),i.includes("keydown")||this.on("keydown",r=>{switch(r.key){case"ArrowDown":r.preventDefault(),r.stopPropagation(),n.__activateNext();break;case"ArrowUp":r.preventDefault(),r.stopPropagation(),n.__activatePrev();break;case"Escape":r.preventDefault(),r.stopPropagation(),requestAnimationFrame(()=>this.focus(!0));break;case"Home":r.preventDefault(),n.__activateFirst();break;case"End":r.preventDefault(),n.__activateLast();break;case"Tab":n.__stopTyping();break}}))},destroy(){this.controller.abort()}}}function M(n){let e=()=>Array.from(n.$el.querySelectorAll("[x-rover\\:option]"));return{controller:new AbortController,on(t,i){n.$nextTick(()=>{let r=e();if(!r)return;let o=a=>{i(a,n.__activatedValue??void 0)};r.forEach(a=>{v(a,t,o,this.controller)})})},destroy(){this.controller.abort()}}}function A(n){let e=n.$el.querySelector("[x-rover\\:options]");e||console.warn("Options container not found");let t=i=>{if(!(!i||!(i instanceof HTMLElement)))return Alpine.findClosest(i,r=>r.hasAttribute("x-rover:option"))};return{controller:new AbortController,on(i,r){if(!e)return;v(e,i,a=>{let l=t(a.target);r(a,l,n.__activatedValue??null)},this.controller)},findClosestOption:t,enableDefaultOptionsHandlers(i=[]){!e||(e.tabIndex=0,i.includes("mouseover")||this.on("mouseover",(r,o)=>{!o?.dataset.value||n.__activate(o.dataset.value)}),i.includes("mousemove")||this.on("mousemove",(r,o)=>{!o?.dataset.value||n.__isActive(o.dataset.value)||n.__activate(o.dataset.value)}),i.includes("mouseout")||this.on("mouseout",()=>{n.__keepActivated||n.__deactivate()}),i.includes("keydown")||this.on("keydown",r=>{switch(r.stopPropagation(),r.key){case"ArrowDown":r.preventDefault(),n.__activateNext();break;case"ArrowUp":r.preventDefault(),n.__activatePrev();break;case"Home":r.preventDefault(),n.__activateFirst();break;case"End":r.preventDefault(),n.__activateLast();break;case"Escape":r.preventDefault(),n.__deactivate();break;case"Tab":n.__deactivate();break}}))},get all(){let i=n.__optionsEls;return i?Array.from(i):[]},destroy(){this.controller.abort()}}}function I(n){let e=n.$el.querySelector("[x-rover\\:button]");return{controller:new AbortController,on(t,i){if(!e)return;v(e,t,o=>{i(o,n.__activatedValue??void 0)},this.controller)},destroy(){this.controller.abort()}}}function f({effect:n}){let e=new x({preventDuplication:!0});return{__collection:e,__optionsEls:void 0,__groupsEls:void 0,__optionIndex:void 0,__isOpen:!1,__isTyping:!1,__isLoading:!1,__g_id:-1,__s_id:-1,__static:!1,__keepActivated:!0,__optionsEl:void 0,__prevActivatedValue:void 0,__activatedValue:void 0,__items:[],__filteredValues:null,__prevVisibleArray:null,__prevActiveValue:void 0,__externalQuery:null,__effectRAF:null,__inputManager:void 0,__optionsManager:void 0,__optionManager:void 0,__buttonManager:void 0,__add:(t,i,r)=>e.add(t,i,r),__forget:t=>e.forget(t),__activate:t=>e.activate(t),__deactivate:()=>e.deactivate(),__isActive:t=>e.isActivated(t),__getActiveItem:()=>e.getActiveItem(),__activateNext:()=>e.activateNext(),__activatePrev:()=>e.activatePrev(),__activateFirst:()=>e.activateFirst(),__activateLast:()=>e.activateLast(),__searchUsingQuery:t=>e.search(t),init(){this.__setupManagers(),n(()=>{this.__isLoading=e.pending.value}),this.__inputManager.on("input",t=>{let i=t?.target;if(!(i._x_model?.get()!==void 0)){let a=i.value;if(a.length>0){let l=this.__searchUsingQuery(a).map(s=>s.value),d=this.__filteredValues;(!d||d.length!==l.length||l.some((s,u)=>s!==d[u]))&&(this.__filteredValues=l)}else this.__filteredValues=null}let o=this.__filteredValues??this.__collection.all().map(a=>a.value);if(console.log("current values:",o),this.__activatedValue&&!o.includes(this.__activatedValue)&&this.__deactivate(),!this.__getActiveItem()){let a=this.__collection.all().find(l=>!l.disabled&&o.includes(l.value));a&&this.__activate(a.value)}}),this.$nextTick(()=>{this.__optionsEls=Array.from(this.$el.querySelectorAll("[x-rover\\:option]")),this.__optionIndex=new Map,this.__optionsEls.forEach(t=>{let i=t.dataset.value;i&&this.__optionIndex.set(i,t)}),n(()=>{let t=e.getActiveItem(),i=this.__activatedValue=t?.value,r=this.__filteredValues;requestAnimationFrame(()=>{this.patchItemsVisibility(r),this.patchItemsActivity(i)})})})},__handleGroupsVisibility(){},__handleSeparatorsVisibility(){},patchItemsVisibility(t){if(!this.__optionsEls||!this.__optionIndex)return;let i=this.__prevVisibleArray;if(t===i)return;if(t===null){if(i===null)return;this.__optionsEls.forEach(a=>{a.style.display=""}),this.__prevVisibleArray=null;return}let r=new Set(t),o=i?new Set(i):null;if(o===null){this.__optionsEls.forEach(a=>{let l=a.dataset.value;if(!l)return;let d=!r.has(l);a.style.display!==(d?"none":"")&&(a.style.display=d?"none":"")}),this.__prevVisibleArray=t;return}for(let a of o)if(!r.has(a)){let l=this.__optionIndex.get(a);l&&(l.style.display="none")}for(let a of r)if(!o.has(a)){let l=this.__optionIndex.get(a);l&&(l.style.display="")}this.__prevVisibleArray=t},patchItemsActivity(t){let i=this.__prevActiveValue;if(i!==t){if(i){let r=this.__optionIndex.get(i);r&&(r.removeAttribute("data-active"),r.removeAttribute("aria-current"))}if(t){let r=this.__optionIndex.get(t);r&&(r.setAttribute("data-active","true"),r.setAttribute("aria-current","true"),requestAnimationFrame(()=>{r.scrollIntoView({block:"nearest"})}))}this.__prevActiveValue=t}},__setupManagers(){this.__inputManager=y(this),this.__optionManager=M(this),this.__optionsManager=A(this),this.__buttonManager=I(this)},__open(){this.__isOpen||(this.__isOpen=!0,requestAnimationFrame(()=>{this.$refs?._x__input?.focus({preventScroll:!0})}))},__pushSeparatorToItems(t){this.__items.push({type:"s",id:t})},__pushGroupToItems(t){this.__items.push({type:"g",id:t})},__startTyping(){this.__isTyping=!0},__stopTyping(){this.__isTyping=!1},__nextGroupId(){return++this.__g_id},__nextSeparatorId(){return++this.__s_id},destroy(){this.__inputManager?.destroy(),this.__optionManager?.destroy(),this.__optionsManager?.destroy(),this.__buttonManager?.destroy()}}}var E=n=>{let e=Alpine.$data(n);return{get collection(){return e.__collection},get input(){return e.__inputManager},get option(){return e.__optionManager},get options(){return e.__optionsManager},get button(){return e.__buttonManager},get isLoading(){return e.__isLoading},get inputEl(){return e.$root.querySelector("[x-rover\\:input]")},reIndex(){},getOptionElByValue(t){return e.__optionIndex?.get(t)},activate(t){e.__collection.activate(t)},deactivate(){e.__collection.deactivate()},getActiveItem(){return e.__collection.getActiveItem()},activateNext(){e.__collection.activateNext()},activatePrev(){e.__collection.activatePrev()},activateFirst(){e.__collection.activateFirst()},activateLast(){e.__collection.activateLast()},activateByKey(t){e.__collection.activateByKey(t)},searchUsing(t){return e.__collection.search(t)}}};var R=n=>({activate(e){n.__collection.activate(e)},deactivate(){n.__collection.deactivate()},getActiveItem(){return n.__collection.getActiveItem()},activateNext(){n.__collection.activateNext()},activatePrev(){n.__collection.activatePrev()},activateFirst(){n.__collection.activateFirst()},activateLast(){n.__collection.activateLast()},searchUsing(e){return n.__collection.search(e)}});var T=n=>({isOpen(){return n.__isOpen},isStatic(){return n.__static}});function m(n){n.magic("rover",e=>{let t=n.findClosest(e,i=>i.hasAttribute("x-rover"));if(!t)throw"No x-rover directive found, this magic meant to be used under x-rover root context...";return E(t)}),n.magic("roverOption",e=>{let t=n.findClosest(e,r=>r.hasAttribute("x-rover:option"));if(!t)throw"No x-rover:option directive found, this magic meant to be used per option context...";let i=n.$data(t);return R(i)}),n.magic("roverOptions",e=>{let t=n.findClosest(e,r=>r.hasAttribute("x-option:options"));if(!t)throw"No x-rover:options directive found, this magic meant to be used per options context...";let i=n.$data(t);return T(i)})}function g(n){n.directive("rover",(s,{value:u,modifiers:c},{Alpine:p,effect:L})=>{switch(u){case null:e(p,s,L);break;case"input":t(p,s);break;case"button":a(p,s);break;case"options":i(s);break;case"option":r(p,s);break;case"group":o(p,s);break;case"loading":d(p,s,c);break;case"separator":b(p,s);break;case"empty":l(p,s);break;default:console.error("invalid x-rover value",u,"use input, button, option, options, group or leave mepty for root level instead");break}}).before("data"),m(n);function e(s,u,c){s.bind(u,{"x-data"(){return{...f({effect:c})}}})}function t(s,u){s.bind(u,{"x-bind:id"(){return this.$id("rover-input")},role:"combobox",tabindex:"0","aria-autocomplete":"list"})}function i(s){n.bind(s,{"x-bind:id"(){return this.$id("rover-options")},role:"listbox","x-bind:data-loading"(){return this.__isLoading}})}function r(s,u){s.bind(u,{"x-id"(){return["rover-option"]},"x-bind:id"(){return this.$id("rover-option")},role:"option","x-data"(){return h(s)}})}function o(s,u){s.bind(u,{"x-id"(){return["rover-group"]},"x-bind:id"(){return this.$id("rover-group")},role:"group","x-init"(){let c=this.$id("rover-group");this.$el.setAttribute("aria-labelledby",`${c}-label`)}})}function a(s,u){s.bind(u,{"x-ref":"__button","x-bind:id"(){return this.$id("rover-button")},tabindex:"-1","aria-haspopup":"true"})}function l(s,u){s.bind(u,{"x-bind:id"(){return this.$id("rover-button")},tabindex:"-1","aria-haspopup":"true","x-show"(){return Array.isArray(this.__filteredValues)&&this.__filteredValues.length===0&&this.__inputManager.value.length>0}})}function d(s,u,c){let p=c.includes("hide");s.bind(u,{"x-show"(){return p?!this.__isLoading:this.__isLoading},role:"status","aria-live":"polite","aria-atomic":"true"})}function b(s,u){s.bind(u,{"x-init"(){let c=String(this.__nextSeparatorId());this.$el.dataset.key=c,this.__pushSeparatorToItems(c),this.$el.setAttribute("role","separator"),this.$el.setAttribute("aria-orientation","horizontal")}})}}document.addEventListener("alpine:init",()=>{window.Alpine.plugin(g)});})();
