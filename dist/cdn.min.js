(()=>{var v="rover-option";function f(n,t,i){return{__uniqueKey:"option-"+t,__isVisible:!0,init(){this.$el.dataset.slot=v,this.$el.dataset.key=this.__uniqueKey;let e;i!==null?e=i:e=n.extractProp(this.$el,"value","");let s=n.extractProp(this.$el,"disabled",!1,!1);this.$el.dataset.value=e,this.__add(this.__uniqueKey,e,s),this.__pushOptionToItems(String(t)),this.$nextTick(()=>{s&&this.$el.setAttribute("tabindex","-1")})},destroy(){this.__forget(this.__uniqueKey)}}}var g=class{constructor(t={}){this.items=[];this.itemsMap=new Map;this.searchIndex=[];this.currentQuery="";this.currentResults=[];this.navIndex=[];this.activeNavPos=-1;this.needsReindex=!1;this.isProcessing=!1;this.pending=Alpine.reactive({state:!1}),this.activeIndex=Alpine.reactive({value:void 0}),this.searchThreshold=t.searchThreshold??500}add(t,i,e=!1){if(this.itemsMap.has(t))return;let s={key:t,value:i,disabled:e};this.items.push(s),this.itemsMap.set(t,s),this.invalidate()}forget(t){let i=this.itemsMap.get(t);if(!i)return;let e=this.items.indexOf(i);this.itemsMap.delete(t),this.items.splice(e,1),this.activeIndex.value===e?(this.activeIndex.value=void 0,this.activeNavPos=-1):this.activeIndex.value!==void 0&&this.activeIndex.value>e&&this.activeIndex.value--,this.invalidate()}invalidate(){this.needsReindex=!0,this.currentQuery="",this.currentResults=[],this.scheduleBatch()}scheduleBatch(){this.isProcessing||(this.isProcessing=!0,this.pending.state=!0,queueMicrotask(()=>{this.rebuildSearchIndex(),this.rebuildNavIndex(),this.isProcessing=!1,this.pending.state=!1}))}rebuildSearchIndex(){!this.needsReindex||(this.searchIndex=this.items.map(t=>({key:t.key,value:String(t.value).toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"")})),this.needsReindex=!1)}rebuildNavIndex(){this.navIndex=[];let t=this.currentResults.length>0?this.currentResults:this.items;for(let i=0;i<this.items.length;i++)!this.items[i]?.disabled&&t.includes(this.items[i])&&this.navIndex.push(i)}toggleIsPending(){this.pending.state=!this.pending.state}search(t){if(!t)return this.currentQuery="",this.currentResults=[],this.rebuildNavIndex(),this.items;let i=t.toLowerCase();if(this.currentQuery&&i.startsWith(this.currentQuery)&&this.currentResults.length>0){let r=this.currentResults.filter(l=>String(l.value).toLowerCase().includes(i));return this.currentQuery=i,this.currentResults=r,this.rebuildNavIndex(),r}this.rebuildSearchIndex();let e=i.normalize("NFD").replace(/[\u0300-\u036f]/g,""),s=[];for(let{key:r,value:l}of this.searchIndex)if(l.includes(e)){let u=this.itemsMap.get(r);u&&s.push(u)}return this.currentQuery=i,this.currentResults=s,this.rebuildNavIndex(),s}get(t){return this.itemsMap.get(t)}getValueByKey(t){return this.get(t)?.value}getKeyByIndex(t){return t==null||t===void 0?null:this.items[t]?.key??null}all(){return this.items}get size(){return this.items.length}activate(t){let i=this.get(t);if(!i||i.disabled)return;this.rebuildSearchIndex(),this.rebuildNavIndex();let e=this.items.indexOf(i);this.activeIndex.value!==e&&(this.activeIndex.value=e,this.activeNavPos=this.navIndex.indexOf(e))}deactivate(){this.activeIndex.value=void 0,this.activeNavPos=-1}isActivated(t){let i=this.get(t);return i?this.items.indexOf(i)===this.activeIndex.value:!1}getActiveItem(){return this.activeIndex.value===void 0?null:this.items[this.activeIndex.value]??null}activateFirst(){if(this.rebuildSearchIndex(),this.rebuildNavIndex(),!this.navIndex.length)return;let t=this.navIndex[0];t!==void 0&&(this.activeIndex.value=t,this.activeNavPos=0)}activateLast(){if(this.rebuildSearchIndex(),this.rebuildNavIndex(),!this.navIndex.length)return;this.activeNavPos=this.navIndex.length-1;let t=this.navIndex[this.activeNavPos];typeof t=="number"&&(this.activeIndex.value=t)}activateNext(){if(this.rebuildSearchIndex(),this.rebuildNavIndex(),!this.navIndex.length)return;if(this.activeNavPos===-1){this.activateFirst();return}this.activeNavPos=(this.activeNavPos+1)%this.navIndex.length;let t=this.navIndex[this.activeNavPos];t!==void 0&&(this.activeIndex.value=t)}activatePrev(){if(this.rebuildSearchIndex(),this.rebuildNavIndex(),!this.navIndex.length)return;if(this.activeNavPos===-1){this.activateLast();return}this.activeNavPos=this.activeNavPos===0?this.navIndex.length-1:this.activeNavPos-1;let t=this.navIndex[this.activeNavPos];t!==void 0&&(this.activeIndex.value=t)}},b=g;function I(n){let t=[];return{on(i,e){n.$nextTick(()=>{let s=n.$refs.__input;if(!s)return;let r=l=>{let u=n.__activatedKey??null;e(l,u)};s.addEventListener(i,r),t.push(()=>{s.removeEventListener(i,r)})})},set value(i){n.$nextTick(()=>{let e=n.$refs.__input;e&&(e.value=i)})},get value(){let i=n.$refs.__input;return i?i.value:""},registerSharedEventListerns(){},destroy(){t.forEach(i=>i())}}}function E(n){let t=[];return{on(i,e){n.$nextTick(()=>{let s=n.$refs.__input;if(!s)return;let r=l=>{let u=n.__activatedKey??null;e(l,u)};s.addEventListener(i,r),t.push(()=>{s.removeEventListener(i,r)})})},destroy(){t.forEach(i=>i())}}}var A="rover-option";function O(n){let t=[];return{on(i,e){n.$nextTick(()=>{let s=n.$refs.__options;if(!s)return;let r=l=>{let u=l.target,c=this.findClosestOption(u),h=n.__activatedKey??null;e(l,c,h)};s.addEventListener(i,r),t.push(()=>{s.removeEventListener(i,r)})})},findClosestOption(i){return Alpine.findClosest(i,e=>e.dataset.slot===A&&e.hasAttribute("x-rover:option"))},registerSharedEventListerns(){},destroy(){t.forEach(i=>i())}}}function m({effect:n}){let t=new b,i="rover-root";return{collection:t,__optionsEls:void 0,__groupsEls:void 0,__isOpen:!1,__isTyping:!1,__isLoading:!1,__o_id:-1,__g_id:-1,__s_id:-1,__static:!1,__keepActivated:!0,__optionsEl:void 0,__activatedKey:void 0,__selectedKeys:void 0,__items:[],__searchQuery:"",__filteredKeys:null,__filteredKeysSet:new Set,__inputManager:null,__optionsManager:null,__optionManager:null,__add:(e,s,r)=>t.add(e,s,r),__forget:e=>t.forget(e),__activate:e=>t.activate(e),__deactivate:()=>t.deactivate(),__isActive:e=>t.isActivated(e),__getValueByKey:e=>t.getValueByKey(e),__getActiveItem:()=>t.getActiveItem(),__activateNext:()=>t.activateNext(),__activatePrev:()=>t.activatePrev(),__activateFirst:()=>t.activateFirst(),__activateLast:()=>t.activateLast(),__searchUsingQuery:e=>t.search(e),__getKeyByIndex:e=>t.getKeyByIndex(e),__onOpenCallback:()=>{},__onOpen(e){this.__onOpenCallback=e},__onCloseCallback:()=>{},__onClose(e){this.__onCloseCallback=e},init(){this.$el.dataset.slot=i,this.__setupManagers(),this.__handleSharedInputEvents(),n(()=>{this.__isLoading=t.pending.state}),n(()=>{this.__activatedKey=this.__getKeyByIndex(t.activeIndex.value)}),n(()=>{if(String(this.__searchQuery).length>0){let e=this.__searchUsingQuery(this.__searchQuery).map(s=>s.key);e.length>=0&&(this.__filteredKeys=e)}else this.__filteredKeys=null;this.__activatedKey&&this.__filteredKeys&&!this.__filteredKeys.includes(this.__activatedKey)&&this.__deactivate(),this.__isOpen&&!this.__getActiveItem()&&this.__filteredKeys&&this.__filteredKeys.length&&this.__activate(this.__filteredKeys[0])}),this.$nextTick(()=>{this.__optionsEls=Array.from(this.$el.querySelectorAll("[data-slot=rover-option]")),this.__groupsEls=Array.from(this.$el.querySelectorAll("[data-slot=rover-group]")),n(()=>{let e=this.__activatedKey,s=this.__filteredKeys?new Set(this.__filteredKeys):null;requestAnimationFrame(()=>{this.__optionsEls.forEach(u=>{let c=u,h=c.dataset.key;!h||(s!==null?c.hidden=!s.has(h):c.hidden=!1,h===e?(c.setAttribute("data-active","true"),c.setAttribute("aria-current","true"),c.scrollIntoView({block:"nearest"})):(c.removeAttribute("data-active"),c.removeAttribute("aria-current")))}),this.__groupsEls.forEach(u=>{let c=u,h=c.querySelectorAll("[data-slot=rover-option]"),o=Array.from(h).some(a=>{let p=a;return s?s.has(p.dataset.key||""):!0});c.hidden=!o})})})}),this.$nextTick(()=>{this.$refs.__input||(this.__isOpen=!0)})},__setupManagers(){this.__inputManager=I(this),this.__optionManager=E(this),this.__optionsManager=O(this)},__open(){this.__isOpen||(this.__isOpen=!0,requestAnimationFrame(()=>{this.$refs?.__input?.focus({preventScroll:!0})}),this.__onOpenCallback())},__pushSeparatorToItems(e){this.__items.push({type:"s",key:e})},__pushGroupToItems(e){this.__items.push({type:"g",key:e})},__pushOptionToItems(e){this.__items.push({type:"o",key:e})},__close(){this.__isOpen=!1,this.__deactivate()},__startTyping(){this.__isTyping=!0},__stopTyping(){this.__isTyping=!1},__resetInput(){let e=this.$refs.__input;if(!e)return;let s=this.__getCurrentValue();e.value=s},__getCurrentValue(){return!this.$refs.__input||!this.__state?"":typeof this.__state=="string"?this.__state:""},__nextOptionId(){return++this.__o_id},__nextGroupId(){return++this.__g_id},__nextSeparatorId(){return++this.__s_id},__registerEventsDelector(){let e=r=>Alpine.findClosest(r,l=>l.dataset.slot===v),s=r=>function(l){if(l.stopPropagation(),!(l.target instanceof Element))return;let u=e(l.target);!u||r(u)};this.$nextTick(()=>{this.__optionsEl=this.$refs.__options,!!this.__optionsEl&&(this.__optionsEl.addEventListener("click",s(r=>{!r.dataset.key||this.$nextTick(()=>this.$refs?.__input?.focus({preventScroll:!0}))})),this.__optionsEl.addEventListener("mouseover",s(r=>{!r.dataset.key||this.__activate(r.dataset.key)})),this.__optionsEl.addEventListener("mousemove",s(r=>{this.__isActive(r.dataset.key||"")||!r.dataset.key||this.__activate(r.dataset.key)})),this.__optionsEl.addEventListener("mouseout",s(()=>{this.__keepActivated||this.__deactivate()})))})},__handleSharedInputEvents(){this.__inputManager.on("focus",()=>{this.__startTyping()}),this.__inputManager.on("input",()=>{this.__isTyping&&this.__open()}),this.__inputManager.on("blur",()=>{this.__stopTyping()}),this.__inputManager.on("keydown",e=>{switch(e.key){case"ArrowDown":if(e.preventDefault(),e.stopPropagation(),!this.__isOpen){this.__open();break}this.__activateNext();break;case"ArrowUp":if(e.preventDefault(),e.stopPropagation(),!this.__isOpen){this.__open();break}this.__activatePrev();break;case"Escape":e.preventDefault(),e.stopPropagation(),this.__close(),this.$nextTick(()=>this.$refs?.__input?.focus({preventScroll:!0}));break;default:break}})},destroy(){this.__inputManager?.destroy()}}}var T=n=>{let t=Alpine.$data(n);return{get isOpen(){return t.__isOpen},get collection(){return t.collection},onOpen(i){t.__onOpen(i)},get input(){return t.__inputManager},get option(){return t.__optionManager},get options(){return t.__optionsManager},onClose(i){t.__onClose(i)},activate(i){t.collection.activate(i)},deactivate(){t.collection.deactivate()},getValueByKey(i){return t.collection.getValueByKey(i)},getActiveItem(){return t.collection.getActiveItem()},activateNext(){t.collection.activateNext()},activatePrev(){t.collection.activatePrev()},activateFirst(){t.collection.activateFirst()},activateLast(){t.collection.activateLast()},searchUsing(i){return t.collection.search(i)},getKeyByIndex(i){return t.collection.getKeyByIndex(i)}}};var M=n=>({activate(t){n.collection.activate(t)},deactivate(){n.collection.deactivate()},getValueByKey(t){return n.collection.getValueByKey(t)},getActiveItem(){return n.collection.getActiveItem()},activateNext(){n.collection.activateNext()},activatePrev(){n.collection.activatePrev()},activateFirst(){n.collection.activateFirst()},activateLast(){n.collection.activateLast()},searchUsing(t){return n.collection.search(t)},getKeyByIndex(t){return n.collection.getKeyByIndex(t)}});var R=n=>({isOpen(){return n.__isOpen},open(){n.__open()},close(){n.__close()},isStatic(){return n.__static}});function x(n){n.magic("rover",t=>{let i=n.findClosest(t,e=>e.hasAttribute("x-rover"));if(!i)throw"No x-rover directive found, this magic meant to be used under x-rover root context...";return T(i)}),n.magic("roverOption",t=>{let i=n.findClosest(t,s=>s.hasAttribute("x-rover:option"));if(!i)throw"No x-rover:option directive found, this magic meant to be used per option context...";let e=n.$data(i);return M(e)}),n.magic("roverOptions",t=>{let i=n.findClosest(t,s=>s.hasAttribute("x-option:options"));if(!i)throw"No x-rover:options directive found, this magic meant to be used per options context...";let e=n.$data(i);return R(e)})}function y(n){n.directive("rover",(o,{value:a,modifiers:p,expression:_},{Alpine:d,effect:$,evaluate:L})=>{switch(a){case null:t(d,o,$);break;case"input":i(d,o);break;case"button":l(d,o);break;case"options":e(o);break;case"option":s(d,o,_,L);break;case"group":r(d,o);break;case"loading":c(d,o,p);break;case"separator":h(d,o);break;case"empty":u(d,o);break;default:console.error("invalid x-rover value",a,"use input, button, option, options, group or leave mepty for root level instead");break}}).before("data"),x(n);function t(o,a,p){o.bind(a,{"x-data"(){return{...m({effect:p})}}})}function i(o,a){o.bind(a,{"x-ref":"__input","x-model":"__searchQuery","x-bind:id"(){return this.$id("rover-input")},role:"combobox",tabindex:"0","aria-autocomplete":"list","x-init"(){this.$el.dataset.slot="rover-input"}})}function e(o){n.bind(o,{"x-ref":"__options","x-bind:id"(){return this.$id("rover-options")},role:"listbox","x-init"(){this.$data.__static=n.extractProp(this.$el,"static",!1),n.bound(this.$el,"keepActivated")&&(this.__keepActivated=!0),this.$el.dataset.slot="rover-options"},"x-show"(){return this.$data.__static?!0:this.$data.__isOpen}})}function s(o,a,p,_){o.bind(a,{"x-id"(){return["rover-option"]},"x-bind:id"(){return this.$id("rover-option")},role:"option","x-data"(){let d=null;return p!==""&&(d=_(p)),f(o,this.__nextOptionId(),d)}})}function r(o,a){o.bind(a,{"x-id"(){return["rover-group"]},"x-bind:id"(){return this.$id("rover-group")},role:"group","x-init"(){let p=this.$id("rover-group");this.$el.dataset.slot="rover-group",this.$el.setAttribute("aria-labelledby",`${p}-label`);let _=String(this.__nextGroupId());this.$el.dataset.key=_,this.__pushGroupToItems(_)}})}function l(o,a){o.bind(a,{"x-ref":"__button","x-bind:id"(){return this.$id("rover-button")},tabindex:"-1","aria-haspopup":"true","x-on:click"(p){this.__isDisabled||(this.__isOpen?(this.__close(),this.__resetInput()):(p.preventDefault(),this.__open()),requestAnimationFrame(()=>this.$refs.__input.focus({preventScroll:!0})))}})}function u(o,a){o.bind(a,{"x-bind:id"(){return this.$id("rover-button")},tabindex:"-1","aria-haspopup":"true","x-show"(){return Array.isArray(this.__filteredKeys)&&this.__filteredKeys.length===0&&this.__searchQuery.length>0}})}function c(o,a,p){let _=o.$data(a);p.filter(d=>d==="hide")}function h(o,a){o.bind(a,{"x-init"(){this.$el.dataset.slot="rover-separator";let p=String(this.__nextSeparatorId());this.$el.dataset.key=p,this.__pushSeparatorToItems(p),this.$el.setAttribute("role","separator"),this.$el.setAttribute("aria-orientation","horizontal")}})}}document.addEventListener("alpine:init",()=>{window.Alpine.plugin(y)});})();
