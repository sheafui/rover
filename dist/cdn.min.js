(()=>{function v(i){return{__value:void 0,init(){let e=i.extractProp(this.$el,"disabled",!1,!1),t=this.__value=i.extractProp(this.$el,"value",""),n=i.extractProp(this.$el,"data-search",t),r=String(n).toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").trim();this.$el.dataset.value=t,this.__add(t,r,e),this.$nextTick(()=>{e&&this.$el.setAttribute("tabindex","-1")})},destroy(){this.__forget(this.__value)}}}var f=class{constructor(e){this.items=[];this.throwOnDuplication=!1;this.pending=Alpine.reactive({value:!1}),this.activatedValue=Alpine.reactive({value:void 0}),this.throwOnDuplication=e.throwOnDuplication}add(e,t,n=!1){let r={value:e,disabled:n,searchable:t};this.itemsSet.has(e)&&(this.throwOnDuplication&&console.warn("duplicate value detected for",e),this.itemsSet.delete(e)),this.items.push(r),this.itemsSet.add(e)}forget(e){let t=this.items.findIndex(n=>n.value===e);t!==-1&&this.items.splice(t,1)}},y=f;function d(i,e,t,n){i.addEventListener(e,t,{signal:n.signal})}function x(i){let e=i.$root.querySelector("[x-rover\\:input]"),t=()=>e?!0:(console.warn("Input element with [x-rover\\:input] not found"),!1);return{controller:new AbortController,on(n,r){if(!t())return;d(e,n,a=>{r(a,i.__activatedValue??void 0)},this.controller)},get value(){return e?e.value:""},set value(n){e&&(e.value=n)},focus(n=!0){requestAnimationFrame(()=>e?.focus({preventScroll:n}))},enableDefaultInputHandlers(n=[]){!t()||(n.includes("focus")||this.on("focus",()=>i.__startTyping()),n.includes("blur")||this.on("blur",()=>i.__stopTyping()),n.includes("keydown")||this.on("keydown",r=>{switch(r.key){case"ArrowDown":r.preventDefault(),r.stopPropagation(),i.__activateNext();break;case"ArrowUp":r.preventDefault(),r.stopPropagation(),i.__activatePrev();break;case"Escape":r.preventDefault(),r.stopPropagation(),requestAnimationFrame(()=>this.focus(!0));break;case"Home":r.preventDefault(),i.__activateFirst();break;case"End":r.preventDefault(),i.__activateLast();break;case"Tab":i.__stopTyping();break}}))},destroy(){this.controller.abort()}}}function M(i){let e=()=>Array.from(i.$el.querySelectorAll("[x-rover\\:option]"));return{controller:new AbortController,on(t,n){i.$nextTick(()=>{let r=e();if(!r)return;let s=a=>{n(a,i.__activatedValue??void 0)};r.forEach(a=>{d(a,t,s,this.controller)})})},destroy(){this.controller.abort()}}}function A(i){let e=i.$el.querySelector("[x-rover\\:options]");e||console.warn("Options container not found");let t=n=>{if(!(!n||!(n instanceof HTMLElement)))return Alpine.findClosest(n,r=>r.hasAttribute("x-rover:option"))};return{controller:new AbortController,on(n,r){if(!e)return;d(e,n,a=>{let u=t(a.target);r(a,u,i.__activatedValue??null)},this.controller)},findClosestOption:t,enableDefaultOptionsHandlers(n=[]){!e||(e.tabIndex=0,n.includes("mouseover")||this.on("mouseover",(r,s)=>{!s?.dataset.value||i.__activate(s.dataset.value)}),n.includes("mousemove")||this.on("mousemove",(r,s)=>{!s?.dataset.value||i.__isActive(s.dataset.value)||i.__activate(s.dataset.value)}),n.includes("mouseout")||this.on("mouseout",()=>{i.__keepActivated||i.__deactivate()}),n.includes("keydown")||this.on("keydown",r=>{switch(r.stopPropagation(),r.key){case"ArrowDown":r.preventDefault(),i.__activateNext();break;case"ArrowUp":r.preventDefault(),i.__activatePrev();break;case"Home":r.preventDefault(),i.__activateFirst();break;case"End":r.preventDefault(),i.__activateLast();break;case"Escape":r.preventDefault(),i.__deactivate();break;case"Tab":i.__deactivate();break}}))},get all(){let n=i.__optionsEls;return n?Array.from(n):[]},destroy(){this.controller.abort()}}}function E(i){let e=i.$el.querySelector("[x-rover\\:button]");return{controller:new AbortController,on(t,n){if(!e)return;d(e,t,s=>{n(s,i.__activatedValue??void 0)},this.controller)},destroy(){this.controller.abort()}}}function m({effect:i}){let e=new y;return{__collection:e,__optionsEls:void 0,__groupsEls:void 0,__optionIndex:void 0,__isOpen:!1,__isTyping:!1,__isLoading:!1,__g_id:-1,__s_id:-1,__static:!1,__keepActivated:!0,__optionsEl:void 0,__prevActivatedValue:void 0,__activatedValue:void 0,__items:[],__filteredValues:null,__prevVisibleArray:null,__prevActiveValue:void 0,__externalQuery:null,__effectRAF:null,__inputManager:void 0,__optionsManager:void 0,__optionManager:void 0,__buttonManager:void 0,__add:(t,n,r)=>e.add(t,n,r),__forget:t=>e.forget(t),__activate:t=>e.activate(t),__deactivate:()=>e.deactivate(),__isActive:t=>e.isActivated(t),__getActiveItem:()=>e.getActiveItem(),__activateNext:()=>e.activateNext(),__activatePrev:()=>e.activatePrev(),__activateFirst:()=>e.activateFirst(),__activateLast:()=>e.activateLast(),__searchUsingQuery:t=>e.search(t),__getByIndex:t=>e.getByIndex(t),init(){this.__setupManagers(),i(()=>{this.__isLoading=e.pending.state}),this.__inputManager.on("input",t=>{let n=t?.target;if(!(n._x_model?.get()!==void 0)){let a=n.value;if(a.length>0){let u=this.__searchUsingQuery(a).map(o=>o.value),_=this.__filteredValues;(!_||_.length!==u.length||u.some((o,l)=>o!==_[l]))&&(this.__filteredValues=u)}else this.__filteredValues=null}let s=this.__filteredValues??this.__collection.all().map(a=>a.value);if(console.log("current values:",s),this.__activatedValue&&!s.includes(this.__activatedValue)&&this.__deactivate(),!this.__getActiveItem()){let a=this.__collection.all().find(u=>!u.disabled&&s.includes(u.value));a&&this.__activate(a.value)}}),this.$nextTick(()=>{this.__optionsEls=Array.from(this.$el.querySelectorAll("[x-rover\\:option]")),this.__optionIndex=new Map,this.__optionsEls.forEach(t=>{let n=t.dataset.value;n&&this.__optionIndex.set(n,t)}),i(()=>{let t=this.__getByIndex(e.activeIndex.value),n=this.__activatedValue=t?.value,r=this.__filteredValues;requestAnimationFrame(()=>{this.patchItemsVisibility(r),this.patchItemsActivity(n)})})})},__handleGroupsVisibility(){},__handleSeparatorsVisibility(){},patchItemsVisibility(t){if(!this.__optionsEls||!this.__optionIndex)return;let n=this.__prevVisibleArray;if(t===n)return;if(t===null){if(n===null)return;this.__optionsEls.forEach(a=>{a.style.display=""}),this.__prevVisibleArray=null;return}let r=new Set(t),s=n?new Set(n):null;if(s===null){this.__optionsEls.forEach(a=>{let u=a.dataset.value;if(!u)return;let _=!r.has(u);a.style.display!==(_?"none":"")&&(a.style.display=_?"none":"")}),this.__prevVisibleArray=t;return}for(let a of s)if(!r.has(a)){let u=this.__optionIndex.get(a);u&&(u.style.display="none")}for(let a of r)if(!s.has(a)){let u=this.__optionIndex.get(a);u&&(u.style.display="")}this.__prevVisibleArray=t},patchItemsActivity(t){let n=this.__prevActiveValue;if(n!==t){if(n){let r=this.__optionIndex.get(n);r&&(r.removeAttribute("data-active"),r.removeAttribute("aria-current"))}if(t){let r=this.__optionIndex.get(t);r&&(r.setAttribute("data-active","true"),r.setAttribute("aria-current","true"),requestAnimationFrame(()=>{r.scrollIntoView({block:"nearest"})}))}this.__prevActiveValue=t}},__setupManagers(){this.__inputManager=x(this),this.__optionManager=M(this),this.__optionsManager=A(this),this.__buttonManager=E(this)},__open(){this.__isOpen||(this.__isOpen=!0,requestAnimationFrame(()=>{this.$refs?._x__input?.focus({preventScroll:!0})}))},__pushSeparatorToItems(t){this.__items.push({type:"s",id:t})},__pushGroupToItems(t){this.__items.push({type:"g",id:t})},__startTyping(){this.__isTyping=!0},__stopTyping(){this.__isTyping=!1},__nextGroupId(){return++this.__g_id},__nextSeparatorId(){return++this.__s_id},destroy(){this.__inputManager?.destroy(),this.__optionManager?.destroy(),this.__optionsManager?.destroy(),this.__buttonManager?.destroy()}}}var T=i=>{let e=Alpine.$data(i);return{get collection(){return e.__collection},get input(){return e.__inputManager},get option(){return e.__optionManager},get options(){return e.__optionsManager},get button(){return e.__buttonManager},get isLoading(){return e.__isLoading},get inputEl(){return e.$root.querySelector("[x-rover\\:input]")},reIndex(){},getOptionElByValue(t){return e.__optionIndex?.get(t)},activate(t){e.__collection.activate(t)},deactivate(){e.__collection.deactivate()},getActiveItem(){return e.__collection.getActiveItem()},activateNext(){e.__collection.activateNext()},activatePrev(){e.__collection.activatePrev()},activateFirst(){e.__collection.activateFirst()},activateLast(){e.__collection.activateLast()},activateByKey(t){e.__collection.activateByKey(t)},searchUsing(t){return e.__collection.search(t)}}};var R=i=>({activate(e){i.__collection.activate(e)},deactivate(){i.__collection.deactivate()},getActiveItem(){return i.__collection.getActiveItem()},activateNext(){i.__collection.activateNext()},activatePrev(){i.__collection.activatePrev()},activateFirst(){i.__collection.activateFirst()},activateLast(){i.__collection.activateLast()},searchUsing(e){return i.__collection.search(e)}});var I=i=>({isOpen(){return i.__isOpen},isStatic(){return i.__static}});function h(i){i.magic("rover",e=>{let t=i.findClosest(e,n=>n.hasAttribute("x-rover"));if(!t)throw"No x-rover directive found, this magic meant to be used under x-rover root context...";return T(t)}),i.magic("roverOption",e=>{let t=i.findClosest(e,r=>r.hasAttribute("x-rover:option"));if(!t)throw"No x-rover:option directive found, this magic meant to be used per option context...";let n=i.$data(t);return R(n)}),i.magic("roverOptions",e=>{let t=i.findClosest(e,r=>r.hasAttribute("x-option:options"));if(!t)throw"No x-rover:options directive found, this magic meant to be used per options context...";let n=i.$data(t);return I(n)})}function g(i){i.directive("rover",(o,{value:l,modifiers:p},{Alpine:c,effect:L})=>{switch(l){case null:e(c,o,L);break;case"input":t(c,o);break;case"button":a(c,o);break;case"options":n(o);break;case"option":r(c,o);break;case"group":s(c,o);break;case"loading":_(c,o,p);break;case"separator":b(c,o);break;case"empty":u(c,o);break;default:console.error("invalid x-rover value",l,"use input, button, option, options, group or leave mepty for root level instead");break}}).before("data"),h(i);function e(o,l,p){o.bind(l,{"x-data"(){return{...m({effect:p})}}})}function t(o,l){o.bind(l,{"x-bind:id"(){return this.$id("rover-input")},role:"combobox",tabindex:"0","aria-autocomplete":"list"})}function n(o){i.bind(o,{"x-bind:id"(){return this.$id("rover-options")},role:"listbox","x-bind:data-loading"(){return this.__isLoading}})}function r(o,l){o.bind(l,{"x-id"(){return["rover-option"]},"x-bind:id"(){return this.$id("rover-option")},role:"option","x-data"(){return v(o)}})}function s(o,l){o.bind(l,{"x-id"(){return["rover-group"]},"x-bind:id"(){return this.$id("rover-group")},role:"group","x-init"(){let p=this.$id("rover-group");this.$el.setAttribute("aria-labelledby",`${p}-label`)}})}function a(o,l){o.bind(l,{"x-ref":"__button","x-bind:id"(){return this.$id("rover-button")},tabindex:"-1","aria-haspopup":"true"})}function u(o,l){o.bind(l,{"x-bind:id"(){return this.$id("rover-button")},tabindex:"-1","aria-haspopup":"true","x-show"(){return Array.isArray(this.__filteredValues)&&this.__filteredValues.length===0&&this.__inputManager.value.length>0}})}function _(o,l,p){let c=p.includes("hide");o.bind(l,{"x-show"(){return c?!this.__isLoading:this.__isLoading},role:"status","aria-live":"polite","aria-atomic":"true"})}function b(o,l){o.bind(l,{"x-init"(){let p=String(this.__nextSeparatorId());this.$el.dataset.key=p,this.__pushSeparatorToItems(p),this.$el.setAttribute("role","separator"),this.$el.setAttribute("aria-orientation","horizontal")}})}}document.addEventListener("alpine:init",()=>{window.Alpine.plugin(g)});})();
