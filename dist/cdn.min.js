(()=>{var v="rover-input";function f(t){return{init(){let e=t.extractProp(this.$el,"display-value","");e&&(this.__displayValue=e),this.$el.dataset.slot=v,this.__handleEvents()},__handleEvents(){this.$el.addEventListener("focus",()=>{this.__startTyping()}),this.$el.addEventListener("input",e=>{e.stopPropagation(),this.__isTyping&&this.__open()}),this.$el.addEventListener("blur",()=>{this.__stopTyping()}),this.$el.addEventListener("keydown",e=>{switch(e.key){case"ArrowDown":if(e.preventDefault(),e.stopPropagation(),!this.__isOpen){this.__open();break}this.__activateNext();break;case"ArrowUp":if(e.preventDefault(),e.stopPropagation(),!this.__isOpen){this.__open();break}this.__activatePrev();break;case"Enter":e.preventDefault(),e.stopPropagation(),this.__selectActive(),this.__stopTyping(),this.__isMultiple||(this.__close(),this.__resetInput());break;default:if(this.__static)return;this.__open();break}})}}}var m="rover-option";function y(t,e,i){return{__uniqueKey:"option-"+e,__isVisible:!0,init(){this.$el.dataset.slot=m,this.$el.dataset.key=this.__uniqueKey;let a;i!==null?a=i:a=t.extractProp(this.$el,"value","");let s=t.extractProp(this.$el,"disabled",!1,!1);this.$el.dataset.value=a,this.__add(this.__uniqueKey,a,s),this.__pushOptionToItems(String(e)),this.$nextTick(()=>{s&&this.$el.setAttribute("tabindex","-1")})},destroy(){this.__forget(this.__uniqueKey)}}}var g=class{constructor(e={}){this.items=[];this.itemsMap=new Map;this.searchIndex=[];this.currentQuery="";this.currentResults=[];this.navIndex=[];this.activeNavPos=-1;this.needsReindex=!1;this.isProcessing=!1;this.pending=Alpine.reactive({state:!1}),this.activeIndex=Alpine.reactive({value:void 0}),this.searchThreshold=e.searchThreshold??500}add(e,i,a=!1){if(this.itemsMap.has(e))return;let s={key:e,value:i,disabled:a};this.items.push(s),this.itemsMap.set(e,s),this.invalidate()}forget(e){let i=this.itemsMap.get(e);if(!i)return;let a=this.items.indexOf(i);this.itemsMap.delete(e),this.items.splice(a,1),this.activeIndex.value===a?(this.activeIndex.value=void 0,this.activeNavPos=-1):this.activeIndex.value!==void 0&&this.activeIndex.value>a&&this.activeIndex.value--,this.invalidate()}invalidate(){this.needsReindex=!0,this.currentQuery="",this.currentResults=[],this.scheduleBatch()}scheduleBatch(){this.isProcessing||(this.isProcessing=!0,this.pending.state=!0,queueMicrotask(()=>{this.rebuildSearchIndex(),this.rebuildNavIndex(),this.isProcessing=!1,this.pending.state=!1}))}rebuildSearchIndex(){!this.needsReindex||(this.searchIndex=this.items.map(e=>({key:e.key,value:String(e.value).toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"")})),this.needsReindex=!1)}rebuildNavIndex(){this.navIndex=[];let e=this.currentResults.length>0?this.currentResults:this.items;for(let i=0;i<this.items.length;i++)!this.items[i]?.disabled&&e.includes(this.items[i])&&this.navIndex.push(i)}toggleIsPending(){this.pending.state=!this.pending.state}search(e){if(!e)return this.currentQuery="",this.currentResults=[],this.rebuildNavIndex(),this.items;let i=e.toLowerCase();if(this.currentQuery&&i.startsWith(this.currentQuery)&&this.currentResults.length>0){let l=this.currentResults.filter(n=>String(n.value).toLowerCase().includes(i));return this.currentQuery=i,this.currentResults=l,this.rebuildNavIndex(),l}this.rebuildSearchIndex();let a=i.normalize("NFD").replace(/[\u0300-\u036f]/g,""),s=[];for(let{key:l,value:n}of this.searchIndex)if(n.includes(a)){let u=this.itemsMap.get(l);u&&s.push(u)}return this.currentQuery=i,this.currentResults=s,this.rebuildNavIndex(),s}get(e){return this.itemsMap.get(e)}getValueByKey(e){return this.get(e)?.value}getKeyByIndex(e){return e==null||e===void 0?null:this.items[e]?.key??null}all(){return this.items}get size(){return this.items.length}activate(e){let i=this.get(e);if(!i||i.disabled)return;this.rebuildSearchIndex(),this.rebuildNavIndex();let a=this.items.indexOf(i);this.activeIndex.value!==a&&(this.activeIndex.value=a,this.activeNavPos=this.navIndex.indexOf(a))}deactivate(){this.activeIndex.value=void 0,this.activeNavPos=-1}isActivated(e){let i=this.get(e);return i?this.items.indexOf(i)===this.activeIndex.value:!1}getActiveItem(){return this.activeIndex.value===void 0?null:this.items[this.activeIndex.value]??null}activateFirst(){if(this.rebuildSearchIndex(),this.rebuildNavIndex(),!this.navIndex.length)return;let e=this.navIndex[0];e!==void 0&&(this.activeIndex.value=e,this.activeNavPos=0)}activateLast(){if(this.rebuildSearchIndex(),this.rebuildNavIndex(),!this.navIndex.length)return;this.activeNavPos=this.navIndex.length-1;let e=this.navIndex[this.activeNavPos];typeof e=="number"&&(this.activeIndex.value=e)}activateNext(){if(this.rebuildSearchIndex(),this.rebuildNavIndex(),!this.navIndex.length)return;if(this.activeNavPos===-1){this.activateFirst();return}this.activeNavPos=(this.activeNavPos+1)%this.navIndex.length;let e=this.navIndex[this.activeNavPos];e!==void 0&&(this.activeIndex.value=e)}activatePrev(){if(this.rebuildSearchIndex(),this.rebuildNavIndex(),!this.navIndex.length)return;if(this.activeNavPos===-1){this.activateLast();return}this.activeNavPos=this.activeNavPos===0?this.navIndex.length-1:this.activeNavPos-1;let e=this.navIndex[this.activeNavPos];e!==void 0&&(this.activeIndex.value=e)}},R=g;function x({el:t,effect:e}){let i=new R,a="rover-root";return{collection:i,__optionsEls:void 0,__groupsEls:void 0,__state:null,__isOpen:!1,__isMultiple:!1,__isTyping:!1,__isLoading:!1,__o_id:-1,__g_id:-1,__s_id:-1,__static:!1,__keepActivated:!0,__optionsEl:void 0,__compareBy:void 0,__activatedKey:void 0,__selectedKeys:void 0,__isDisabled:!1,__items:[],__searchQuery:"",__filteredKeys:null,__filteredKeysSet:new Set,__add:(s,l,n)=>i.add(s,l,n),__forget:s=>i.forget(s),__activate:s=>i.activate(s),__deactivate:()=>i.deactivate(),__isActive:s=>i.isActivated(s),__getValueByKey:s=>i.getValueByKey(s),__getActiveItem:()=>i.getActiveItem(),__activateNext:()=>i.activateNext(),__activatePrev:()=>i.activatePrev(),__activateFirst:()=>i.activateFirst(),__activateLast:()=>i.activateLast(),__searchUsingQuery:s=>i.search(s),__getKeyByIndex:s=>i.getKeyByIndex(s),__onOpenCallback:()=>{},__onOpen(s){this.__onOpenCallback=s},init(){this.$el.dataset.slot=a,e(()=>{this.__isLoading=i.pending.state}),e(()=>{this.__activatedKey=this.__getKeyByIndex(i.activeIndex.value)}),e(()=>{if(String(this.__searchQuery).length>0){let s=this.__searchUsingQuery(this.__searchQuery).map(l=>l.key);s.length>=0&&(this.__filteredKeys=s)}else this.__filteredKeys=null;this.__activatedKey&&this.__filteredKeys&&!this.__filteredKeys.includes(this.__activatedKey)&&this.__deactivate(),this.__isOpen&&!this.__getActiveItem()&&this.__filteredKeys&&this.__filteredKeys.length&&this.__activate(this.__filteredKeys[0])}),this.$nextTick(()=>{this.__optionsEls=Array.from(this.$el.querySelectorAll("[data-slot=rover-option]")),this.__groupsEls=Array.from(this.$el.querySelectorAll("[data-slot=rover-group]")),e(()=>{let s=this.__activatedKey,l=this.__filteredKeys?new Set(this.__filteredKeys):null,n=new Set(Array.isArray(this.__selectedKeys)?this.__selectedKeys:this.__selectedKeys?[this.__selectedKeys]:[]);requestAnimationFrame(()=>{this.__optionsEls.forEach(h=>{let r=h,o=r.dataset.key;!o||(l!==null?r.hidden=!l.has(o):r.hidden=!1,o===s?(r.setAttribute("data-active","true"),r.setAttribute("aria-current","true"),r.scrollIntoView({block:"nearest"})):(r.removeAttribute("data-active"),r.removeAttribute("aria-current")),n.has(o)?(r.setAttribute("aria-selected","true"),r.setAttribute("data-selected","true")):(r.setAttribute("aria-selected","false"),r.removeAttribute("data-selected")))}),this.__groupsEls.forEach(h=>{let r=h,o=r.querySelectorAll("[data-slot=rover-option]"),c=Array.from(o).some(d=>{let p=d;return l?l.has(p.dataset.key||""):!0});r.hidden=!c})})})}),this.__isDisabled=Alpine.extractProp(t,"disabled",!1),this.__compareBy=Alpine.extractProp(t,"by",""),this.__registerEventsDelector(),this.$nextTick(()=>{this.$refs.__input||(this.__isOpen=!0)})},__open(){this.__isOpen||(this.__isOpen=!0,requestAnimationFrame(()=>{this.$refs?.__input?.focus({preventScroll:!0})}),this.__onOpenCallback())},__pushSeparatorToItems(s){this.__items.push({type:"s",key:s})},__pushGroupToItems(s){this.__items.push({type:"g",key:s})},__pushOptionToItems(s){this.__items.push({type:"o",key:s})},__close(){this.__isOpen=!1,this.__deactivate()},__handleSelection(s){let l=this.__getValueByKey(s);if(!this.__isMultiple){this.__selectedKeys=s,this.__state===l?(this.__state=null,this.__selectedKeys=null):this.__state=l,this.__static||this.__close(),console.log(this.__state);return}Array.isArray(this.__selectedKeys)||(this.__selectedKeys=[]),Array.isArray(this.__state)||(this.__state=[]);let n=this.__state.findIndex(_=>this.__compare(_,l)),u=this.__selectedKeys.indexOf(s);n===-1?(this.__state.push(l),this.__selectedKeys.push(s)):(this.__state.splice(n,1),this.__selectedKeys.splice(u,1))},__selectActive(){!this.__activatedKey||this.__handleSelection(this.__activatedKey)},__startTyping(){this.__isTyping=!0},__stopTyping(){this.__isTyping=!1},__resetInput(){let s=this.$refs.__input;if(!s)return;let l=this.__getCurrentValue();s.value=l},__getCurrentValue(){return!this.$refs.__input||!this.__state?"":typeof this.__state=="string"?this.__state:""},__compare(s,l){let n=this.__compareBy;if(!this.__compareBy)n=(u,_)=>Alpine.raw(u)===Alpine.raw(_);else if(typeof this.__compareBy=="string"){let u=this.__compareBy;n=(_,h)=>{if(!_||typeof _!="object"||!h||typeof h!="object")return Alpine.raw(_)===Alpine.raw(h);let r=_,o=h;return r[u]===o[u]}}return n(s,l)},__nextOptionId(){return++this.__o_id},__nextGroupId(){return++this.__g_id},__nextSeparatorId(){return++this.__s_id},__registerEventsDelector(){let s=n=>Alpine.findClosest(n,u=>u.dataset.slot===m),l=n=>function(u){if(u.stopPropagation(),!(u.target instanceof Element))return;let _=s(u.target);!_||n(_)};this.$nextTick(()=>{this.__optionsEl=this.$refs.__options,!!this.__optionsEl&&(this.__optionsEl.addEventListener("click",l(n=>{!n.dataset.key||(this.__handleSelection(n.dataset.key),console.log("clicked",n,n.dataset.key),console.log("selected keys:",this.__selectedKeys),!this.__isMultiple&&!this.__static,this.$nextTick(()=>this.$refs?.__input?.focus({preventScroll:!0})))})),this.__optionsEl.addEventListener("mouseover",l(n=>{!n.dataset.key||this.__activate(n.dataset.key)})),this.__optionsEl.addEventListener("mousemove",l(n=>{this.__isActive(n.dataset.key||"")||!n.dataset.key||this.__activate(n.dataset.key)})),this.__optionsEl.addEventListener("mouseout",l(()=>{this.__keepActivated||this.__deactivate()})),this.$root.addEventListener("keydown",n=>{switch(n.key){case"ArrowDown":n.preventDefault(),n.stopPropagation(),this.__activateNext();break;case"ArrowUp":n.preventDefault(),n.stopPropagation(),this.__activatePrev();break;case"Enter":n.preventDefault(),n.stopPropagation(),this.__selectActive(),this.__isMultiple||(this.__close(),this.__resetInput());break;case"Escape":n.preventDefault(),n.stopPropagation(),this.__close(),this.$nextTick(()=>this.$refs?.__input?.focus({preventScroll:!0}));break;default:if(this.__static)return;this.__open();break}}))})}}}function b(t){let e="rover-options";return{init(){return this.$data.__static=t.extractProp(this.$el,"static",!1),t.bound(this.$el,"keepActivated")&&(this.__keepActivated=!0),this.$el.dataset.slot=e},__handleClickAway(i){if(this.__static)return;let a=i.target;a.dataset.slot&&a.dataset.slot===v||this.__close()}}}var O=t=>({get isOpen(){return t.__isOpen},get collection(){return t.collection},onOpen(e){t.__onOpen(e)},activate(e){t.collection.activate(e)},deactivate(){t.collection.deactivate()},getValueByKey(e){return t.collection.getValueByKey(e)},getActiveItem(){return t.collection.getActiveItem()},activateNext(){t.collection.activateNext()},activatePrev(){t.collection.activatePrev()},activateFirst(){t.collection.activateFirst()},activateLast(){t.collection.activateLast()},searchUsing(e){return t.collection.search(e)},getKeyByIndex(e){return t.collection.getKeyByIndex(e)}});var T=t=>({activate(e){t.collection.activate(e)},deactivate(){t.collection.deactivate()},getValueByKey(e){return t.collection.getValueByKey(e)},getActiveItem(){return t.collection.getActiveItem()},activateNext(){t.collection.activateNext()},activatePrev(){t.collection.activatePrev()},activateFirst(){t.collection.activateFirst()},activateLast(){t.collection.activateLast()},searchUsing(e){return t.collection.search(e)},getKeyByIndex(e){return t.collection.getKeyByIndex(e)}});var E=t=>({isOpen(){return t.__isOpen},open(){t.__open()},close(){t.__close()},isStatic(){return t.__static}});function I(t){t.magic("rover",e=>{let i=t.findClosest(e,s=>s.hasAttribute("x-rover"));if(!i)throw"No x-rover directive found, this magic meant to be used under x-rover root context...";let a=t.$data(i);return O(a)}),t.magic("roverOption",e=>{let i=t.findClosest(e,s=>s.hasAttribute("x-rover:option"));if(!i)throw"No x-rover:option directive found, this magic meant to be used per option context...";let a=t.$data(i);return T(a)}),t.magic("roverOptions",e=>{let i=t.findClosest(e,s=>s.hasAttribute("x-option:options"));if(!i)throw"No x-rover:options directive found, this magic meant to be used per options context...";let a=t.$data(i);return E(a)})}function A(t){t.directive("rover",(r,{value:o,modifiers:c,expression:d},{Alpine:p,effect:K,evaluate:C})=>{switch(o){case null:e(p,r,K);break;case"input":i(p,r);break;case"button":n(p,r);break;case"options":a(r);break;case"option":s(p,r,d,C);break;case"group":l(p,r);break;case"loading":_(p,r,c);break;case"separator":h(p,r);break;case"empty":u(p,r);break;default:console.error("invalid x-rover value",o,"use input, button, option, options, group or leave mepty for root level instead");break}}).before("bind"),I(t);function e(r,o,c){r.bind(o,{"x-data"(){return{...x({el:o,effect:c})}}})}function i(r,o){r.bind(o,{"x-ref":"__input","x-model":"__searchQuery","x-bind:id"(){return this.$id("rover-input")},role:"combobox",tabindex:"0","aria-autocomplete":"list","x-data"(){return f(r)}})}function a(r){t.bind(r,{"x-ref":"__options","x-bind:id"(){return this.$id("rover-options")},role:"listbox","x-on:click.away"(o){this.__handleClickAway(o)},"x-data"(){return b(t)},"x-show"(){return this.$data.__static?!0:this.$data.__isOpen}})}function s(r,o,c,d){r.bind(o,{"x-id"(){return["rover-option"]},"x-bind:id"(){return this.$id("rover-option")},role:"option","x-data"(){let p=null;return c!==""&&(p=d(c)),y(r,this.__nextOptionId(),p)}})}function l(r,o){r.bind(o,{"x-id"(){return["rover-group"]},"x-bind:id"(){return this.$id("rover-group")},role:"group","x-init"(){let c=this.$id("rover-group");this.$el.dataset.slot="rover-group",this.$el.setAttribute("aria-labelledby",`${c}-label`);let d=String(this.__nextGroupId());this.$el.dataset.key=d,this.__pushGroupToItems(d)}})}function n(r,o){r.bind(o,{"x-ref":"__button","x-bind:id"(){return this.$id("rover-button")},tabindex:"-1","aria-haspopup":"true","x-on:click"(c){this.__isDisabled||(this.__isOpen?(this.__close(),this.__resetInput()):(c.preventDefault(),this.__open()),requestAnimationFrame(()=>this.$refs.__input.focus({preventScroll:!0})))}})}function u(r,o){r.bind(o,{"x-bind:id"(){return this.$id("rover-button")},tabindex:"-1","aria-haspopup":"true","x-show"(){return Array.isArray(this.__filteredKeys)&&this.__filteredKeys.length===0&&this.__searchQuery.length>0}})}function _(r,o,c){let d=r.$data(o);c.filter(p=>p==="hide")}function h(r,o){r.bind(o,{"x-init"(){this.$el.dataset.slot="rover-separator";let c=String(this.__nextSeparatorId());this.$el.dataset.key=c,this.__pushSeparatorToItems(c),this.$el.setAttribute("role","separator"),this.$el.setAttribute("aria-orientation","horizontal")}})}}document.addEventListener("alpine:init",()=>{window.Alpine.plugin(A)});})();
