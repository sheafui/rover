(()=>{var v="rover-input";function f(_){return{init(){let e=_.extractProp(this.$el,"display-value","");e&&(this.__displayValue=e),this.$el.dataset.slot=v,this.__handleEvents()},__handleEvents(){this.$el.addEventListener("focus",()=>{this.__startTyping()}),this.$el.addEventListener("input",e=>{e.stopPropagation(),this.__isTyping&&this.__open()}),this.$el.addEventListener("blur",()=>{this.__stopTyping()}),this.$el.addEventListener("keydown",e=>{switch(e.key){case"ArrowDown":if(e.preventDefault(),e.stopPropagation(),!this.__isOpen){this.__open();break}this.__activateNext();break;case"ArrowUp":if(e.preventDefault(),e.stopPropagation(),!this.__isOpen){this.__open();break}this.__activatePrev();break;case"Enter":e.preventDefault(),e.stopPropagation(),this.__selectActive(),this.__stopTyping(),this.__isMultiple||(this.__close(),this.__resetInput());break}})}}}function y(_,e){let t="rover-option";return{__uniqueKey:"option-"+e,init(){this.$el.dataset.slot=t;let a=_.extractProp(this.$el,"value","");this.$el.dataset.key=this.__uniqueKey,this.$el.dataset.value=a;let i=_.extractProp(this.$el,"disabled",!1,!1);this.__add(this.__uniqueKey,a,i),this.$watch("__activedKey",r=>{r===this.__uniqueKey?this.$el.setAttribute("data-active","true"):this.$el.removeAttribute("data-active")}),this.$watch("__selectedKeys",r=>{let s=!1;this.__isMultiple?s=Array.isArray(r)&&r.includes(this.__uniqueKey):s=r===this.__uniqueKey,s?(this.$el.setAttribute("aria-selected","true"),this.$el.setAttribute("data-selected","true")):(this.$el.setAttribute("aria-selected","false"),this.$el.removeAttribute("data-selected"))}),this.$nextTick(()=>{i&&this.$el.setAttribute("tabindex","-1")})},destroy(){this.__forget(this.__uniqueKey)}}}var m=class{constructor(e={}){this.items=[];this.itemsMap=new Map;this.needsReindex=!1;this.navIndex=[];this.activeNavPos=-1;this.lastQuery="";this.isProcessing=!1;this.pending=Alpine.reactive({state:!1}),this.activeIndex=Alpine.reactive({value:void 0}),this.searchThreshold=e.searchThreshold??500}add(e,t,a=!1){if(this.itemsMap.has(e))return;let i={key:e,value:t,disabled:a};this.items.push(i),this.itemsMap.set(e,i),this.invalidate()}forget(e){let t=this.itemsMap.get(e);if(!t)return;let a=this.items.indexOf(t);this.itemsMap.delete(e),this.items.splice(a,1),this.activeIndex.value===a?(this.activeIndex.value=void 0,this.activeNavPos=-1):this.activeIndex.value&&this.activeIndex.value>a&&this.activeIndex.value--,this.invalidate()}activate(e){let t=this.get(e);if(!t||t.disabled)return;this.rebuildIndexes();let a=this.items.indexOf(t);this.activeIndex.value!==a&&(this.activeIndex.value=a,this.activeNavPos=this.navIndex.indexOf(a))}deactivate(){this.activeIndex.value=void 0,this.activeNavPos=-1}isActivated(e){let t=this.get(e);return t?this.items.indexOf(t)===this.activeIndex.value:!1}getActiveItem(){return this.activeIndex.value===void 0?null:this.items[this.activeIndex.value]}invalidate(){this.needsReindex=!0,this.lastQuery="",this.lastResults=[],this.scheduleBatch()}scheduleBatch(){this.isProcessing||(this.isProcessing=!0,this.pending.state=!0,queueMicrotask(()=>{this.rebuildIndexes(),this.isProcessing=!1,this.pending.state=!1}))}toggleIsPending(){this.pending.state=!this.pending.state}rebuildIndexes(){if(!!this.needsReindex){this.navIndex=[];for(let e=0;e<this.items.length;e++)this.items[e]?.disabled||this.navIndex.push(e);this.searchIndex=this.items.map(e=>({key:e.key,value:String(e.value).toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"")})),this.needsReindex=!1}}search(e){if(!e)return this.lastQuery="",this.lastResults=[],this.items;let t=e.toLowerCase();if(this.lastQuery&&t.startsWith(this.lastQuery)&&this.lastResults){let i=this.lastResults.filter(r=>String(r.value).toLowerCase().includes(t));return this.lastQuery=t,this.lastResults=i,i}let a;if(this.searchIndex){let i=t.normalize("NFD").replace(/[\u0300-\u036f]/g,"");a=[];for(let{key:r,value:s}of this.searchIndex)if(s.includes(i)){let l=this.itemsMap.get(r);l&&a.push(l)}}else a=this.items.filter(i=>String(i.value).toLowerCase().includes(t));return this.lastQuery=t,this.lastResults=a,a}get(e){return this.itemsMap.get(e)}getValueByKey(e){return this.get(e)?.value}getKeyByIndex(e){return e==null?null:this.items[e]?.key??null}all(){return this.items}get size(){return this.items.length}activateFirst(){this.rebuildIndexes(),!!this.navIndex.length&&(this.navIndex[0]!==void 0&&(this.activeIndex.value=this.navIndex[0]),this.activeNavPos=0)}activateLast(){if(this.rebuildIndexes(),!this.navIndex.length)return;this.activeNavPos=this.navIndex.length-1;let e=this.navIndex[this.activeNavPos];typeof e=="number"&&(this.activeIndex.value=e)}activateNext(){if(this.rebuildIndexes(),!!this.navIndex.length){if(this.activeNavPos===-1){this.activateFirst();return}this.activeNavPos=(this.activeNavPos+1)%this.navIndex.length,this.activeIndex.value=this.navIndex[this.activeNavPos]}}activatePrev(){if(this.rebuildIndexes(),!!this.navIndex.length){if(this.activeNavPos===-1){this.activateLast();return}this.activeNavPos=this.activeNavPos===0?this.navIndex.length-1:this.activeNavPos-1,this.activeIndex.value=this.navIndex[this.activeNavPos]}}},A=m;function x({el:_,effect:e}){let t=new A,a="rover-root";return{__state:null,__isOpen:!1,__isMultiple:!1,__isTyping:!1,__isLoading:!1,__uid:0,__static:!1,__keepActivated:!0,__optionsEl:void 0,__compareBy:void 0,__activedKey:void 0,__selectedKeys:void 0,__filteredKeys:null,__isDisabled:!1,__searchQuery:"",__add:(i,r,s)=>t.add(i,r,s),__forget:i=>t.forget(i),__activate:i=>t.activate(i),__isActive:i=>t.isActivated(i),__deactivate:()=>t.deactivate(),__getValueByKey:i=>t.getValueByKey(i),__activateNext:()=>t.activateNext(),__activatePrev:()=>t.activatePrev(),__activateFirst:()=>t.activateFirst(),__activateLast:()=>t.activateLast(),__isVisible(i){return this.__searchQuery===""||!this.__filteredKeys?!0:this.__filteredKeys.includes(i)},init(){this.$el.dataset.slot=a,e(()=>{this.__isLoading=t.pending.state}),e(()=>{this.__activedKey=t.getKeyByIndex(t.activeIndex.value)}),e(()=>{let s=t.search(this.__searchQuery).map(l=>l.key);console.log(t.navIndex),s.length>=0?this.__filteredKeys=s:this.__filteredKeys=null,this.__activedKey&&this.__filteredKeys&&!this.__filteredKeys.includes(this.__activedKey)&&t.deactivate(),this.__isOpen&&!t.getActiveItem()&&this.__filteredKeys&&this.__filteredKeys.length&&t.activate(this.__filteredKeys[0])}),this.__isMultiple?this.__selectedKeys=[]:this.__selectedKeys=null,this.__isMultiple=Alpine.extractProp(_,"multiple",!1),this.__isDisabled=Alpine.extractProp(_,"disabled",!1),this.__compareBy=Alpine.extractProp(_,"by","");let i=this.__isMultiple?[]:"",r=Alpine.extractProp(_,"initial-value",i);this.__state=r,this.__registerEventsDelector()},__open(){if(this.__isOpen)return;this.__isOpen=!0;let i=this.$refs.__input;requestAnimationFrame(()=>{i.focus({preventScroll:!0}),this.__activateSelectedOrFirst()})},__activateSelectedOrFirst(i=!0){if(!(!this.__isOpen||t.getActiveItem())){if(i&&this.__selectedKeys){let s=this.__isMultiple?this.__selectedKeys[0]:this.__selectedKeys;if(s){this.__activate(s);return}}t.activateFirst()}},__close(){this.__isOpen=!1,this.__deactivate()},__handleSelection(i){let r=this.__getValueByKey(i);if(!this.__isMultiple){this.__selectedKeys=i,this.__state===r?(this.__state=null,this.__selectedKeys=null):this.__state=r,this.__static||this.__close();return}Array.isArray(this.__selectedKeys)||(this.__selectedKeys=[]),Array.isArray(this.__state)||(this.__state=[]);let s=this.__state.findIndex(u=>this.__compare(u,r)),l=this.__selectedKeys.indexOf(i);s===-1?(this.__state.push(r),this.__selectedKeys.push(i)):(this.__state.splice(s,1),this.__selectedKeys.splice(l,1))},__selectActive(){!this.__activedKey||this.__handleSelection(this.__activedKey)},__startTyping(){this.__isTyping=!0},__stopTyping(){this.__isTyping=!1},__resetInput(){let i=this.$refs.__input;if(!i)return;let r=this.__getCurrentValue();i.value=r},__getCurrentValue(){return!this.$refs.__input||!this.__state?"":typeof this.__state=="string"?this.__state:""},__compare(i,r){let s=this.__compareBy;if(!this.__compareBy)s=(l,u)=>Alpine.raw(l)===Alpine.raw(u);else if(typeof this.__compareBy=="string"){let l=this.__compareBy;s=(u,p)=>{if(!u||typeof u!="object"||!p||typeof p!="object")return Alpine.raw(u)===Alpine.raw(p);let n=u,o=p;return n[l]===o[l]}}return s(i,r)},__nextId(){return++this.__uid},__registerEventsDelector(){let i=s=>Alpine.findClosest(s,l=>l.dataset.slot==="option"),r=s=>function(l){if(l.stopPropagation(),!(l.target instanceof Element))return;let u=i(l.target);!u||s(u)};this.$nextTick(()=>{this.__optionsEl=this.$refs.__options,!!this.__optionsEl&&(this.__optionsEl.addEventListener("click",r(s=>{!s.dataset.key||(this.__handleSelection(s.dataset.key),!this.__isMultiple&&!this.__static&&(this.__close(),this.__resetInput()),this.$nextTick(()=>this.$refs.__input.focus({preventScroll:!0})))})),this.__optionsEl.addEventListener("mouseover",r(s=>{!s.dataset.key||this.__activate(s.dataset.key)})),this.__optionsEl.addEventListener("mousemove",r(s=>{this.__isActive(s.dataset.key||"")||!s.dataset.key||this.__activate(s.dataset.key)})),this.__optionsEl.addEventListener("mouseout",r(()=>{this.__keepActivated||this.__deactivate()})))})}}}function g(_){let e="rover-options";return{init(){return this.$data.__static=_.extractProp(this.$el,"static",!1),_.bound(this.$el,"keepActivated")&&(this.__keepActivated=!0),this.$el.dataset.slot=e},__handleClickAway(t){if(this.__static)return;let a=t.target;a.dataset.slot&&a.dataset.slot===v||this.__close()}}}function b(_){_.directive("rover",(n,{value:o,modifiers:d},{Alpine:h,effect:c})=>{switch(o){case null:e(h,n,c);break;case"input":t(h,n);break;case"button":s(h,n);break;case"options":a(n);break;case"option":i(h,n);break;case"options-group":r(h,n);break;case"loading":u(h,n,d);break;case"separator":p(h,n);break;case"empty":l(h,n);break;default:console.error("invalid x-rover value",o,"use input, button, option, options or leave mepty for root level instead");break}}).before("bind");function e(n,o,d){n.bind(o,{"x-on:keydown.escape"(h){this.__isOpen&&(h.preventDefault(),this.__close(),queueMicrotask(()=>this.$refs.__input.focus({preventScroll:!0})))},"x-data"(){return x({el:o,effect:d})}})}function t(n,o){n.bind(o,{"x-ref":"__input","x-model":"__searchQuery","x-bind:id"(){return this.$id("rover-input")},role:"combobox",tabindex:"0","aria-autocomplete":"list","x-data"(){return f(n)}})}function a(n){_.bind(n,{"x-ref":"__options","x-bind:id"(){return this.$id("rover-options")},role:"listbox","x-on:click.away"(o){this.__handleClickAway(o)},"x-data"(){return g(_)},"x-show"(){return this.$data.__static?!0:this.$data.__isOpen}})}function i(n,o){n.bind(o,{"x-id"(){return["rover-option"]},"x-bind:id"(){return this.$id("rover-option")},role:"option","x-show"(){return this.$data.__isVisible(this.$el.dataset.key)},"x-data"(){return y(n,this.__nextId())}})}function r(n,o){n.bind(o,{"x-id"(){return["rover-options-group"]},"x-bind:id"(){return this.$id("rover-options-group")},role:"option","x-show"(){return!0}})}function s(n,o){n.bind(o,{"x-ref":"__button","x-bind:id"(){return this.$id("rover-button")},tabindex:"-1","aria-haspopup":"true","x-on:click"(d){this.__isDisabled||(this.__isOpen?(this.__close(),this.__resetInput()):(d.preventDefault(),this.__open()),requestAnimationFrame(()=>this.$refs.__input.focus({preventScroll:!0})))}})}function l(n,o){n.bind(o,{"x-bind:id"(){return this.$id("rover-button")},tabindex:"-1","aria-haspopup":"true","x-show"(){return Array.isArray(this.__filteredKeys)&&this.__filteredKeys.length===0}})}function u(n,o,d){let h=n.$data(o);d.filter(c=>c==="hide")}function p(n,o){n.bind(o,{})}}document.addEventListener("alpine:init",()=>{window.Alpine.plugin(b)});})();
