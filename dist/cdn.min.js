(()=>{var v="rover-input";function f(_){return{init(){let t=_.extractProp(this.$el,"display-value","");t&&(this.__displayValue=t),this.$el.dataset.slot=v,this.__handleEvents()},__handleEvents(){this.$el.addEventListener("focus",()=>{this.__startTyping()}),this.$el.addEventListener("input",t=>{t.stopPropagation(),this.__isTyping&&this.__open()}),this.$el.addEventListener("blur",()=>{this.__stopTyping()}),this.$el.addEventListener("keydown",t=>{switch(t.key){case"ArrowDown":if(t.preventDefault(),t.stopPropagation(),!this.__isOpen){this.__open();break}this.__activateNext();break;case"ArrowUp":if(t.preventDefault(),t.stopPropagation(),!this.__isOpen){this.__open();break}this.__activatePrev();break;case"Enter":t.preventDefault(),t.stopPropagation(),this.__selectActive(),this.__stopTyping(),this.__isMultiple||(this.__close(),this.__resetInput());break;default:if(this.__static)return;this.__open();break}})}}}var y="rover-option";function m(_,t){return{__uniqueKey:"option-"+t,__isVisible:!0,init(){this.$el.dataset.slot=y;let i=_.extractProp(this.$el,"value","");this.$el.dataset.key=this.__uniqueKey,this.$el.dataset.value=i;let o=_.extractProp(this.$el,"disabled",!1,!1);this.__add(this.__uniqueKey,i,o),this.__pushOptionToItems(String(t)),this.$watch("__activatedKey",e=>{e===this.__uniqueKey?(this.$el.setAttribute("data-active","true"),this.$el.scrollIntoView({behavior:"smooth",block:"nearest"})):this.$el.removeAttribute("data-active")}),this.$watch("__searchQuery",()=>{this.__isVisible=this.__filteredKeys!==null?this.__filteredKeys.includes(this.__uniqueKey):!0}),this.$watch("__selectedKeys",e=>{let r=!1;this.__isMultiple?r=Array.isArray(e)&&e.includes(this.__uniqueKey):r=e===this.__uniqueKey,r?(this.$el.setAttribute("aria-selected","true"),this.$el.setAttribute("data-selected","true")):(this.$el.setAttribute("aria-selected","false"),this.$el.removeAttribute("data-selected"))}),this.$watch("__isVisible",e=>{this.$el.hidden=!e}),this.$nextTick(()=>{o&&this.$el.setAttribute("tabindex","-1")})},destroy(){this.__forget(this.__uniqueKey)}}}var x=class{constructor(t={}){this.items=[];this.itemsMap=new Map;this.searchIndex=[];this.currentQuery="";this.currentResults=[];this.navIndex=[];this.activeNavPos=-1;this.needsReindex=!1;this.isProcessing=!1;this.pending=Alpine.reactive({state:!1}),this.activeIndex=Alpine.reactive({value:void 0}),this.searchThreshold=t.searchThreshold??500}add(t,i,o=!1){if(this.itemsMap.has(t))return;let e={key:t,value:i,disabled:o};this.items.push(e),this.itemsMap.set(t,e),this.invalidate()}forget(t){let i=this.itemsMap.get(t);if(!i)return;let o=this.items.indexOf(i);this.itemsMap.delete(t),this.items.splice(o,1),this.activeIndex.value===o?(this.activeIndex.value=void 0,this.activeNavPos=-1):this.activeIndex.value!==void 0&&this.activeIndex.value>o&&this.activeIndex.value--,this.invalidate()}invalidate(){this.needsReindex=!0,this.currentQuery="",this.currentResults=[],this.scheduleBatch()}scheduleBatch(){this.isProcessing||(this.isProcessing=!0,this.pending.state=!0,queueMicrotask(()=>{this.rebuildSearchIndex(),this.rebuildNavIndex(),this.isProcessing=!1,this.pending.state=!1}))}rebuildSearchIndex(){!this.needsReindex||(this.searchIndex=this.items.map(t=>({key:t.key,value:String(t.value).toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"")})),this.needsReindex=!1)}rebuildNavIndex(){this.navIndex=[];let t=this.currentResults.length>0?this.currentResults:this.items;for(let i=0;i<this.items.length;i++)!this.items[i]?.disabled&&t.includes(this.items[i])&&this.navIndex.push(i)}toggleIsPending(){this.pending.state=!this.pending.state}search(t){if(!t)return this.currentQuery="",this.currentResults=[],this.rebuildNavIndex(),this.items;let i=t.toLowerCase();if(this.currentQuery&&i.startsWith(this.currentQuery)&&this.currentResults.length>0){let r=this.currentResults.filter(s=>String(s.value).toLowerCase().includes(i));return this.currentQuery=i,this.currentResults=r,this.rebuildNavIndex(),r}this.rebuildSearchIndex();let o=i.normalize("NFD").replace(/[\u0300-\u036f]/g,""),e=[];for(let{key:r,value:s}of this.searchIndex)if(s.includes(o)){let l=this.itemsMap.get(r);l&&e.push(l)}return this.currentQuery=i,this.currentResults=e,this.rebuildNavIndex(),e}get(t){return this.itemsMap.get(t)}getValueByKey(t){return this.get(t)?.value}getKeyByIndex(t){return t==null||t===void 0?null:this.items[t]?.key??null}all(){return this.items}get size(){return this.items.length}activate(t){let i=this.get(t);if(!i||i.disabled)return;this.rebuildSearchIndex(),this.rebuildNavIndex();let o=this.items.indexOf(i);this.activeIndex.value!==o&&(this.activeIndex.value=o,this.activeNavPos=this.navIndex.indexOf(o))}deactivate(){this.activeIndex.value=void 0,this.activeNavPos=-1}isActivated(t){let i=this.get(t);return i?this.items.indexOf(i)===this.activeIndex.value:!1}getActiveItem(){return this.activeIndex.value===void 0?null:this.items[this.activeIndex.value]??null}activateFirst(){if(this.rebuildSearchIndex(),this.rebuildNavIndex(),!this.navIndex.length)return;let t=this.navIndex[0];t!==void 0&&(this.activeIndex.value=t,this.activeNavPos=0)}activateLast(){if(this.rebuildSearchIndex(),this.rebuildNavIndex(),!this.navIndex.length)return;this.activeNavPos=this.navIndex.length-1;let t=this.navIndex[this.activeNavPos];typeof t=="number"&&(this.activeIndex.value=t)}activateNext(){if(this.rebuildSearchIndex(),this.rebuildNavIndex(),!this.navIndex.length)return;if(this.activeNavPos===-1){this.activateFirst();return}this.activeNavPos=(this.activeNavPos+1)%this.navIndex.length;let t=this.navIndex[this.activeNavPos];t!==void 0&&(this.activeIndex.value=t)}activatePrev(){if(this.rebuildSearchIndex(),this.rebuildNavIndex(),!this.navIndex.length)return;if(this.activeNavPos===-1){this.activateLast();return}this.activeNavPos=this.activeNavPos===0?this.navIndex.length-1:this.activeNavPos-1;let t=this.navIndex[this.activeNavPos];t!==void 0&&(this.activeIndex.value=t)}},A=x;function b({el:_,effect:t}){let i=new A,o="rover-root";return{__state:null,__isOpen:!1,__isMultiple:!1,__isTyping:!1,__isLoading:!1,__o_id:-1,__g_id:-1,__s_id:-1,__static:!1,__keepActivated:!0,__optionsEl:void 0,__compareBy:void 0,__activatedKey:void 0,__selectedKeys:void 0,__isDisabled:!1,__items:[],__searchQuery:"",__filteredKeys:null,__filteredKeysSet:new Set,__add:(e,r,s)=>i.add(e,r,s),__forget:e=>i.forget(e),__activate:e=>i.activate(e),__deactivate:()=>i.deactivate(),__isActive:e=>i.isActivated(e),__getValueByKey:e=>i.getValueByKey(e),__getActiveItem:()=>i.getActiveItem(),__activateNext:()=>i.activateNext(),__activatePrev:()=>i.activatePrev(),__activateFirst:()=>i.activateFirst(),__activateLast:()=>i.activateLast(),__searchUsingQuery:e=>i.search(e),__getKeyByIndex:e=>i.getKeyByIndex(e),init(){this.$el.dataset.slot=o,t(()=>{this.__isLoading=i.pending.state}),t(()=>{this.__activatedKey=this.__getKeyByIndex(i.activeIndex.value)}),t(()=>{if(String(this.__searchQuery).length>0){let s=this.__searchUsingQuery(this.__searchQuery).map(l=>l.key);s.length>=0&&(this.__filteredKeys=s)}else this.__filteredKeys=null;this.__activatedKey&&this.__filteredKeys&&!this.__filteredKeys.includes(this.__activatedKey)&&this.__deactivate(),this.__isOpen&&!this.__getActiveItem()&&this.__filteredKeys&&this.__filteredKeys.length&&this.__activate(this.__filteredKeys[0])}),this.__isMultiple?this.__selectedKeys=[]:this.__selectedKeys=null,this.__isMultiple=Alpine.extractProp(_,"multiple",!1),this.__isDisabled=Alpine.extractProp(_,"disabled",!1),this.__compareBy=Alpine.extractProp(_,"by","");let e=this.__isMultiple?[]:"",r=Alpine.extractProp(_,"initial-value",e);this.__registerEventsDelector(),this.$nextTick(()=>{this.$refs.__input||(this.__isOpen=!0)})},__open(){if(this.__isOpen)return;this.__isOpen=!0;let e=this.$refs.__input;requestAnimationFrame(()=>{e?.focus({preventScroll:!0}),this.__activateSelectedOrFirst()})},__pushSeparatorToItems(e){this.__items.push({type:"s",key:e})},__pushGroupToItems(e){this.__items.push({type:"g",key:e})},__pushOptionToItems(e){this.__items.push({type:"o",key:e})},__activateSelectedOrFirst(e=!0){if(!(!this.__isOpen||this.__getActiveItem())){if(e&&this.__selectedKeys){let s=this.__isMultiple?this.__selectedKeys[0]:this.__selectedKeys;if(s){this.__activate(s);return}}this.__activateFirst()}},__close(){this.__isOpen=!1,this.__deactivate()},__handleSelection(e){let r=this.__getValueByKey(e);if(!this.__isMultiple){this.__selectedKeys=e,this.__state===r?(this.__state=null,this.__selectedKeys=null):this.__state=r,this.__static||this.__close();return}Array.isArray(this.__selectedKeys)||(this.__selectedKeys=[]),Array.isArray(this.__state)||(this.__state=[]);let s=this.__state.findIndex(u=>this.__compare(u,r)),l=this.__selectedKeys.indexOf(e);s===-1?(this.__state.push(r),this.__selectedKeys.push(e)):(this.__state.splice(s,1),this.__selectedKeys.splice(l,1))},__selectActive(){!this.__activatedKey||this.__handleSelection(this.__activatedKey)},__startTyping(){this.__isTyping=!0},__stopTyping(){this.__isTyping=!1},__resetInput(){let e=this.$refs.__input;if(!e)return;let r=this.__getCurrentValue();e.value=r},__getCurrentValue(){return!this.$refs.__input||!this.__state?"":typeof this.__state=="string"?this.__state:""},__compare(e,r){let s=this.__compareBy;if(!this.__compareBy)s=(l,u)=>Alpine.raw(l)===Alpine.raw(u);else if(typeof this.__compareBy=="string"){let l=this.__compareBy;s=(u,p)=>{if(!u||typeof u!="object"||!p||typeof p!="object")return Alpine.raw(u)===Alpine.raw(p);let n=u,a=p;return n[l]===a[l]}}return s(e,r)},__nextOptionId(){return++this.__o_id},__nextGroupId(){return++this.__g_id},__nextSeparatorId(){return++this.__s_id},__registerEventsDelector(){let e=s=>Alpine.findClosest(s,l=>l.dataset.slot===y),r=s=>function(l){if(l.stopPropagation(),!(l.target instanceof Element))return;let u=e(l.target);!u||s(u)};this.$nextTick(()=>{this.__optionsEl=this.$refs.__options,!!this.__optionsEl&&(this.__optionsEl.addEventListener("click",r(s=>{!s.dataset.key||(this.__handleSelection(s.dataset.key),!this.__isMultiple&&!this.__static&&(this.__close(),this.__resetInput()),this.$nextTick(()=>this.$refs?.__input?.focus({preventScroll:!0})))})),this.__optionsEl.addEventListener("mouseover",r(s=>{!s.dataset.key||this.__activate(s.dataset.key)})),this.__optionsEl.addEventListener("mousemove",r(s=>{this.__isActive(s.dataset.key||"")||!s.dataset.key||this.__activate(s.dataset.key)})),this.__optionsEl.addEventListener("mouseout",r(()=>{this.__keepActivated||this.__deactivate()})),this.$root.addEventListener("keydown",s=>{switch(s.key){case"ArrowDown":s.preventDefault(),s.stopPropagation(),this.__activateNext();break;case"ArrowUp":s.preventDefault(),s.stopPropagation(),this.__activatePrev();break;case"Enter":s.preventDefault(),s.stopPropagation(),this.__selectActive(),this.__isMultiple||(this.__close(),this.__resetInput());break;case"Escape":s.preventDefault(),s.stopPropagation(),this.__close(),this.$nextTick(()=>this.$refs?.__input?.focus({preventScroll:!0}));break;default:if(this.__static)return;this.__open();break}}))})}}}function g(_){let t="rover-options";return{init(){return this.$data.__static=_.extractProp(this.$el,"static",!1),_.bound(this.$el,"keepActivated")&&(this.__keepActivated=!0),this.$el.dataset.slot=t},__handleClickAway(i){if(this.__static)return;let o=i.target;o.dataset.slot&&o.dataset.slot===v||this.__close()}}}function I(_){_.directive("rover",(n,{value:a,modifiers:d},{Alpine:h,effect:c})=>{switch(a){case null:t(h,n,c);break;case"input":i(h,n);break;case"button":s(h,n);break;case"options":o(n);break;case"option":e(h,n);break;case"group":r(h,n);break;case"loading":u(h,n,d);break;case"separator":p(h,n);break;case"empty":l(h,n);break;default:console.error("invalid x-rover value",a,"use input, button, option, options, group or leave mepty for root level instead");break}});function t(n,a,d){n.bind(a,{"x-on:keydown.escape"(h){this.__isOpen&&(h.preventDefault(),this.__close())},"x-bind:key"(){return this.__reRenderKey},"x-data"(){return b({el:a,effect:d})}})}function i(n,a){n.bind(a,{"x-ref":"__input","x-model":"__searchQuery","x-bind:id"(){return this.$id("rover-input")},role:"combobox",tabindex:"0","aria-autocomplete":"list","x-data"(){return f(n)}})}function o(n){_.bind(n,{"x-ref":"__options","x-bind:id"(){return this.$id("rover-options")},role:"listbox","x-on:click.away"(a){this.__handleClickAway(a)},"x-data"(){return g(_)},"x-show"(){return this.$data.__static?!0:this.$data.__isOpen}})}function e(n,a){n.bind(a,{"x-id"(){return["rover-option"]},"x-bind:id"(){return this.$id("rover-option")},role:"option","x-show"(){return this.$data.__isVisible},"x-data"(){return m(n,this.__nextOptionId())}})}function r(n,a){n.bind(a,{"x-id"(){return["rover-group"]},"x-bind:id"(){return this.$id("rover-group")},role:"group","x-init"(){let d=this.$id("rover-group");this.$el.dataset.slot="rover-group",this.$el.setAttribute("aria-labelledby",`${d}-label`);let h=String(this.__nextGroupId());this.$el.dataset.key=h,this.__pushGroupToItems(h),this.$watch("__searchQuery",()=>{this.$nextTick(()=>{let c=this.$el.querySelectorAll("[data-slot=rover-option]:not([hidden])").length>0;this.$el.hidden=!c})})}})}function s(n,a){n.bind(a,{"x-ref":"__button","x-bind:id"(){return this.$id("rover-button")},tabindex:"-1","aria-haspopup":"true","x-on:click"(d){this.__isDisabled||(this.__isOpen?(this.__close(),this.__resetInput()):(d.preventDefault(),this.__open()),requestAnimationFrame(()=>this.$refs.__input.focus({preventScroll:!0})))}})}function l(n,a){n.bind(a,{"x-bind:id"(){return this.$id("rover-button")},tabindex:"-1","aria-haspopup":"true","x-show"(){return Array.isArray(this.__filteredKeys)&&this.__filteredKeys.length===0&&this.__searchQuery.length>0}})}function u(n,a,d){let h=n.$data(a);d.filter(c=>c==="hide")}function p(n,a){n.bind(a,{"x-init"(){this.$el.dataset.slot="rover-separator";let d=String(this.__nextSeparatorId());this.$el.dataset.key=d,this.__pushSeparatorToItems(d),this.$el.setAttribute("role","separator"),this.$el.setAttribute("aria-orientation","horizontal")}})}}document.addEventListener("alpine:init",()=>{window.Alpine.plugin(I)});})();
