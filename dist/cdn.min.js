(()=>{var N="rover-option";function f(i,e,t){return{__uniqueKey:"option-"+e,__isVisible:!0,init(){this.$el.dataset.slot=N,this.$el.dataset.key=this.__uniqueKey;let n;t!==null?n=t:n=i.extractProp(this.$el,"value","");let r=i.extractProp(this.$el,"disabled",!1,!1);this.$el.dataset.value=n,this.__add(this.__uniqueKey,n,r),this.__pushOptionToItems(String(e)),this.$nextTick(()=>{r&&this.$el.setAttribute("tabindex","-1")})},destroy(){this.__forget(this.__uniqueKey)}}}var m=class{constructor(e={}){this.items=[];this.itemsMap=new Map;this.searchIndex=[];this.currentQuery="";this.currentResults=[];this.navIndex=[];this.activeNavPos=-1;this.needsReindex=!1;this.isProcessing=!1;this.pending=Alpine.reactive({state:!1}),this.activeIndex=Alpine.reactive({value:void 0}),this.searchThreshold=e.searchThreshold??500}add(e,t,n=!1){if(this.itemsMap.has(e))return;let r={key:e,value:t,disabled:n};this.items.push(r),this.itemsMap.set(e,r),this.invalidate()}forget(e){let t=this.itemsMap.get(e);if(!t)return;let n=this.items.indexOf(t);this.itemsMap.delete(e),this.items.splice(n,1),this.activeIndex.value===n?(this.activeIndex.value=void 0,this.activeNavPos=-1):this.activeIndex.value!==void 0&&this.activeIndex.value>n&&this.activeIndex.value--,this.invalidate()}invalidate(){this.needsReindex=!0,this.currentQuery="",this.currentResults=[],this.scheduleBatch()}scheduleBatch(){this.isProcessing||(this.isProcessing=!0,this.pending.state=!0,queueMicrotask(()=>{this.rebuildSearchIndex(),this.rebuildNavIndex(),this.isProcessing=!1,this.pending.state=!1}))}rebuildSearchIndex(){!this.needsReindex||(this.searchIndex=this.items.map(e=>({key:e.key,value:String(e.value).toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"")})),this.needsReindex=!1)}rebuildNavIndex(){this.navIndex=[];let e=this.currentResults.length>0?this.currentResults:this.items;for(let t=0;t<this.items.length;t++)!this.items[t]?.disabled&&e.includes(this.items[t])&&this.navIndex.push(t)}toggleIsPending(){this.pending.state=!this.pending.state}search(e){if(!e)return this.currentQuery="",this.currentResults=[],this.rebuildNavIndex(),this.items;let t=e.toLowerCase();if(this.currentQuery&&t.startsWith(this.currentQuery)&&this.currentResults.length>0){let l=this.currentResults.filter(o=>String(o.value).toLowerCase().includes(t));return this.currentQuery=t,this.currentResults=l,this.rebuildNavIndex(),l}this.rebuildSearchIndex();let n=t.normalize("NFD").replace(/[\u0300-\u036f]/g,""),r=[];for(let{key:l,value:o}of this.searchIndex)if(o.includes(n)){let p=this.itemsMap.get(l);p&&r.push(p)}return this.currentQuery=t,this.currentResults=r,this.rebuildNavIndex(),r}get(e){return this.itemsMap.get(e)}getValueByKey(e){return this.get(e)?.value}getKeyByIndex(e){return e==null||e===void 0?null:this.items[e]?.key??null}all(){return this.items}get size(){return this.items.length}activate(e){let t=this.get(e);if(!t||t.disabled)return;this.rebuildSearchIndex(),this.rebuildNavIndex();let n=this.items.indexOf(t);this.activeIndex.value!==n&&(this.activeIndex.value=n,this.activeNavPos=this.navIndex.indexOf(n))}deactivate(){this.activeIndex.value=void 0,this.activeNavPos=-1}isActivated(e){let t=this.get(e);return t?this.items.indexOf(t)===this.activeIndex.value:!1}getActiveItem(){return this.activeIndex.value===void 0?null:this.items[this.activeIndex.value]??null}activateFirst(){if(this.rebuildSearchIndex(),this.rebuildNavIndex(),!this.navIndex.length)return;let e=this.navIndex[0];e!==void 0&&(this.activeIndex.value=e,this.activeNavPos=0)}activateLast(){if(this.rebuildSearchIndex(),this.rebuildNavIndex(),!this.navIndex.length)return;this.activeNavPos=this.navIndex.length-1;let e=this.navIndex[this.activeNavPos];typeof e=="number"&&(this.activeIndex.value=e)}activateNext(){if(this.rebuildSearchIndex(),this.rebuildNavIndex(),!this.navIndex.length)return;if(this.activeNavPos===-1){this.activateFirst();return}this.activeNavPos=(this.activeNavPos+1)%this.navIndex.length;let e=this.navIndex[this.activeNavPos];e!==void 0&&(this.activeIndex.value=e)}activatePrev(){if(this.rebuildSearchIndex(),this.rebuildNavIndex(),!this.navIndex.length)return;if(this.activeNavPos===-1){this.activateLast();return}this.activeNavPos=this.activeNavPos===0?this.navIndex.length-1:this.activeNavPos-1;let e=this.navIndex[this.activeNavPos];e!==void 0&&(this.activeIndex.value=e)}},b=m;function _(i,e,t,n){i.addEventListener(e,t),n.push(()=>{i.removeEventListener(e,t)})}function I(i){let e=[],t=i.$el.querySelector("[x-rover\\:input]");return t||console.warn("Input element with [x-rover\\:input] not found"),{on(n,r){if(!t)return;_(t,n,o=>{let p=i.__activatedKey??void 0;r(o,p)},e)},get value(){return t?t.value:""},set value(n){t&&(t.value=n)},enableDefaultInputHandlers(n=[]){!t||(n.includes("focus")||this.on("focus",()=>i.__startTyping()),n.includes("input")||this.on("input",()=>{i.__isTyping&&i.__open()}),n.includes("blur")||this.on("blur",()=>i.__stopTyping()),n.includes("keydown")||this.on("keydown",r=>{switch(r.key){case"ArrowDown":if(r.preventDefault(),r.stopPropagation(),!i.__isOpen){i.__open();break}i.__activateNext();break;case"ArrowUp":if(r.preventDefault(),r.stopPropagation(),!i.__isOpen){i.__open();break}i.__activatePrev();break;case"Escape":r.preventDefault(),r.stopPropagation(),i.__close(),requestAnimationFrame(()=>t?.focus({preventScroll:!0}));break}}))},destroy(){e.forEach(n=>n())}}}function M(i){let e=[];return{on(t,n){i.$nextTick(()=>{let r=i.$refs.__input;if(!r)return;let l=o=>{let p=i.__activatedKey??void 0;n(o,p)};r.addEventListener(t,l),e.push(()=>{r.removeEventListener(t,l)})})},destroy(){e.forEach(t=>t())}}}var A="rover-option";function E(i){let e=[],t=i.$el.querySelector("[x-rover\\:options]");t||console.warn("Options container not found");let n=r=>{if(!!r)return Alpine.findClosest(r,l=>l.dataset.slot===A&&l.hasAttribute("x-rover:option"))};return{on(r,l){if(!t)return;_(t,r,p=>{let u=n(p.target),d=i.__activatedKey??null;l(p,u,d)},e)},findClosestOption:n,enableDefaultOptionsHandlers(r=[]){Object.entries({click:o=>{!o.dataset.key||i.$nextTick(()=>i.$refs.__input?.focus({preventScroll:!0}))},mouseover:o=>{!o.dataset.key||i.__activate(o.dataset.key)},mousemove:o=>{!o.dataset.key||i.__isActive(o.dataset.key)||i.__activate(o.dataset.key)},mouseout:()=>{i.__keepActivated||i.__deactivate()}}).forEach(([o,p])=>{if(!r.includes(o)){let u=d=>{if(d.stopPropagation(),!(d.target instanceof Element))return;let s=n(d.target);!s||p(s)};t?.addEventListener(o,u),e.push(()=>t?.removeEventListener(o,u))}})},open(){i.__open()},close(){i.__close()},destroy(){e.forEach(r=>r())}}}function g({effect:i}){let e=new b,t="rover-root";return{collection:e,__optionsEls:void 0,__groupsEls:void 0,__isOpen:!1,__isTyping:!1,__isLoading:!1,__o_id:-1,__g_id:-1,__s_id:-1,__static:!1,__keepActivated:!0,__optionsEl:void 0,__activatedKey:void 0,__selectedKeys:void 0,__items:[],__searchQuery:"",__filteredKeys:null,__filteredKeysSet:new Set,__inputManager:void 0,__optionsManager:void 0,__optionManager:void 0,__add:(n,r,l)=>e.add(n,r,l),__forget:n=>e.forget(n),__activate:n=>e.activate(n),__deactivate:()=>e.deactivate(),__isActive:n=>e.isActivated(n),__getValueByKey:n=>e.getValueByKey(n),__getActiveItem:()=>e.getActiveItem(),__activateNext:()=>e.activateNext(),__activatePrev:()=>e.activatePrev(),__activateFirst:()=>e.activateFirst(),__activateLast:()=>e.activateLast(),__searchUsingQuery:n=>e.search(n),__getKeyByIndex:n=>e.getKeyByIndex(n),__onOpenCallback:()=>{},__onOpen(n){this.__onOpenCallback=n},__onCloseCallback:()=>{},__onClose(n){this.__onCloseCallback=n},init(){this.$el.dataset.slot=t,this.__setupManagers(),i(()=>{this.__isLoading=e.pending.state}),i(()=>{this.__activatedKey=this.__getKeyByIndex(e.activeIndex.value)}),i(()=>{if(String(this.__searchQuery).length>0){let n=this.__searchUsingQuery(this.__searchQuery).map(r=>r.key);n.length>=0&&(this.__filteredKeys=n)}else this.__filteredKeys=null;this.__activatedKey&&this.__filteredKeys&&!this.__filteredKeys.includes(this.__activatedKey)&&this.__deactivate(),this.__isOpen&&!this.__getActiveItem()&&this.__filteredKeys&&this.__filteredKeys.length&&this.__activate(this.__filteredKeys[0])}),this.$nextTick(()=>{this.__optionsEls=Array.from(this.$el.querySelectorAll("[data-slot=rover-option]")),this.__groupsEls=Array.from(this.$el.querySelectorAll("[data-slot=rover-group]")),i(()=>{let n=this.__activatedKey,r=this.__filteredKeys?new Set(this.__filteredKeys):null;requestAnimationFrame(()=>{this.__optionsEls.forEach(p=>{let u=p,d=u.dataset.key;!d||(r!==null?u.hidden=!r.has(d):u.hidden=!1,d===n?(u.setAttribute("data-active","true"),u.setAttribute("aria-current","true"),u.scrollIntoView({block:"nearest"})):(u.removeAttribute("data-active"),u.removeAttribute("aria-current")))}),this.__groupsEls.forEach(p=>{let u=p,d=u.querySelectorAll("[data-slot=rover-option]"),s=Array.from(d).some(a=>{let c=a;return r?r.has(c.dataset.key||""):!0});u.hidden=!s})})})}),this.$nextTick(()=>{this.$refs.__input||(this.__isOpen=!0)})},__setupManagers(){this.__inputManager=I(this),this.__optionManager=M(this),this.__optionsManager=E(this)},__open(){this.__isOpen||(this.__isOpen=!0,requestAnimationFrame(()=>{this.$refs?.__input?.focus({preventScroll:!0})}),this.__onOpenCallback())},__pushSeparatorToItems(n){this.__items.push({type:"s",key:n})},__pushGroupToItems(n){this.__items.push({type:"g",key:n})},__pushOptionToItems(n){this.__items.push({type:"o",key:n})},__close(){this.__isOpen=!1,this.__deactivate()},__startTyping(){this.__isTyping=!0},__stopTyping(){this.__isTyping=!1},__nextOptionId(){return++this.__o_id},__nextGroupId(){return++this.__g_id},__nextSeparatorId(){return++this.__s_id},destroy(){this.__inputManager?.destroy()}}}var O=i=>{let e=Alpine.$data(i);return{get isOpen(){return e.__isOpen},get collection(){return e.collection},onOpen(t){e.__onOpen(t)},get input(){return e.__inputManager},get option(){return e.__optionManager},get options(){return e.__optionsManager},onClose(t){e.__onClose(t)},activate(t){e.collection.activate(t)},deactivate(){e.collection.deactivate()},getValueByKey(t){return e.collection.getValueByKey(t)},getActiveItem(){return e.collection.getActiveItem()},activateNext(){e.collection.activateNext()},activatePrev(){e.collection.activatePrev()},activateFirst(){e.collection.activateFirst()},activateLast(){e.collection.activateLast()},searchUsing(t){return e.collection.search(t)},getKeyByIndex(t){return e.collection.getKeyByIndex(t)}}};var T=i=>({activate(e){i.collection.activate(e)},deactivate(){i.collection.deactivate()},getValueByKey(e){return i.collection.getValueByKey(e)},getActiveItem(){return i.collection.getActiveItem()},activateNext(){i.collection.activateNext()},activatePrev(){i.collection.activatePrev()},activateFirst(){i.collection.activateFirst()},activateLast(){i.collection.activateLast()},searchUsing(e){return i.collection.search(e)},getKeyByIndex(e){return i.collection.getKeyByIndex(e)}});var R=i=>({isOpen(){return i.__isOpen},open(){i.__open()},close(){i.__close()},isStatic(){return i.__static}});function x(i){i.magic("rover",e=>{let t=i.findClosest(e,n=>n.hasAttribute("x-rover"));if(!t)throw"No x-rover directive found, this magic meant to be used under x-rover root context...";return O(t)}),i.magic("roverOption",e=>{let t=i.findClosest(e,r=>r.hasAttribute("x-rover:option"));if(!t)throw"No x-rover:option directive found, this magic meant to be used per option context...";let n=i.$data(t);return T(n)}),i.magic("roverOptions",e=>{let t=i.findClosest(e,r=>r.hasAttribute("x-option:options"));if(!t)throw"No x-rover:options directive found, this magic meant to be used per options context...";let n=i.$data(t);return R(n)})}function y(i){i.directive("rover",(s,{value:a,modifiers:c,expression:h},{Alpine:v,effect:K,evaluate:L})=>{switch(a){case null:e(v,s,K);break;case"input":t(v,s);break;case"button":o(v,s);break;case"options":n(s);break;case"option":r(v,s,h,L);break;case"group":l(v,s);break;case"loading":u(v,s,c);break;case"separator":d(v,s);break;case"empty":p(v,s);break;default:console.error("invalid x-rover value",a,"use input, button, option, options, group or leave mepty for root level instead");break}}).before("data"),x(i);function e(s,a,c){s.bind(a,{"x-data"(){return{...g({effect:c})}}})}function t(s,a){s.bind(a,{"x-ref":"__input","x-model":"__searchQuery","x-bind:id"(){return this.$id("rover-input")},role:"combobox",tabindex:"0","aria-autocomplete":"list","x-init"(){this.$el.dataset.slot="rover-input"}})}function n(s){i.bind(s,{"x-ref":"__options","x-bind:id"(){return this.$id("rover-options")},role:"listbox","x-init"(){this.$data.__static=i.extractProp(this.$el,"static",!1),i.bound(this.$el,"keepActivated")&&(this.__keepActivated=!0),this.$el.dataset.slot="rover-options"},"x-show"(){return this.$data.__static?!0:this.$data.__isOpen}})}function r(s,a,c,h){s.bind(a,{"x-id"(){return["rover-option"]},"x-bind:id"(){return this.$id("rover-option")},role:"option","x-data"(){let v=null;return c!==""&&(v=h(c)),f(s,this.__nextOptionId(),v)}})}function l(s,a){s.bind(a,{"x-id"(){return["rover-group"]},"x-bind:id"(){return this.$id("rover-group")},role:"group","x-init"(){let c=this.$id("rover-group");this.$el.dataset.slot="rover-group",this.$el.setAttribute("aria-labelledby",`${c}-label`);let h=String(this.__nextGroupId());this.$el.dataset.key=h,this.__pushGroupToItems(h)}})}function o(s,a){s.bind(a,{"x-ref":"__button","x-bind:id"(){return this.$id("rover-button")},tabindex:"-1","aria-haspopup":"true","x-on:click"(c){this.__isDisabled||(this.__isOpen?(this.__close(),this.__resetInput()):(c.preventDefault(),this.__open()),requestAnimationFrame(()=>this.$refs.__input.focus({preventScroll:!0})))}})}function p(s,a){s.bind(a,{"x-bind:id"(){return this.$id("rover-button")},tabindex:"-1","aria-haspopup":"true","x-show"(){return Array.isArray(this.__filteredKeys)&&this.__filteredKeys.length===0&&this.__searchQuery.length>0}})}function u(s,a,c){let h=s.$data(a);c.filter(v=>v==="hide")}function d(s,a){s.bind(a,{"x-init"(){this.$el.dataset.slot="rover-separator";let c=String(this.__nextSeparatorId());this.$el.dataset.key=c,this.__pushSeparatorToItems(c),this.$el.setAttribute("role","separator"),this.$el.setAttribute("aria-orientation","horizontal")}})}}document.addEventListener("alpine:init",()=>{window.Alpine.plugin(y)});})();
